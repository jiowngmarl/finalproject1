import{d as x,n as _,o as T,p as N,i,j as m,w as y,g as k,v as u,h as B,m as v,t as L,_ as V}from"./index-1iuYf_qr.js";const F={class:"mrp-page"},H={class:"table-section"},I={class:"table-section"},O={class:"button-wrap"},P=x({__name:"deliveryManagementPage",setup(U){const p=_([]),s=_([]),l=_(null),f=_(1),S=[{key:"work_order_no",label:"요청코드"},{key:"product_unit",label:"단위"},{key:"product_name",label:"제품명"},{key:"product_stand",label:"규격"},{key:"production_qty",label:"요청수량"},{key:"order_start_dt",label:"요청일자",formatter:e=>b(e)},{key:"action",label:"선택"}],w=[{key:"work_order_no",label:"요청코드"},{key:"material_code",label:"자재코드"},{key:"material_name",label:"자재명"},{key:"material_unit",label:"단위"},{key:"quantity",label:"재고량"},{key:"qty",label:"출고 수량"},{key:"lot_number",label:"LOT번호"}],b=e=>{const t=new Date(e),a=new Date(t.getTime()+9*60*60*1e3),c=a.getFullYear(),n=String(a.getMonth()+1).padStart(2,"0"),d=String(a.getDate()).padStart(2,"0"),g=String(a.getHours()).padStart(2,"0"),o=String(a.getMinutes()).padStart(2,"0");return`${c}-${n}-${d} ${g}:${o}`},h=async()=>{try{const e=await u.get("/delivery");p.value=e.data,console.log(e.data)}catch(e){console.error("계획 조회 실패",e)}},$=async e=>{try{l.value=e;const t=await u.get(`/delivery/${e.work_order_no}`);s.value=t.data,console.log("응답 데이터:",t.data)}catch(t){console.error("계산 실패",t)}},q=async()=>{if(!l.value){alert("작업지시를 선택해주세요.");return}if(s.value.find(t=>t.qty>t.quantity)){alert("자재가 부족합니다.! 발주를 넣어주세요.!!!!");return}try{const t=[],a="이승민",c=l.value.work_order_no;for(const o of s.value){const r=new Date,C=r.getFullYear().toString()+(r.getMonth()+1).toString().padStart(2,"0")+r.getDate().toString().padStart(2,"0")+r.getHours().toString().padStart(2,"0")+r.getMinutes().toString().padStart(2,"0")+r.getSeconds().toString().padStart(2,"0"),M=Math.floor(Math.random()*1e3),D=`outbound-${C}-${M}`;t.push({outbound_id:D,work_order_no:c,material_code:o.material_code,outbound_qty:o.qty,name:a,lot_number:o.lot_number})}console.log(t);const n=await u.post("/delivery",t);let d=!0;for(const o of s.value)try{(await u.put(`/delivery/${o.material_code}/${o.lot_number}`,{quantity:o.quantity-o.qty})).data.isSuccessed||(d=!1)}catch(r){console.error("재고 업데이트 실패:",r),d=!1}const g=await u.put(`/delivery/${l.value.work_order_no}`);n.data.isSuccessed&&d&&g.data.isUpdated?(alert("출고가 완료되었습니다."),s.value=[],p.value=[],l.value=null):alert("출고 처리 중 일부 실패가 발생했습니다.")}catch(t){console.error("출고 실패",t),alert("출고 중 오류가 발생했습니다.")}};return T(()=>{h()}),(e,t)=>{const a=k("va-button"),c=k("va-data-table");return B(),N("div",F,[t[4]||(t[4]=i("h2",{class:"page-title"},"자재 출고",-1)),i("div",H,[t[1]||(t[1]=i("h3",{class:"table-title"},"작업지시 리스트",-1)),m(c,{items:p.value,columns:S,"per-page":5,"current-page":f.value,"track-by":"work_order_no"},{"cell(order_start_dt)":y(({row:n})=>[v(L(b(n.source.order_start_dt)),1)]),"cell(action)":y(({row:n})=>[m(a,{size:"small",onClick:d=>$(n.source)},{default:y(()=>t[0]||(t[0]=[v("선택")])),_:2,__:[0]},1032,["onClick"])]),_:1},8,["items","current-page"])]),i("div",I,[t[3]||(t[3]=i("h3",{class:"table-title"},"출고 자재 리스트",-1)),m(c,{items:s.value,columns:w,"track-by":"material_code"},null,8,["items"]),i("div",O,[m(a,{onClick:q,disabled:!l.value},{default:y(()=>t[2]||(t[2]=[v("출고")])),_:1,__:[2]},8,["disabled"])])])])}}}),Y=V(P,[["__scopeId","data-v-a7dceae1"]]);export{Y as default};
//# sourceMappingURL=deliveryManagementPage-CarJxlWm.js.map
