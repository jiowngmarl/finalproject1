{"version":3,"file":"purchaseOrderPage-Cq-NXQQk.js","sources":["../../../client/src/pages/material/purchaseOrderPage.vue"],"sourcesContent":["<template>\n  <div class=\"mrp-page\">\n    <!-- 생산계획 테이블 -->\n    <div class=\"table-section\">\n      <h3 class=\"table-title\">발주 요청 자재</h3>\n      <va-data-table\n        v-model:current-page=\"page\"\n        :items=\"orderList\"\n        :columns=\"orderColumns\"\n        :per-page=\"5\"\n        track-by=\"purchase_order_id\"\n      >\n        <template #cell(action)=\"{ row }\">\n          <va-button size=\"small\" @click=\"onSelectMt(row.source)\">\n            선택\n          </va-button>\n        </template>\n      </va-data-table>\n\n      <!-- 페이지네이션 UI 추가 -->\n      <va-pagination\n        v-model=\"page\"\n        :pages=\"Math.ceil(orderList.length / 5)\"\n        class=\"mt-2\"\n      />\n    </div>\n\n    <!-- 부족 자재 리스트 -->\n    <div class=\"table-section\">\n      <h3 class=\"table-title\">발주 등록</h3>\n      <va-data-table\n        :items=\"shortageList\"\n        :columns=\"shortageColumns\"\n        track-by=\"purchase_order_id\"\n        class=\"input-compact\"\n      >\n        <template #cell(select)=\"{ row }\">\n          <va-checkbox\n            :model-value=\"selectedRows.includes(row.source.purchase_order_id)\"\n            @update:model-value=\"\n              (checked) => {\n                const id = row.source.purchase_order_id;\n                if (checked) {\n                  selectedRows.push(id);\n                } else {\n                  selectedRows.splice(selectedRows.indexOf(id), 1);\n                }\n              }\n            \"\n          />\n        </template>\n        <!-- 날짜 포맷 -->\n        <template #cell(purchase_order_date)=\"{ row }\">\n          {{ formatDateForView(row.source.purchase_order_date) }}\n        </template>\n\n        <!-- 납기일: 캘린더 선택 -->\n        <template #cell(due_date)=\"{ rowIndex }\">\n          <va-date-input\n            v-model=\"shortageList[rowIndex].due_date\"\n            placeholder=\"납기일\"\n            :clearable=\"false\"\n            style=\"width: 130px; min-width: 0\"\n          />\n        </template>\n\n        <template #cell(account_id)=\"{ rowIndex }\">\n          <va-input\n            v-model=\"shortageList[rowIndex].account_id\"\n            placeholder=\"거래처 코드\"\n            size=\"small\"\n            class=\"input-compact\"\n            @input=\"onAccountIdInput(rowIndex)\"\n          />\n        </template>\n\n        <!-- 거래처 명 -->\n        <template #cell(account_name)=\"{ rowIndex }\">\n          <va-input\n            v-model=\"shortageList[rowIndex].account_name\"\n            placeholder=\"거래처명\"\n            size=\"small\"\n            class=\"input-compact\"\n            @input=\"onAccountNameInput(rowIndex)\"\n          />\n        </template>\n\n        <!-- 담당자: input -->\n        <template #cell(name)=\"{ rowIndex }\">\n          <va-input\n            v-model=\"shortageList[rowIndex].name\"\n            placeholder=\"담당자\"\n            size=\"small\"\n            class=\"input-compact\"\n          />\n        </template>\n      </va-data-table>\n      <div class=\"button-wrap\">\n        <va-button @click=\"onRegisterOrder\"> 등록 </va-button>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\" setup>\nimport axios from \"axios\";\nimport { ref, onMounted } from \"vue\";\n\ninterface PurchaseOrder {\n  purchase_order_id: string;\n  material_code: string;\n  material_name: string;\n  material_unit: string;\n  material_cls: string;\n  purchase_order_quantity: string;\n}\n\ninterface Shortage {\n  purchase_order_id: string;\n  purchase_order_name: string;\n  material_code: string;\n  material_name: string;\n  purchase_order_quantity: number;\n  purchase_order_date: string;\n  material_unit: string;\n  due_date: string | Date | null;\n  account_id: string;\n  account_name: string;\n  name: string;\n}\n\ninterface Account {\n  account_id: string;\n  account_name: string;\n}\n\nconst accountList = ref<Account[]>([]);\nconst orderList = ref<PurchaseOrder[]>([]);\nconst shortageList = ref<Shortage[]>([]);\nconst selectedPlan = ref<PurchaseOrder | null>(null);\nconst page = ref(1);\nconst selectedRows = ref<string[]>([]);\n\nconst orderColumns = [\n  { key: \"material_code\", label: \"자재코드\" },\n  { key: \"material_name\", label: \"자재명\" },\n  { key: \"material_safty\", label: \"안전재고\" },\n  { key: \"material_unit\", label: \"단위\" },\n  { key: \"material_cls\", label: \"분류\" },\n  { key: \"purchase_order_quantity\", label: \"발주수량\" },\n  { key: \"action\", label: \"선택\" },\n];\n\nconst shortageColumns = [\n  { key: \"select\", label: \"선택\" },\n  { key: \"purchase_order_name\", label: \"발주명\" },\n  { key: \"material_code\", label: \"자재코드\" },\n  { key: \"material_name\", label: \"자재명\" },\n  { key: \"purchase_order_quantity\", label: \"요청수량\" },\n  { key: \"purchase_order_date\", label: \"발주 요청일\" },\n  { key: \"material_unit\", label: \"단위\" },\n  { key: \"due_date\", label: \"납기일\" },\n  { key: \"account_id\", label: \"거래처코드\" },\n  { key: \"account_name\", label: \"거래처 명\" },\n  { key: \"name\", label: \"담당자\" },\n];\n\nconst formatDateForView = (date: Date | string | null | undefined): string => {\n  if (!date) return \"\";\n  const d = typeof date === \"string\" ? new Date(date) : date;\n  return `${d.getFullYear()}-${d.getMonth() + 1}-${d.getDate()}`;\n};\n\nconst fetchPlans = async () => {\n  try {\n    const res = await axios.get(\"/purchase\");\n    orderList.value = Array.isArray(res.data) ? res.data : [];\n  } catch (err) {\n    console.error(\"계획 조회 실패\", err);\n    orderList.value = []; // 실패 시에도 빈 배열로 초기화\n  }\n};\n\nconst fetchOrder = async () => {\n  try {\n    const res = await axios.get(\"/purchaseIn\");\n    shortageList.value = Array.isArray(res.data) ? res.data : [];\n  } catch (err) {\n    console.error(\"계획 조회 실패\", err);\n    orderList.value = []; // 실패 시에도 빈 배열로 초기화\n  }\n};\n\nconst fetchAccounts = async () => {\n  try {\n    const res = await axios.get(\"/account\"); // 예: 거래처 API\n    accountList.value = res.data;\n  } catch (err) {\n    console.error(\"거래처 목록 불러오기 실패\", err);\n  }\n};\n\nconst onSelectMt = async (order: PurchaseOrder) => {\n  try {\n    selectedPlan.value = order;\n    await axios.put(`/purchase/${order.purchase_order_id}`);\n    await fetchPlans();\n    await fetchOrder();\n  } catch (err) {\n    console.error(\"MRP 계산 실패\", err);\n  }\n};\n\nconst onRegisterOrder = async () => {\n  if (selectedRows.value.length === 0) {\n    alert(\"선택된 항목이 없습니다.\");\n    return;\n  }\n\n  const selectedItems = shortageList.value.filter((item) =>\n    selectedRows.value.includes(item.purchase_order_id),\n  );\n\n  // 예: 서버 전송용 변환\n  const payload = selectedItems.map((item) => ({\n    purchase_order_id: item.purchase_order_id,\n    due_date: formatDateForView(item.due_date),\n    account_id: item.account_id,\n    name: item.name,\n  }));\n\n  try {\n    for (const item of payload) {\n      const res = await axios.put(`/puOrder/${item.purchase_order_id}`, item);\n      if (!res.data.isSuccessed) {\n        console.warn(`❌ 발주 등록 실패: ${item.purchase_order_id}`);\n      }\n    }\n\n    alert(\"발주 등록 완료!\");\n    selectedRows.value = [];\n    fetchOrder();\n  } catch (err) {\n    console.error(\"발주 등록 실패:\", err);\n    alert(\"서버 오류 발생\");\n  }\n};\n\nconst onAccountIdInput = (index: number) => {\n  const code = String(shortageList.value[index].account_id);\n  const matched = accountList.value.find((a) => String(a.account_id) === code);\n  if (matched) {\n    shortageList.value[index].account_name = matched.account_name;\n  }\n};\n\nconst onAccountNameInput = (index: number) => {\n  const name = shortageList.value[index].account_name;\n  const matched = accountList.value.find((a) => a.account_name === name);\n  if (matched) {\n    shortageList.value[index].account_id = matched.account_id;\n  }\n};\n\nonMounted(() => {\n  fetchPlans();\n  fetchOrder();\n  fetchAccounts();\n});\n</script>\n\n<style scoped>\n.mrp-page {\n  padding: 1.5rem;\n  max-width: 1000px;\n  margin: 0 auto;\n}\n\n.page-title {\n  font-size: 1.5rem;\n  font-weight: bold;\n  margin-bottom: 2rem;\n}\n\n.table-section {\n  margin-bottom: 2rem;\n}\n\n.table-title {\n  font-size: 1.2rem;\n  font-weight: 600;\n  margin-bottom: 1rem;\n}\n\n.button-wrap {\n  text-align: right;\n  margin-top: 1rem;\n}\n\n.input-compact {\n  width: 120px;\n}\n</style>\n"],"names":["accountList","ref","orderList","shortageList","selectedPlan","page","selectedRows","orderColumns","shortageColumns","formatDateForView","date","d","fetchPlans","res","axios","err","fetchOrder","fetchAccounts","onSelectMt","order","onRegisterOrder","payload","item","onAccountIdInput","index","code","matched","a","onAccountNameInput","name","onMounted","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_cache","_createVNode","_component_va_data_table","$event","_withCtx","row","_component_va_button","_component_va_pagination","_hoisted_3","_component_va_checkbox","checked","id","_createTextVNode","_toDisplayString","rowIndex","_component_va_date_input","_component_va_input","_hoisted_4"],"mappings":"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"}