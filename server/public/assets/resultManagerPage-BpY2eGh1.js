import{d as A,n as d,c as E,e as c,f as S,g as z,w as r,m,i as _,j as n,o as le,p as P,t as R,q as ae,v as y,_ as te}from"./index-KTdWOH4t.js";import{_ as oe}from"./ProductSearchModal.vue_vue_type_script_setup_true_lang-mXzJ0qy5.js";const ne={class:"va-row va-gap-2 va-mb-4"},ue=A({__name:"EquipmentSearchModal",props:{modelValue:{type:Boolean},equipmentList:{}},emits:["update:modelValue","apply"],setup(B,{emit:D}){const U=B,b=D,l=d(""),q=E(()=>{const p=l.value.trim().toLowerCase();return p?U.equipmentList.filter(o=>{var v,g;return((v=o.eq_name)==null?void 0:v.toLowerCase().includes(p))||((g=o.eq_id)==null?void 0:g.toLowerCase().includes(p))}):U.equipmentList}),V=[{key:"eq_id",label:"설비 ID"},{key:"eq_name",label:"설비명"},{key:"code_label",label:"상태"},{key:"action",label:"선택",width:100}],k=p=>{b("apply",p),b("update:modelValue",!1)};return(p,o)=>{const v=c("va-input"),g=c("va-button"),$=c("va-data-table"),N=c("va-modal");return S(),z(N,{"model-value":p.modelValue,"onUpdate:modelValue":o[1]||(o[1]=f=>p.$emit("update:modelValue",f)),size:"large"},{title:r(()=>o[2]||(o[2]=[m("설비 검색")])),default:r(()=>[_("div",ne,[n(v,{modelValue:l.value,"onUpdate:modelValue":o[0]||(o[0]=f=>l.value=f),placeholder:"설비명 또는 ID 검색"},null,8,["modelValue"])]),n($,{items:q.value,columns:V,"track-by":"eq_id"},{"cell(action)":r(({row:f})=>[n(g,{size:"small",onClick:M=>k(f.rowData)},{default:r(()=>o[3]||(o[3]=[m("선택")])),_:2,__:[3]},1032,["onClick"])]),_:1},8,["items"])]),_:1},8,["model-value"])}}}),re={class:"va-pa-4"},se={class:"search-grid"},de={class:"button-group"},ie={class:"va-mt-6 tab-toggle"},_e={key:0,class:"input-layout"},me={class:"input-grid"},ce={class:"flex items-center gap-1"},pe={class:"side-buttons"},ve={key:1},ye={key:0,class:"va-text-danger va-mb-2"},be={class:"va-mb-3"},ke=A({__name:"resultManagerPage",setup(B){const D=()=>({result_id:"",result_detail:0,product_name:"",product_stand:"",process_code:"",process_name:"",eq_id:"",eq_name:"",code_label:"",work_start_date:"",work_start_time:"",work_end_time:"",work_order_qty:0,pass_qty:0,product_qual_qty:"",result_code_label:"",detail_code_label:"",manager_id:"",eq_type_code:"",selected:!1,result_remark:"",end_reason_code:"",process_defective_qty:""}),U=d([]),b=d([]),l=d(D()),q=d("input"),V=d([]),k=d(""),p=[{key:"select",label:"선택",width:40},{key:"result_id",label:"실적ID"},{key:"product_name",label:"제품명"},{key:"product_stand",label:"제품규격"},{key:"process_code",label:"공정코드"},{key:"process_name",label:"공정명"},{key:"work_start_time",label:"시작시간"},{key:"work_end_time",label:"종료시간"},{key:"process_time",label:"예상시간(분)"},{key:"duration",label:"소요시간(분)"},{key:"work_order_qty",label:"요청수량"},{key:"pass_qty",label:"재작수량"},{key:"detail_code_label",label:"진행상태"},{key:"manager_id",label:"작업자"}],o=d({workOrder:"",workDate:"",resultId:"",productName:"",productSpec:"",worker:""}),v=d([]),g=async()=>{try{const e=(await y.get("/endEq")).data;v.value=e.map(u=>({code_label:u.code_label??u.label??"",code_value:u.code_value??u.value??""})),console.log("✅ endReasonList:",v.value),console.log("✅ endReasonOptions:",$.value)}catch(t){console.error("작업종료 사유 코드 불러오기 실패",t)}};console.log("✅ endReasonList:",v.value);const $=E(()=>v.value.map(t=>({value:String(t.code_value??""),label:String(t.code_label??"")}))),N=async()=>{if(!l.value.result_id||!l.value.process_code){k.value="⚠️ 공정을 선택해주세요.",V.value=[];return}try{const t=await y.get(`/materialOutbound/${l.value.process_code}`);t.data.length===0?(k.value="🔍 출고된 자재 내역이 없습니다.",V.value=[]):(V.value=t.data,k.value="")}catch(t){k.value="❌ 자재 내역 조회 실패",V.value=[],console.error(t)}},f=E(()=>l.value.process_name==="포장"),M=()=>{alert(`📦 포장 공정은 포장 팀에서 처리합니다.
작업을 시작/종료할 수 없습니다.`)},W=async()=>{var s;const t=l.value.code_label,e=Number((s=l.value.process_code.match(/\d+$/))==null?void 0:s[0])||0,u=b.value.find(i=>{var O;const x=Number((O=i.process_code.match(/\d+$/))==null?void 0:O[0])||0;return i.result_id===l.value.result_id&&x<e&&(i.product_qual_qty===null||i.product_qual_qty===""||i.process_defective_qty===null||i.process_defective_qty==="")});if(u){alert(`⚠️ ${u.process_name} 공정의 품질검사가 완료되지 않았습니다.
완료 후 작업을 시작해주세요.`);return}if(t==="가동 중"){alert(`⚠️ 현재 설비는 가동중입니다.
가동이 종료되고 점검 및 청소가 완료된 후 사용하십시오.`);return}if(t==="정지"){alert(`⚠️ 현재 설비는 정지 상태입니다.
점검 및 청소가 모두 완료되기를 기다려주세요.`);return}const w=new Date;l.value.work_start_time=w.toISOString(),l.value.work_start_date=w.toISOString().split("T")[0];try{e===1&&await y.put(`/workResultStatus/${l.value.result_id}`),await y.put(`/prodResult/${l.value.result_detail}`,{pass_qty:l.value.pass_qty??0,manager_id:l.value.manager_id??"",eq_id:l.value.eq_id??""}),await y.put(`/eqStatus/${l.value.eq_id}`),alert("✅ 작업이 시작되었습니다."),T()}catch(i){alert("❌ 설비 상태 업데이트에 실패했습니다."),console.error(i)}},F=async()=>{var w;if(!l.value.result_detail){alert("⚠️ 작업 실적이 선택되지 않았습니다.");return}if((typeof l.value.end_reason_code=="string"?l.value.end_reason_code:((w=l.value.end_reason_code)==null?void 0:w.value)??"").trim()===""){alert("⚠️ 종료 사유(비고)를 작성해주세요.");return}const u=new Date().toISOString();l.value.work_end_time=u;try{await y.put(`/prodResultStop/${l.value.result_detail}`,{pass_qty:l.value.pass_qty,result_remark:l.value.end_reason_code}),await y.put(`/eqStop/${l.value.eq_id}`,{stop_reason:l.value.end_reason_code}),alert("✅ 작업이 종료되었습니다."),l.value=D(),T()}catch(s){console.error(s),alert("❌ 작업 종료 처리 중 오류가 발생했습니다.")}},C=t=>t?new Date(t).toLocaleTimeString("ko-KR",{hour:"2-digit",minute:"2-digit"}):"-",K=(t,e)=>{if(!t||!e)return"-";const u=new Date(t),s=new Date(e).getTime()-u.getTime();return`${Math.floor(s/6e4)}분`},G=(t,e)=>{b.value.forEach(u=>u.selected=!1),t.selected=e,e&&(l.value={...t})},T=async()=>{try{if(!o.value.workOrder){alert("작업지시서 번호를 입력하세요.");return}const e=(await y.get(`/prodResult/${o.value.workOrder}/${o.value.productSpec}`)).data.map(u=>({...u,selected:!1}));if(e.length===0){alert("자재를 출고하세요.!"),l.value=Object.assign(D(),{product_name:o.value.productName,product_stand:o.value.productSpec,result_id:o.value.resultId,manager_id:o.value.worker});return}U.value=e,b.value=e}catch{alert("조회 실패: 존재하지 않는 작업지시서일 수 있습니다.")}},H=async()=>{await T()},J=()=>{o.value={workOrder:"",workDate:"",resultId:"",productName:"",productSpec:"",worker:""},b.value=[],U.value=[]},L=d(!1),Q=()=>{L.value=!0},X=t=>{o.value.productName=t.product_name,o.value.productSpec=t.product_stand,o.value.workOrder=t.work_order_no,o.value.resultId=t.result_id,l.value.result_id=t.result_id,L.value=!1},I=d(!1),j=d([]),Y=async t=>{try{console.log(t);const e=await y.get(`/equipment/${t}`);j.value=e.data,console.log(e.data),I.value=!0}catch{alert("설비 데이터를 불러오지 못했습니다.")}},Z=t=>{l.value.eq_id=t.eq_id,l.value.eq_name=t.eq_name,l.value.code_label=t.code_label,I.value=!1};return le(()=>{g()}),(t,e)=>{const u=c("va-input"),w=c("va-date-input"),s=c("va-button"),i=c("va-checkbox"),x=c("va-data-table"),O=c("va-button-toggle"),h=c("va-select");return S(),P("div",re,[_("div",se,[n(u,{modelValue:o.value.workOrder,"onUpdate:modelValue":e[0]||(e[0]=a=>o.value.workOrder=a),label:"작업지시서 번호",placeholder:"작업지시서 번호 입력",readonly:""},null,8,["modelValue"]),n(u,{modelValue:o.value.productName,"onUpdate:modelValue":e[1]||(e[1]=a=>o.value.productName=a),label:"제품명",placeholder:"제품명 입력",readonly:""},null,8,["modelValue"]),n(u,{modelValue:o.value.productSpec,"onUpdate:modelValue":e[2]||(e[2]=a=>o.value.productSpec=a),label:"제품규격",placeholder:"제품 규격 입력",readonly:""},null,8,["modelValue"]),n(u,{modelValue:o.value.resultId,"onUpdate:modelValue":e[3]||(e[3]=a=>o.value.resultId=a),label:"작업실적 ID",placeholder:"작업 실적 ID 입력",readonly:""},null,8,["modelValue"]),n(w,{modelValue:o.value.workDate,"onUpdate:modelValue":e[4]||(e[4]=a=>o.value.workDate=a),label:"작업일자","manual-input":!1,clearable:!0},null,8,["modelValue"]),_("div",de,[n(s,{color:"info",onClick:Q},{default:r(()=>e[21]||(e[21]=[m("작업지시 검색")])),_:1,__:[21]}),n(s,{color:"primary",onClick:H},{default:r(()=>e[22]||(e[22]=[m("조회")])),_:1,__:[22]}),n(s,{color:"secondary",onClick:J},{default:r(()=>e[23]||(e[23]=[m("초기화")])),_:1,__:[23]})])]),n(x,{items:b.value,columns:p,"track-by":"result_id"},{"cell(select)":r(({row:a})=>[n(i,{"model-value":a.rowData.selected,"onUpdate:modelValue":ee=>G(a.rowData,ee)},null,8,["model-value","onUpdate:modelValue"])]),"cell(work_start_time)":r(({row:a})=>[m(R(C(a.rowData.work_start_time)),1)]),"cell(work_end_time)":r(({row:a})=>[m(R(C(a.rowData.work_end_time)),1)]),"cell(duration)":r(({row:a})=>[m(R(K(a.rowData.work_start_time,a.rowData.work_end_time)),1)]),_:1},8,["items"]),_("div",ie,[n(O,{modelValue:q.value,"onUpdate:modelValue":e[5]||(e[5]=a=>q.value=a),options:[{label:"작업실적 입력",value:"input"},{label:"자재 내역",value:"material"}],color:"primary","toggle-color":"primary"},null,8,["modelValue"])]),q.value==="input"?(S(),P("div",_e,[_("div",me,[n(u,{modelValue:l.value.process_code,"onUpdate:modelValue":e[6]||(e[6]=a=>l.value.process_code=a),label:"공정코드",readonly:""},null,8,["modelValue"]),n(u,{modelValue:l.value.manager_id,"onUpdate:modelValue":e[7]||(e[7]=a=>l.value.manager_id=a),label:"작업자명"},null,8,["modelValue"]),n(u,{modelValue:l.value.product_name,"onUpdate:modelValue":e[8]||(e[8]=a=>l.value.product_name=a),label:"제품명",readonly:""},null,8,["modelValue"]),n(u,{modelValue:l.value.product_stand,"onUpdate:modelValue":e[9]||(e[9]=a=>l.value.product_stand=a),label:"제품규격",readonly:""},null,8,["modelValue"]),_("div",ce,[n(u,{modelValue:l.value.eq_name,"onUpdate:modelValue":e[10]||(e[10]=a=>l.value.eq_name=a),label:"설비명",readonly:"",class:"flex-1"},null,8,["modelValue"]),n(s,{icon:"search",color:"primary",onClick:e[11]||(e[11]=a=>Y(l.value.eq_type_code)),class:"h-[38px] mt-[20px]"},{default:r(()=>e[24]||(e[24]=[_("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[_("circle",{cx:"11",cy:"11",r:"8"}),_("path",{d:"m21 21-4.35-4.35"})],-1)])),_:1,__:[24]})]),n(u,{modelValue:l.value.code_label,"onUpdate:modelValue":e[12]||(e[12]=a=>l.value.code_label=a),label:"가동상태",readonly:""},null,8,["modelValue"]),n(u,{"model-value":C(l.value.work_start_time),label:"시작시간",readonly:""},null,8,["model-value"]),n(u,{"model-value":C(l.value.work_end_time),label:"종료시간",readonly:""},null,8,["model-value"]),n(u,{modelValue:l.value.pass_qty,"onUpdate:modelValue":e[13]||(e[13]=a=>l.value.pass_qty=a),modelModifiers:{number:!0},label:"생산수량"},null,8,["modelValue"]),n(h,{modelValue:l.value.end_reason_code,"onUpdate:modelValue":e[14]||(e[14]=a=>l.value.end_reason_code=a),options:$.value,"track-by":"value","value-by":"value","text-by":"label",label:"작업 종료 사유",placeholder:"종료 사유 선택"},null,8,["modelValue","options"]),n(u,{modelValue:l.value.product_qual_qty,"onUpdate:modelValue":e[15]||(e[15]=a=>l.value.product_qual_qty=a),label:"합격 수량",readonly:""},null,8,["modelValue"]),n(u,{modelValue:l.value.process_defective_qty,"onUpdate:modelValue":e[16]||(e[16]=a=>l.value.process_defective_qty=a),label:"불량품 수량",readonly:""},null,8,["modelValue"])]),_("div",pe,[n(s,{color:"primary",onClick:e[17]||(e[17]=a=>f.value?M():W())},{default:r(()=>e[25]||(e[25]=[m(" 작업시작 ")])),_:1,__:[25]}),n(s,{color:"danger",onClick:e[18]||(e[18]=a=>f.value?M():F())},{default:r(()=>e[26]||(e[26]=[m(" 작업종료 ")])),_:1,__:[26]})])])):q.value==="material"?(S(),P("div",ve,[k.value?(S(),P("div",ye,R(k.value),1)):(S(),z(x,{key:1,items:V.value,columns:[{key:"material_code",label:"자재코드"},{key:"material_name",label:"자재명"},{key:"outbound_qty",label:"출고량"}],"track-by":"material_code"},null,8,["items"])),_("div",be,[n(s,{color:"primary",onClick:N},{default:r(()=>e[27]||(e[27]=[m("🔍 자재 내역 검색")])),_:1,__:[27]})])])):ae("",!0),n(oe,{visible:L.value,"onUpdate:visible":e[19]||(e[19]=a=>L.value=a),onApply:X},null,8,["visible"]),n(ue,{modelValue:I.value,"onUpdate:modelValue":e[20]||(e[20]=a=>I.value=a),equipmentList:j.value,onApply:Z},null,8,["modelValue","equipmentList"])])}}}),Ve=te(ke,[["__scopeId","data-v-a1f0e3fd"]]);export{Ve as default};
//# sourceMappingURL=resultManagerPage-BpY2eGh1.js.map
