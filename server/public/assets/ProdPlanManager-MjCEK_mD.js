import{n as f,o as P,f as u,p,i as e,D as g,E as v,F as M,y as C,t as i,v as k,_ as R,b as z,c as D,m as F,k as h,q as w,g as S,G as K}from"./index-KTdWOH4t.js";const A={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},G={class:"bg-white rounded-lg w-[800px] h-[500px] flex flex-col"},J={class:"flex justify-between items-center p-4 border-b"},H={class:"p-4 border-b"},Q={class:"flex-1 overflow-auto p-4"},W={class:"w-full text-sm"},X={key:0},Y={key:1},Z={class:"border p-2"},ee={class:"border p-2"},te={class:"border p-2"},se={class:"border p-2"},oe={class:"border p-2"},re={class:"border p-2 text-center"},le=["onClick"],ae={__name:"OrderSearchModal",emits:["select","close"],setup(q){const a=f(""),c=f([]),m=f(!1),_=async()=>{m.value=!0;try{const l=await k.get("/prodPlan/orders/search",{params:{q:a.value}});l.data?c.value=l.data:c.value=[]}catch{c.value=[]}finally{m.value=!1}},n=l=>l?new Date(l).toLocaleDateString("ko-KR"):"-",s=l=>l?l.toLocaleString():"0";return P(()=>{_()}),(l,b)=>(u(),p("div",A,[e("div",G,[e("div",J,[b[2]||(b[2]=e("h3",{class:"text-lg font-semibold"},"주문 검색",-1)),e("button",{onClick:b[0]||(b[0]=x=>l.$emit("close")),class:"text-xl"},"×")]),e("div",H,[g(e("input",{"onUpdate:modelValue":b[1]||(b[1]=x=>a.value=x),onInput:_,placeholder:"주문번호, 제품명으로 검색",class:"w-full px-3 py-2 border"},null,544),[[v,a.value]])]),e("div",Q,[e("table",W,[b[5]||(b[5]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"border p-2"},"주문번호"),e("th",{class:"border p-2"},"제품정보"),e("th",{class:"border p-2"},"총수량"),e("th",{class:"border p-2"},"주문일"),e("th",{class:"border p-2"},"납기일"),e("th",{class:"border p-2"},"선택")])],-1)),e("tbody",null,[m.value?(u(),p("tr",X,b[3]||(b[3]=[e("td",{colspan:"6",class:"border p-4 text-center"},"검색 중...",-1)]))):c.value.length===0?(u(),p("tr",Y,b[4]||(b[4]=[e("td",{colspan:"6",class:"border p-4 text-center text-gray-500"}," 등록된 주문이 없습니다. ",-1)]))):(u(!0),p(M,{key:2},C(c.value,x=>(u(),p("tr",{key:x.order_id},[e("td",Z,i(x.order_id),1),e("td",ee,i(x.product_summary),1),e("td",te,i(s(x.total_qty)),1),e("td",se,i(n(x.order_date)),1),e("td",oe,i(n(x.delivery_date)),1),e("td",re,[e("button",{onClick:V=>l.$emit("select",x),class:"px-2 py-1 bg-blue-500 text-white text-xs rounded"}," 선택 ",8,le)])]))),128))])])])])]))}},ne={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},de={class:"bg-white rounded-lg w-[600px] h-[450px] flex flex-col"},ue={class:"flex justify-between items-center p-4 border-b"},ie={class:"p-4 border-b"},ce={class:"flex-1 overflow-auto p-4"},pe={class:"w-full text-sm"},_e={class:"border p-2"},be={class:"border p-2"},me={class:"border p-2"},xe={class:"border p-2"},ye={class:"border p-2 text-center"},ge=["onClick"],ve={__name:"PlanProductSearchModal",emits:["select","close"],setup(q){const a=f(""),c=f([]),m=async()=>{try{const _=await k.get("/prodPlan/products/search",{params:{q:a.value}});c.value=_.data||[]}catch{c.value=[]}};return P(()=>{m()}),(_,n)=>(u(),p("div",ne,[e("div",de,[e("div",ue,[n[2]||(n[2]=e("h3",{class:"text-lg font-semibold"},"제품 선택",-1)),e("button",{onClick:n[0]||(n[0]=s=>_.$emit("close")),class:"text-xl"},"×")]),e("div",ie,[g(e("input",{"onUpdate:modelValue":n[1]||(n[1]=s=>a.value=s),onInput:m,placeholder:"제품명 또는 제품코드",class:"w-full px-3 py-2 border"},null,544),[[v,a.value]])]),e("div",ce,[e("table",pe,[n[3]||(n[3]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"border p-2"},"제품코드"),e("th",{class:"border p-2"},"제품명"),e("th",{class:"border p-2"},"단위"),e("th",{class:"border p-2"},"규격"),e("th",{class:"border p-2"},"선택")])],-1)),e("tbody",null,[(u(!0),p(M,null,C(c.value,s=>(u(),p("tr",{key:s.product_code},[e("td",_e,i(s.product_code),1),e("td",be,i(s.product_name),1),e("td",me,i(s.product_unit),1),e("td",xe,i(s.product_stand),1),e("td",ye,[e("button",{onClick:l=>_.$emit("select",s),class:"px-2 py-1 bg-blue-500 text-white text-xs rounded"}," 선택 ",8,ge)])]))),128))])])])])]))}},fe={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},he={class:"bg-white rounded-lg w-[700px] h-[500px] flex flex-col"},we={class:"flex justify-between items-center p-4 border-b"},ke={class:"p-4 border-b"},$e={class:"flex-1 overflow-auto p-4"},Pe={class:"w-full text-sm"},Me={class:"border p-2"},Ce={class:"border p-2"},qe={class:"border p-2"},Se={class:"border p-2"},Ve={class:"border p-2"},De={class:"border p-2 text-center"},Ue=["onClick"],je={__name:"ProdPlanSearchModal",emits:["select","close"],setup(q){const a=f(""),c=f([]),m=async()=>{try{const n=await k.get("/prodPlan/search",{params:{q:a.value}});c.value=n.data||[]}catch{c.value=[]}},_=n=>n?new Date(n).toLocaleDateString("ko-KR"):"-";return P(()=>{m()}),(n,s)=>(u(),p("div",fe,[e("div",he,[e("div",we,[s[2]||(s[2]=e("h3",{class:"text-lg font-semibold"},"생산계획 선택",-1)),e("button",{onClick:s[0]||(s[0]=l=>n.$emit("close")),class:"text-xl"},"×")]),e("div",ke,[g(e("input",{"onUpdate:modelValue":s[1]||(s[1]=l=>a.value=l),onInput:m,placeholder:"계획 ID 또는 제품명",class:"w-full px-3 py-2 border"},null,544),[[v,a.value]])]),e("div",$e,[e("table",Pe,[s[3]||(s[3]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"border p-2"},"계획 ID"),e("th",{class:"border p-2"},"제품정보요약"),e("th",{class:"border p-2"},"총 수량"),e("th",{class:"border p-2"},"시작예정일"),e("th",{class:"border p-2"},"종료예정일"),e("th",{class:"border p-2"},"선택")])],-1)),e("tbody",null,[(u(!0),p(M,null,C(c.value,l=>(u(),p("tr",{key:l.plan_id},[e("td",Me,i(l.plan_id),1),e("td",Ce,i(l.product_summary),1),e("td",qe,i(l.total_qty),1),e("td",Se,i(_(l.plan_start_dt)),1),e("td",Ve,i(_(l.plan_end_dt)),1),e("td",De,[e("button",{onClick:b=>n.$emit("select",l),class:"px-2 py-1 bg-blue-500 text-white text-xs rounded"}," 선택 ",8,Ue)])]))),128))])])])])]))}},Ie={class:"max-w-[1060px] h-[739px] mx-auto p-4 bg-gray-50 overflow-hidden"},Oe={class:"mb-3"},Te={class:"text-2xl font-bold text-gray-800"},Be={class:"text-sm font-normal text-gray-500 ml-2"},Le={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",style:{height:"calc(100% - 60px)"}},Ne={class:"grid grid-cols-2 gap-3 mb-4"},Ee={class:"flex"},Re={class:"flex"},ze={class:"grid grid-cols-2 gap-3 mb-4"},Fe={class:"grid grid-cols-4 gap-3 mb-4"},Ke={class:"flex flex-col",style:{height:"calc(100% - 200px)"}},Ae={class:"flex justify-between items-center mb-3"},Ge={key:0,class:"flex gap-2"},Je=["disabled"],He={class:"flex-1 overflow-auto border border-gray-200 rounded mb-4"},Qe={class:"w-full text-xs border-collapse bg-white"},We={class:"bg-gray-50 sticky top-0"},Xe={key:0,class:"border border-gray-200 px-2 py-1.5 text-center font-medium text-gray-700"},Ye={key:0},Ze=["colspan"],et={key:0,class:"border border-gray-200 px-2 py-1.5 text-center"},tt=["onUpdate:modelValue"],st={class:"border border-gray-200 px-2 py-1.5"},ot={class:"border border-gray-200 px-2 py-1.5"},rt={class:"border border-gray-200 px-2 py-1.5"},lt={class:"border border-gray-200 px-2 py-1.5"},at={class:"border border-gray-200 px-2 py-1.5"},nt={class:"border border-gray-200 px-2 py-1.5"},dt=["onUpdate:modelValue"],ut={key:0,class:"flex gap-3 justify-center"},it=["disabled"],ct={__name:"ProdPlanManager",setup(q){const a=z(),c=f(!1),m=f(!1),_=f(!1),n=f(!1),s=f({plan_id:"",plan_name:"",order_id:"",employee_name:"",writer_name:"",plan_reg_dt:"",plan_start_dt:"",plan_end_dt:"",plan_remark:"",products:[]}),l=(d="이 작업")=>a.canManageProduction?!0:(alert(a.getPermissionMessage("production")||"생산 관리 권한이 없습니다."),!1),b=D(()=>s.value.products.some(d=>d.selected)),x=D(()=>s.value.employee_name&&s.value.plan_name&&s.value.plan_start_dt&&s.value.plan_end_dt&&s.value.products.length>0&&a.canManageProduction),V=()=>{l("제품 추가")&&(m.value=!0)},U=()=>{_.value=!0},j=()=>{n.value=!0},I=async d=>{if(s.value.order_id=d.order_id,_.value=!1,!!a.canManageProduction)try{const t=await k.get(`/prodPlan/order/${d.order_id}`);t.data&&t.data.products&&(s.value.products=[],t.data.products.forEach((r,o)=>{s.value.products.push({product_code:r.product_code,product_name:r.product_name,product_unit:r.product_unit,product_stand:r.product_stand,process_group_code:r.process_group_code||"",plan_qty:r.remain_qty||r.order_qty,selected:!1})}))}catch{alert("주문 제품 정보를 불러오는데 실패했습니다.")}},O=async d=>{try{const t=await k.get(`/prodPlan/${d.plan_id}`);if(t.data&&t.data.master){const{master:r,products:o}=t.data,$=y=>y?new Date(y).toISOString().split("T")[0]:"";s.value={plan_id:r.plan_id||"",plan_name:r.plan_name||"",order_id:r.order_id||"",employee_name:r.employee_name||"",writer_name:r.employee_name||"",plan_reg_dt:$(r.plan_reg_dt),plan_start_dt:$(r.plan_start_dt),plan_end_dt:$(r.plan_end_dt),plan_remark:r.plan_remark||"",products:(o||[]).map((y,E)=>({product_code:y.product_code||"",product_name:y.product_name||"",product_unit:y.product_unit||"",product_stand:y.product_stand||"",process_group_code:y.process_group_code||"",plan_qty:y.plan_qty||null,selected:!1}))},c.value=!0}else alert("생산계획 정보가 올바르지 않습니다.");n.value=!1}catch{alert("생산계획 정보를 불러오는데 실패했습니다.")}},T=d=>{if(!l("제품 추가")||s.value.products.find(o=>o.product_code===d.product_code))return;const r={product_code:d.product_code,product_name:d.product_name,product_unit:d.product_unit,product_stand:d.product_stand,process_group_code:d.process_group_code||"",plan_qty:null,selected:!1};s.value.products.push(r),m.value=!1},B=()=>{!l("제품 제거")||s.value.products.filter(t=>t.selected).length===0||(s.value.products=s.value.products.filter(t=>!t.selected))},L=async()=>{var d;if(l("생산계획 저장")){if(!x.value){alert("계획명, 작성자, 시작일, 종료일, 제품을 모두 입력해주세요.");return}try{const t={master:{...c.value&&s.value.plan_id&&{plan_id:s.value.plan_id},plan_name:s.value.plan_name,order_id:s.value.order_id||null,employee_name:s.value.employee_name||((d=a.user)==null?void 0:d.employee_name)||"",plan_reg_dt:s.value.plan_reg_dt,plan_start_dt:s.value.plan_start_dt,plan_end_dt:s.value.plan_end_dt,plan_remark:s.value.plan_remark||""},products:s.value.products.map(o=>({product_code:o.product_code,plan_qty:o.plan_qty||null,process_group_code:o.process_group_code||""}))};let r;c.value&&s.value.plan_id?(r=await k.put("/prodPlan",t),alert("생산계획 수정 완료")):(r=await k.post("/prodPlan",t),alert("생산계획 등록 완료"),r.data&&r.data.plan_id&&(s.value.plan_id=r.data.plan_id,c.value=!0))}catch(t){t.response?t.response.data&&t.response.data.error?alert(`저장 실패: ${t.response.data.error}`):alert(`저장 실패 (${t.response.status}): ${JSON.stringify(t.response.data)}`):alert("생산계획 저장에 실패했습니다.")}}},N=()=>{var t,r;if(!l("폼 초기화"))return;const d=new Date().toISOString().split("T")[0];s.value={plan_id:"",plan_name:"",order_id:"",employee_name:((t=a.user)==null?void 0:t.employee_name)||"",writer_name:((r=a.user)==null?void 0:r.employee_name)||"",plan_reg_dt:d,plan_start_dt:"",plan_end_dt:"",plan_remark:"",products:[]},c.value=!1};return P(()=>{var t,r;a.canManageProduction||alert("조회만 가능합니다. 생산 관리 권한이 없습니다.");const d=new Date().toISOString().split("T")[0];s.value.plan_reg_dt=d,s.value.employee_name=((t=a.user)==null?void 0:t.employee_name)||"",s.value.writer_name=((r=a.user)==null?void 0:r.employee_name)||"",s.value.plan_id=""}),(d,t)=>{var r;return u(),p("div",Ie,[e("div",Oe,[e("h1",Te,[t[11]||(t[11]=F(" 생산계획 관리 ")),e("span",Be," ("+i(((r=h(a).user)==null?void 0:r.employee_name)||"사용자")+") ",1)])]),e("div",Le,[e("div",Ne,[e("div",null,[t[13]||(t[13]=e("label",{class:"block text-xs font-medium text-blue-600 mb-1"},"계획번호",-1)),e("div",Ee,[g(e("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>s.value.plan_id=o),class:"flex-1 px-2 py-1.5 border border-gray-300 rounded-l-md text-xs bg-gray-50",readonly:""},null,512),[[v,s.value.plan_id]]),e("button",{onClick:j,class:"px-2 bg-blue-500 text-white rounded-r-md hover:bg-blue-600 text-xs flex items-center justify-center",title:"기존 계획 불러오기"},t[12]||(t[12]=[e("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("circle",{cx:"11",cy:"11",r:"8"}),e("path",{d:"m21 21-4.35-4.35"})],-1)]))])]),e("div",null,[t[15]||(t[15]=e("label",{class:"block text-xs font-medium text-blue-600 mb-1"},"주문번호",-1)),e("div",Re,[g(e("input",{"onUpdate:modelValue":t[1]||(t[1]=o=>s.value.order_id=o),class:"flex-1 px-2 py-1.5 border border-gray-300 rounded-l-md text-xs bg-gray-50",readonly:""},null,512),[[v,s.value.order_id]]),e("button",{onClick:U,class:"px-2 bg-blue-500 text-white rounded-r-md hover:bg-blue-600 text-xs flex items-center justify-center"},t[14]||(t[14]=[e("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("circle",{cx:"11",cy:"11",r:"8"}),e("path",{d:"m21 21-4.35-4.35"})],-1)]))])])]),e("div",ze,[e("div",null,[t[16]||(t[16]=e("label",{class:"block text-xs font-medium text-blue-600 mb-1"},"계획명 *",-1)),g(e("input",{"onUpdate:modelValue":t[2]||(t[2]=o=>s.value.plan_name=o),class:"w-full px-2 py-1.5 border border-gray-300 rounded-md text-xs focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"생산계획명을 입력해주세요",required:""},null,512),[[v,s.value.plan_name]])]),e("div",null,[t[17]||(t[17]=e("label",{class:"block text-xs font-medium text-blue-600 mb-1"},"작성자",-1)),g(e("input",{"onUpdate:modelValue":t[3]||(t[3]=o=>s.value.writer_name=o),class:"w-full px-2 py-1.5 border border-gray-300 rounded-md text-xs bg-gray-50",readonly:"",placeholder:"로그인된 사용자"},null,512),[[v,s.value.writer_name]])])]),e("div",Fe,[e("div",null,[t[18]||(t[18]=e("label",{class:"block text-xs font-medium text-blue-600 mb-1"},"등록일",-1)),g(e("input",{"onUpdate:modelValue":t[4]||(t[4]=o=>s.value.plan_reg_dt=o),type:"date",class:"w-full px-2 py-1.5 border border-gray-300 rounded-md text-xs bg-gray-50",readonly:""},null,512),[[v,s.value.plan_reg_dt]])]),e("div",null,[t[19]||(t[19]=e("label",{class:"block text-xs font-medium text-blue-600 mb-1"},"계획시작일 *",-1)),g(e("input",{"onUpdate:modelValue":t[5]||(t[5]=o=>s.value.plan_start_dt=o),type:"date",class:"w-full px-2 py-1.5 border border-gray-300 rounded-md text-xs focus:outline-none focus:ring-1 focus:ring-blue-500",required:""},null,512),[[v,s.value.plan_start_dt]])]),e("div",null,[t[20]||(t[20]=e("label",{class:"block text-xs font-medium text-blue-600 mb-1"},"계획종료일 *",-1)),g(e("input",{"onUpdate:modelValue":t[6]||(t[6]=o=>s.value.plan_end_dt=o),type:"date",class:"w-full px-2 py-1.5 border border-gray-300 rounded-md text-xs focus:outline-none focus:ring-1 focus:ring-blue-500",required:""},null,512),[[v,s.value.plan_end_dt]])]),e("div",null,[t[21]||(t[21]=e("label",{class:"block text-xs font-medium text-blue-600 mb-1"},"비고",-1)),g(e("input",{"onUpdate:modelValue":t[7]||(t[7]=o=>s.value.plan_remark=o),class:"w-full px-2 py-1.5 border border-gray-300 rounded-md text-xs focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"비고 입력"},null,512),[[v,s.value.plan_remark]])])]),e("div",Ke,[e("div",Ae,[t[22]||(t[22]=e("label",{class:"text-sm font-medium text-blue-600"},"제품 목록",-1)),h(a).canManageProduction?(u(),p("div",Ge,[e("button",{onClick:B,class:"px-3 py-1.5 bg-red-500 text-white text-xs rounded hover:bg-red-600 transition-colors disabled:opacity-50",disabled:!b.value}," 제거 ",8,Je),e("button",{onClick:V,class:"px-3 py-1.5 bg-green-600 text-white text-xs rounded hover:bg-green-700 transition-colors"}," 제품 추가 ")])):w("",!0)]),e("div",He,[e("table",Qe,[e("thead",We,[e("tr",null,[h(a).canManageProduction?(u(),p("th",Xe,"#")):w("",!0),t[23]||(t[23]=e("th",{class:"border border-gray-200 px-2 py-1.5 text-left font-medium text-gray-700"},"제품코드",-1)),t[24]||(t[24]=e("th",{class:"border border-gray-200 px-2 py-1.5 text-left font-medium text-gray-700"},"제품명",-1)),t[25]||(t[25]=e("th",{class:"border border-gray-200 px-2 py-1.5 text-left font-medium text-gray-700"},"단위",-1)),t[26]||(t[26]=e("th",{class:"border border-gray-200 px-2 py-1.5 text-left font-medium text-gray-700"},"규격",-1)),t[27]||(t[27]=e("th",{class:"border border-gray-200 px-2 py-1.5 text-left font-medium text-gray-700"},"공정그룹코드",-1)),t[28]||(t[28]=e("th",{class:"border border-gray-200 px-2 py-1.5 text-center font-medium text-gray-700"},"계획수량",-1))])]),e("tbody",null,[s.value.products.length===0?(u(),p("tr",Ye,[e("td",{colspan:h(a).canManageProduction?7:6,class:"text-center text-gray-500 py-8"}," 등록된 제품이 없습니다. 제품을 추가해주세요. ",8,Ze)])):(u(!0),p(M,{key:1},C(s.value.products,(o,$)=>(u(),p("tr",{key:$,class:"hover:bg-gray-50"},[h(a).canManageProduction?(u(),p("td",et,[g(e("input",{type:"checkbox","onUpdate:modelValue":y=>o.selected=y,class:"rounded w-3 h-3"},null,8,tt),[[K,o.selected]])])):w("",!0),e("td",st,i(o.product_code),1),e("td",ot,i(o.product_name),1),e("td",rt,i(o.product_unit),1),e("td",lt,i(o.product_stand),1),e("td",at,i(o.process_group_code),1),e("td",nt,[g(e("input",{"onUpdate:modelValue":y=>o.plan_qty=y,type:"number",min:"1",step:"1",class:"w-20 px-1 py-0.5 border border-gray-300 rounded text-xs text-center focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"수량"},null,8,dt),[[v,o.plan_qty,void 0,{number:!0}]])])]))),128))])])]),h(a).canManageProduction?(u(),p("div",ut,[e("button",{onClick:L,class:"px-6 py-2 bg-blue-600 text-white rounded text-sm hover:bg-blue-700 transition-colors font-medium disabled:opacity-50",disabled:!x.value},i(c.value?"수정":"저장"),9,it),e("button",{onClick:N,class:"px-6 py-2 bg-gray-500 text-white rounded text-sm hover:bg-gray-600 transition-colors font-medium"}," 초기화 ")])):w("",!0)])]),m.value&&h(a).canManageProduction?(u(),S(ve,{key:0,onSelect:T,onClose:t[8]||(t[8]=o=>m.value=!1)})):w("",!0),_.value?(u(),S(ae,{key:1,onSelect:I,onClose:t[9]||(t[9]=o=>_.value=!1)})):w("",!0),n.value?(u(),S(je,{key:2,onSelect:O,onClose:t[10]||(t[10]=o=>n.value=!1)})):w("",!0)])}}},_t=R(ct,[["__scopeId","data-v-53a0cc1f"]]);export{_t as default};
//# sourceMappingURL=ProdPlanManager-MjCEK_mD.js.map
