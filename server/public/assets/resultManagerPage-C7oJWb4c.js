import{d as A,n as d,c as E,e as z,w as s,g as c,h as S,i,j as r,m as _,o as le,p as P,q as ae,t as R,v,_ as te}from"./index-1iuYf_qr.js";import{_ as oe}from"./ProductSearchModal.vue_vue_type_script_setup_true_lang-BrijEXjH.js";const ne={class:"va-row va-gap-2 va-mb-4"},re=A({__name:"EquipmentSearchModal",props:{modelValue:{type:Boolean},equipmentList:{}},emits:["update:modelValue","apply"],setup(B,{emit:D}){const $=B,b=D,l=d(""),g=E(()=>{const m=l.value.trim().toLowerCase();return m?$.equipmentList.filter(o=>{var p,q;return((p=o.eq_name)==null?void 0:p.toLowerCase().includes(m))||((q=o.eq_id)==null?void 0:q.toLowerCase().includes(m))}):$.equipmentList}),V=[{key:"eq_id",label:"설비 ID"},{key:"eq_name",label:"설비명"},{key:"code_label",label:"상태"},{key:"action",label:"선택",width:100}],k=m=>{b("apply",m),b("update:modelValue",!1)};return(m,o)=>{const p=c("va-input"),q=c("va-button"),U=c("va-data-table"),N=c("va-modal");return S(),z(N,{"model-value":m.modelValue,"onUpdate:modelValue":o[1]||(o[1]=y=>m.$emit("update:modelValue",y)),size:"large"},{title:s(()=>o[2]||(o[2]=[_("설비 검색")])),default:s(()=>[i("div",ne,[r(p,{modelValue:l.value,"onUpdate:modelValue":o[0]||(o[0]=y=>l.value=y),placeholder:"설비명 또는 ID 검색"},null,8,["modelValue"])]),r(U,{items:g.value,columns:V,"track-by":"eq_id"},{"cell(action)":s(({row:y})=>[r(q,{size:"small",onClick:M=>k(y.rowData)},{default:s(()=>o[3]||(o[3]=[_("선택")])),_:2,__:[3]},1032,["onClick"])]),_:1},8,["items"])]),_:1},8,["model-value"])}}}),se={class:"va-pa-4"},ue={class:"search-grid"},de={class:"button-group"},ie={class:"va-mt-6 tab-toggle"},_e={key:0,class:"input-layout"},ce={class:"input-grid"},me={class:"flex items-center gap-1"},pe={class:"side-buttons"},ve={key:1},be={key:0,class:"va-text-danger va-mb-2"},ke={class:"va-mb-3"},ye=A({__name:"resultManagerPage",setup(B){const D=()=>({result_id:"",result_detail:0,product_name:"",product_stand:"",process_code:"",process_name:"",eq_id:"",eq_name:"",code_label:"",work_start_date:"",work_start_time:"",work_end_time:"",work_order_qty:0,pass_qty:0,product_qual_qty:"",result_code_label:"",detail_code_label:"",manager_id:"",eq_type_code:"",selected:!1,result_remark:"",end_reason_code:"",process_defective_qty:""}),$=d([]),b=d([]),l=d(D()),g=d("input"),V=d([]),k=d(""),m=[{key:"select",label:"선택",width:40},{key:"result_id",label:"실적ID"},{key:"product_name",label:"제품명"},{key:"product_stand",label:"제품규격"},{key:"process_code",label:"공정코드"},{key:"process_name",label:"공정명"},{key:"work_start_time",label:"시작시간"},{key:"work_end_time",label:"종료시간"},{key:"process_time",label:"예상시간(분)"},{key:"duration",label:"소요시간(분)"},{key:"work_order_qty",label:"요청수량"},{key:"pass_qty",label:"재작수량"},{key:"detail_code_label",label:"진행상태"},{key:"manager_id",label:"작업자"}],o=d({workOrder:"",workDate:"",resultId:"",productName:"",productSpec:"",worker:""}),p=d([]),q=async()=>{try{const e=(await v.get("/endEq")).data;p.value=e.map(n=>({code_label:n.code_label??n.label??"",code_value:n.code_value??n.value??""})),console.log("✅ endReasonList:",p.value),console.log("✅ endReasonOptions:",U.value)}catch(t){console.error("작업종료 사유 코드 불러오기 실패",t)}};console.log("✅ endReasonList:",p.value);const U=E(()=>p.value.map(t=>({value:String(t.code_value??""),label:String(t.code_label??"")}))),N=async()=>{if(!l.value.result_id||!l.value.process_code){k.value="⚠️ 공정을 선택해주세요.",V.value=[];return}try{const t=await v.get(`/materialOutbound/${l.value.process_code}`);t.data.length===0?(k.value="🔍 출고된 자재 내역이 없습니다.",V.value=[]):(V.value=t.data,k.value="")}catch(t){k.value="❌ 자재 내역 조회 실패",V.value=[],console.error(t)}},y=E(()=>l.value.process_name==="포장"),M=()=>{alert(`📦 포장 공정은 포장 팀에서 처리합니다.
작업을 시작/종료할 수 없습니다.`)},W=async()=>{var u;const t=l.value.code_label,e=Number((u=l.value.process_code.match(/\d+$/))==null?void 0:u[0])||0,n=b.value.find(f=>{var O;const x=Number((O=f.process_code.match(/\d+$/))==null?void 0:O[0])||0;return f.result_id===l.value.result_id&&x<e&&f.detail_code_label!=="완료"});if(n){alert(`⚠️ 이전 공정 "${n.process_name}"의 진행상태가 '${n.detail_code_label}'입니다.
완료 후 다음 공정을 시작해주세요.`);return}if(t==="가동 중"){alert(`⚠️ 현재 설비는 가동중입니다.
가동이 종료되고 점검 및 청소가 완료된 후 사용하십시오.`);return}if(t==="정지"){alert(`⚠️ 현재 설비는 정지 상태입니다.
점검 및 청소가 모두 완료되기를 기다려주세요.`);return}const w=new Date;l.value.work_start_time=w.toISOString(),l.value.work_start_date=w.toISOString().split("T")[0];try{e===1&&await v.put(`/workResultStatus/${l.value.result_id}`),await v.put(`/prodResult/${l.value.result_detail}`,{pass_qty:l.value.pass_qty??0,manager_id:l.value.manager_id??"",eq_id:l.value.eq_id??""}),await v.put(`/eqStatus/${l.value.eq_id}`),alert("✅ 작업이 시작되었습니다."),T()}catch(f){alert("❌ 설비 상태 업데이트에 실패했습니다."),console.error(f)}},F=async()=>{var w;if(!l.value.result_detail){alert("⚠️ 작업 실적이 선택되지 않았습니다.");return}if((typeof l.value.end_reason_code=="string"?l.value.end_reason_code:((w=l.value.end_reason_code)==null?void 0:w.value)??"").trim()===""){alert("⚠️ 종료 사유(비고)를 작성해주세요.");return}const n=new Date().toISOString();l.value.work_end_time=n;try{await v.put(`/prodResultStop/${l.value.result_detail}`,{pass_qty:l.value.pass_qty,result_remark:l.value.end_reason_code}),await v.put(`/eqStop/${l.value.eq_id}`,{stop_reason:l.value.end_reason_code}),alert("✅ 작업이 종료되었습니다."),l.value=D(),T()}catch(u){console.error(u),alert("❌ 작업 종료 처리 중 오류가 발생했습니다.")}},C=t=>t?new Date(t).toLocaleTimeString("ko-KR",{hour:"2-digit",minute:"2-digit"}):"-",K=(t,e)=>{if(!t||!e)return"-";const n=new Date(t),u=new Date(e).getTime()-n.getTime();return`${Math.floor(u/6e4)}분`},G=(t,e)=>{b.value.forEach(n=>n.selected=!1),t.selected=e,e&&(l.value={...t})},T=async()=>{try{if(!o.value.workOrder){alert("작업지시서 번호를 입력하세요.");return}const e=(await v.get(`/prodResult/${o.value.workOrder}/${o.value.productSpec}`)).data.map(n=>({...n,code_label:n.cq_code_label,detail_code_label:n.cd_code_label,result_code_label:n.cm_code_label,selected:!1}));if(e.length===0){alert("자재를 출고하세요.!"),l.value=Object.assign(D(),{product_name:o.value.productName,product_stand:o.value.productSpec,result_id:o.value.resultId,manager_id:o.value.worker});return}$.value=e,b.value=e}catch{alert("조회 실패: 존재하지 않는 작업지시서일 수 있습니다.")}},H=async()=>{await T()},J=()=>{o.value={workOrder:"",workDate:"",resultId:"",productName:"",productSpec:"",worker:""},b.value=[],$.value=[]},L=d(!1),Q=()=>{L.value=!0},X=t=>{o.value.productName=t.product_name,o.value.productSpec=t.product_stand,o.value.workOrder=t.work_order_no,o.value.resultId=t.result_id,l.value.result_id=t.result_id,L.value=!1},I=d(!1),j=d([]),Y=async t=>{try{console.log(t);const e=await v.get(`/equipment/${t}`);j.value=e.data,console.log(e.data),I.value=!0}catch{alert("설비 데이터를 불러오지 못했습니다.")}},Z=t=>{l.value.eq_id=t.eq_id,l.value.eq_name=t.eq_name,l.value.code_label=t.code_label,I.value=!1};return le(()=>{q()}),(t,e)=>{const n=c("va-input"),w=c("va-date-input"),u=c("va-button"),f=c("va-checkbox"),x=c("va-data-table"),O=c("va-button-toggle"),h=c("va-select");return S(),P("div",se,[i("div",ue,[r(n,{modelValue:o.value.workOrder,"onUpdate:modelValue":e[0]||(e[0]=a=>o.value.workOrder=a),label:"작업지시서 번호",placeholder:"작업지시서 번호 입력",readonly:""},null,8,["modelValue"]),r(n,{modelValue:o.value.productName,"onUpdate:modelValue":e[1]||(e[1]=a=>o.value.productName=a),label:"제품명",placeholder:"제품명 입력",readonly:""},null,8,["modelValue"]),r(n,{modelValue:o.value.productSpec,"onUpdate:modelValue":e[2]||(e[2]=a=>o.value.productSpec=a),label:"제품규격",placeholder:"제품 규격 입력",readonly:""},null,8,["modelValue"]),r(n,{modelValue:o.value.resultId,"onUpdate:modelValue":e[3]||(e[3]=a=>o.value.resultId=a),label:"작업실적 ID",placeholder:"작업 실적 ID 입력",readonly:""},null,8,["modelValue"]),r(w,{modelValue:o.value.workDate,"onUpdate:modelValue":e[4]||(e[4]=a=>o.value.workDate=a),label:"작업일자","manual-input":!1,clearable:!0},null,8,["modelValue"]),i("div",de,[r(u,{color:"info",onClick:Q},{default:s(()=>e[19]||(e[19]=[_("작업지시 검색")])),_:1,__:[19]}),r(u,{color:"primary",onClick:H},{default:s(()=>e[20]||(e[20]=[_("조회")])),_:1,__:[20]}),r(u,{color:"secondary",onClick:J},{default:s(()=>e[21]||(e[21]=[_("초기화")])),_:1,__:[21]})])]),r(x,{items:b.value,columns:m,"track-by":"result_id"},{"cell(select)":s(({row:a})=>[r(f,{"model-value":a.rowData.selected,"onUpdate:modelValue":ee=>G(a.rowData,ee)},null,8,["model-value","onUpdate:modelValue"])]),"cell(work_start_time)":s(({row:a})=>[_(R(C(a.rowData.work_start_time)),1)]),"cell(work_end_time)":s(({row:a})=>[_(R(C(a.rowData.work_end_time)),1)]),"cell(duration)":s(({row:a})=>[_(R(K(a.rowData.work_start_time,a.rowData.work_end_time)),1)]),_:1},8,["items"]),i("div",ie,[r(O,{modelValue:g.value,"onUpdate:modelValue":e[5]||(e[5]=a=>g.value=a),options:[{label:"작업실적 입력",value:"input"},{label:"자재 내역",value:"material"}],color:"primary","toggle-color":"primary"},null,8,["modelValue"])]),g.value==="input"?(S(),P("div",_e,[i("div",ce,[r(n,{modelValue:l.value.process_code,"onUpdate:modelValue":e[6]||(e[6]=a=>l.value.process_code=a),label:"공정코드",readonly:""},null,8,["modelValue"]),r(n,{modelValue:l.value.manager_id,"onUpdate:modelValue":e[7]||(e[7]=a=>l.value.manager_id=a),label:"작업자명"},null,8,["modelValue"]),r(n,{modelValue:l.value.product_name,"onUpdate:modelValue":e[8]||(e[8]=a=>l.value.product_name=a),label:"제품명",readonly:""},null,8,["modelValue"]),r(n,{modelValue:l.value.product_stand,"onUpdate:modelValue":e[9]||(e[9]=a=>l.value.product_stand=a),label:"제품규격",readonly:""},null,8,["modelValue"]),i("div",me,[r(n,{modelValue:l.value.eq_name,"onUpdate:modelValue":e[10]||(e[10]=a=>l.value.eq_name=a),label:"설비명",readonly:"",class:"flex-1"},null,8,["modelValue"]),r(u,{icon:"search",color:"primary",onClick:e[11]||(e[11]=a=>Y(l.value.eq_type_code)),class:"h-[38px] mt-[20px]"},{default:s(()=>e[22]||(e[22]=[i("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[i("circle",{cx:"11",cy:"11",r:"8"}),i("path",{d:"m21 21-4.35-4.35"})],-1)])),_:1,__:[22]})]),r(n,{modelValue:l.value.code_label,"onUpdate:modelValue":e[12]||(e[12]=a=>l.value.code_label=a),label:"가동상태",readonly:""},null,8,["modelValue"]),r(n,{"model-value":C(l.value.work_start_time),label:"시작시간",readonly:""},null,8,["model-value"]),r(n,{"model-value":C(l.value.work_end_time),label:"종료시간",readonly:""},null,8,["model-value"]),r(n,{modelValue:l.value.pass_qty,"onUpdate:modelValue":e[13]||(e[13]=a=>l.value.pass_qty=a),modelModifiers:{number:!0},label:"생산수량"},null,8,["modelValue"]),r(h,{modelValue:l.value.end_reason_code,"onUpdate:modelValue":e[14]||(e[14]=a=>l.value.end_reason_code=a),options:U.value,"track-by":"value","value-by":"value","text-by":"label",label:"작업 종료 사유",placeholder:"종료 사유 선택"},null,8,["modelValue","options"])]),i("div",pe,[r(u,{color:"primary",onClick:e[15]||(e[15]=a=>y.value?M():W())},{default:s(()=>e[23]||(e[23]=[_(" 작업시작 ")])),_:1,__:[23]}),r(u,{color:"danger",onClick:e[16]||(e[16]=a=>y.value?M():F())},{default:s(()=>e[24]||(e[24]=[_(" 작업종료 ")])),_:1,__:[24]})])])):g.value==="material"?(S(),P("div",ve,[k.value?(S(),P("div",be,R(k.value),1)):(S(),z(x,{key:1,items:V.value,columns:[{key:"material_code",label:"자재코드"},{key:"material_name",label:"자재명"},{key:"outbound_qty",label:"출고량"}],"track-by":"material_code"},null,8,["items"])),i("div",ke,[r(u,{color:"primary",onClick:N},{default:s(()=>e[25]||(e[25]=[_("🔍 자재 내역 검색")])),_:1,__:[25]})])])):ae("",!0),r(oe,{visible:L.value,"onUpdate:visible":e[17]||(e[17]=a=>L.value=a),onApply:X},null,8,["visible"]),r(re,{modelValue:I.value,"onUpdate:modelValue":e[18]||(e[18]=a=>I.value=a),equipmentList:j.value,onApply:Z},null,8,["modelValue","equipmentList"])])}}}),Ve=te(ye,[["__scopeId","data-v-a9924743"]]);export{Ve as default};
//# sourceMappingURL=resultManagerPage-C7oJWb4c.js.map
