import{n as g,o as P,f as d,p as c,i as e,D as x,E as y,F as M,y as C,t as i,v as k,_ as R,b as z,c as D,k as $,q as w,g as S,G as F}from"./index-O14FyZ-J.js";const K={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},A={class:"bg-white rounded-lg w-[800px] h-[500px] flex flex-col"},G={class:"flex justify-between items-center p-4 border-b"},J={class:"p-4 border-b"},H={class:"flex-1 overflow-auto p-4"},Q={class:"w-full text-sm"},W={key:0},X={key:1},Y={class:"border p-2"},Z={class:"border p-2"},ee={class:"border p-2"},te={class:"border p-2"},se={class:"border p-2"},oe={class:"border p-2 text-center"},re=["onClick"],le={__name:"OrderSearchModal",emits:["select","close"],setup(q){const l=g(""),u=g([]),b=g(!1),p=async()=>{b.value=!0;try{const r=await k.get("/prodPlan/orders/search",{params:{q:l.value}});r.data?u.value=r.data:u.value=[]}catch{u.value=[]}finally{b.value=!1}},a=r=>r?new Date(r).toLocaleDateString("ko-KR"):"-",s=r=>r?r.toLocaleString():"0";return P(()=>{p()}),(r,_)=>(d(),c("div",K,[e("div",A,[e("div",G,[_[2]||(_[2]=e("h3",{class:"text-lg font-semibold"},"주문 검색",-1)),e("button",{onClick:_[0]||(_[0]=m=>r.$emit("close")),class:"text-xl"},"×")]),e("div",J,[x(e("input",{"onUpdate:modelValue":_[1]||(_[1]=m=>l.value=m),onInput:p,placeholder:"주문번호, 제품명으로 검색",class:"w-full px-3 py-2 border"},null,544),[[y,l.value]])]),e("div",H,[e("table",Q,[_[5]||(_[5]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"border p-2"},"주문번호"),e("th",{class:"border p-2"},"제품정보"),e("th",{class:"border p-2"},"총수량"),e("th",{class:"border p-2"},"주문일"),e("th",{class:"border p-2"},"납기일"),e("th",{class:"border p-2"},"선택")])],-1)),e("tbody",null,[b.value?(d(),c("tr",W,_[3]||(_[3]=[e("td",{colspan:"6",class:"border p-4 text-center"},"검색 중...",-1)]))):u.value.length===0?(d(),c("tr",X,_[4]||(_[4]=[e("td",{colspan:"6",class:"border p-4 text-center text-gray-500"}," 등록된 주문이 없습니다. ",-1)]))):(d(!0),c(M,{key:2},C(u.value,m=>(d(),c("tr",{key:m.order_id},[e("td",Y,i(m.order_id),1),e("td",Z,i(m.product_summary),1),e("td",ee,i(s(m.total_qty)),1),e("td",te,i(a(m.order_date)),1),e("td",se,i(a(m.delivery_date)),1),e("td",oe,[e("button",{onClick:V=>r.$emit("select",m),class:"px-2 py-1 bg-blue-500 text-white text-xs rounded"}," 선택 ",8,re)])]))),128))])])])])]))}},ae={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},ne={class:"bg-white rounded-lg w-[600px] h-[450px] flex flex-col"},de={class:"flex justify-between items-center p-4 border-b"},ue={class:"p-4 border-b"},ie={class:"flex-1 overflow-auto p-4"},ce={class:"w-full text-sm"},pe={class:"border p-2"},_e={class:"border p-2"},be={class:"border p-2"},me={class:"border p-2"},xe={class:"border p-2 text-center"},ye=["onClick"],ge={__name:"PlanProductSearchModal",emits:["select","close"],setup(q){const l=g(""),u=g([]),b=async()=>{try{const p=await k.get("/prodPlan/products/search",{params:{q:l.value}});u.value=p.data||[]}catch{u.value=[]}};return P(()=>{b()}),(p,a)=>(d(),c("div",ae,[e("div",ne,[e("div",de,[a[2]||(a[2]=e("h3",{class:"text-lg font-semibold"},"제품 선택",-1)),e("button",{onClick:a[0]||(a[0]=s=>p.$emit("close")),class:"text-xl"},"×")]),e("div",ue,[x(e("input",{"onUpdate:modelValue":a[1]||(a[1]=s=>l.value=s),onInput:b,placeholder:"제품명 또는 제품코드",class:"w-full px-3 py-2 border"},null,544),[[y,l.value]])]),e("div",ie,[e("table",ce,[a[3]||(a[3]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"border p-2"},"제품코드"),e("th",{class:"border p-2"},"제품명"),e("th",{class:"border p-2"},"단위"),e("th",{class:"border p-2"},"규격"),e("th",{class:"border p-2"},"선택")])],-1)),e("tbody",null,[(d(!0),c(M,null,C(u.value,s=>(d(),c("tr",{key:s.product_code},[e("td",pe,i(s.product_code),1),e("td",_e,i(s.product_name),1),e("td",be,i(s.product_unit),1),e("td",me,i(s.product_stand),1),e("td",xe,[e("button",{onClick:r=>p.$emit("select",s),class:"px-2 py-1 bg-blue-500 text-white text-xs rounded"}," 선택 ",8,ye)])]))),128))])])])])]))}},ve={class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},fe={class:"bg-white rounded-lg w-[700px] h-[500px] flex flex-col"},he={class:"flex justify-between items-center p-4 border-b"},we={class:"p-4 border-b"},ke={class:"flex-1 overflow-auto p-4"},$e={class:"w-full text-sm"},Pe={class:"border p-2"},Me={class:"border p-2"},Ce={class:"border p-2"},qe={class:"border p-2"},Se={class:"border p-2"},Ve={class:"border p-2 text-center"},De=["onClick"],Ue={__name:"ProdPlanSearchModal",emits:["select","close"],setup(q){const l=g(""),u=g([]),b=async()=>{try{const a=await k.get("/prodPlan/search",{params:{q:l.value}});u.value=a.data||[]}catch{u.value=[]}},p=a=>a?new Date(a).toLocaleDateString("ko-KR"):"-";return P(()=>{b()}),(a,s)=>(d(),c("div",ve,[e("div",fe,[e("div",he,[s[2]||(s[2]=e("h3",{class:"text-lg font-semibold"},"생산계획 선택",-1)),e("button",{onClick:s[0]||(s[0]=r=>a.$emit("close")),class:"text-xl"},"×")]),e("div",we,[x(e("input",{"onUpdate:modelValue":s[1]||(s[1]=r=>l.value=r),onInput:b,placeholder:"계획 ID 또는 제품명",class:"w-full px-3 py-2 border"},null,544),[[y,l.value]])]),e("div",ke,[e("table",$e,[s[3]||(s[3]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"border p-2"},"계획 ID"),e("th",{class:"border p-2"},"제품정보요약"),e("th",{class:"border p-2"},"총 수량"),e("th",{class:"border p-2"},"시작예정일"),e("th",{class:"border p-2"},"종료예정일"),e("th",{class:"border p-2"},"선택")])],-1)),e("tbody",null,[(d(!0),c(M,null,C(u.value,r=>(d(),c("tr",{key:r.plan_id},[e("td",Pe,i(r.plan_id),1),e("td",Me,i(r.product_summary),1),e("td",Ce,i(r.total_qty),1),e("td",qe,i(p(r.plan_start_dt)),1),e("td",Se,i(p(r.plan_end_dt)),1),e("td",Ve,[e("button",{onClick:_=>a.$emit("select",r),class:"px-2 py-1 bg-blue-500 text-white text-xs rounded"}," 선택 ",8,De)])]))),128))])])])])]))}},je={class:"max-w-[1060px] h-[739px] mx-auto p-4 bg-gray-50 overflow-hidden"},Ie={class:"bg-white rounded-lg shadow-sm border border-gray-200 p-4",style:{height:"calc(100% - 60px)"}},Oe={class:"grid grid-cols-2 gap-3 mb-4"},Te={class:"flex"},Be={class:"flex"},Le={class:"grid grid-cols-2 gap-3 mb-4"},Ee={class:"grid grid-cols-4 gap-3 mb-4"},Ne={class:"flex flex-col",style:{height:"calc(100% - 200px)"}},Re={class:"flex justify-between items-center mb-3"},ze={key:0,class:"flex gap-2"},Fe=["disabled"],Ke={class:"flex-1 overflow-auto border border-gray-200 rounded mb-4"},Ae={class:"w-full text-xs border-collapse bg-white"},Ge={class:"bg-gray-50 sticky top-0"},Je={key:0,class:"border border-gray-200 px-2 py-1.5 text-center font-medium text-gray-700"},He={key:0},Qe=["colspan"],We={key:0,class:"border border-gray-200 px-2 py-1.5 text-center"},Xe=["onUpdate:modelValue"],Ye={class:"border border-gray-200 px-2 py-1.5"},Ze={class:"border border-gray-200 px-2 py-1.5"},et={class:"border border-gray-200 px-2 py-1.5"},tt={class:"border border-gray-200 px-2 py-1.5"},st={class:"border border-gray-200 px-2 py-1.5"},ot={class:"border border-gray-200 px-2 py-1.5"},rt=["onUpdate:modelValue"],lt={key:0,class:"flex gap-3 justify-center"},at=["disabled"],nt={__name:"ProdPlanManager",setup(q){const l=z(),u=g(!1),b=g(!1),p=g(!1),a=g(!1),s=g({plan_id:"",plan_name:"",order_id:"",employee_name:"",writer_name:"",plan_reg_dt:"",plan_start_dt:"",plan_end_dt:"",plan_remark:"",products:[]}),r=(n="이 작업")=>l.canManageProduction?!0:(alert(l.getPermissionMessage("production")||"생산 관리 권한이 없습니다."),!1),_=D(()=>s.value.products.some(n=>n.selected)),m=D(()=>s.value.employee_name&&s.value.plan_name&&s.value.plan_start_dt&&s.value.plan_end_dt&&s.value.products.length>0&&l.canManageProduction),V=()=>{r("제품 추가")&&(b.value=!0)},U=()=>{p.value=!0},j=()=>{a.value=!0},I=async n=>{if(s.value.order_id=n.order_id,p.value=!1,!!l.canManageProduction)try{const t=await k.get(`/prodPlan/order/${n.order_id}`);t.data&&t.data.products&&(s.value.products=[],t.data.products.forEach((o,v)=>{s.value.products.push({product_code:o.product_code,product_name:o.product_name,product_unit:o.product_unit,product_stand:o.product_stand,process_group_code:o.process_group_code||"",plan_qty:o.remain_qty||o.order_qty,selected:!1})}))}catch{alert("주문 제품 정보를 불러오는데 실패했습니다.")}},O=async n=>{try{const t=await k.get(`/prodPlan/${n.plan_id}`);if(t.data&&t.data.master){const{master:o,products:v}=t.data,h=f=>f?new Date(f).toISOString().split("T")[0]:"";s.value={plan_id:o.plan_id||"",plan_name:o.plan_name||"",order_id:o.order_id||"",employee_name:o.employee_name||"",writer_name:o.employee_name||"",plan_reg_dt:h(o.plan_reg_dt),plan_start_dt:h(o.plan_start_dt),plan_end_dt:h(o.plan_end_dt),plan_remark:o.plan_remark||"",products:(v||[]).map((f,N)=>({product_code:f.product_code||"",product_name:f.product_name||"",product_unit:f.product_unit||"",product_stand:f.product_stand||"",process_group_code:f.process_group_code||"",plan_qty:f.plan_qty||null,selected:!1}))},u.value=!0}else alert("생산계획 정보가 올바르지 않습니다.");a.value=!1}catch{alert("생산계획 정보를 불러오는데 실패했습니다.")}},T=n=>{if(!r("제품 추가")||s.value.products.find(v=>v.product_code===n.product_code))return;const o={product_code:n.product_code,product_name:n.product_name,product_unit:n.product_unit,product_stand:n.product_stand,process_group_code:n.process_group_code||"",plan_qty:null,selected:!1};s.value.products.push(o),b.value=!1},B=()=>{!r("제품 제거")||s.value.products.filter(t=>t.selected).length===0||(s.value.products=s.value.products.filter(t=>!t.selected))},L=async()=>{var n;if(r("생산계획 저장")){if(!m.value){alert("계획명, 작성자, 시작일, 종료일, 제품을 모두 입력해주세요.");return}try{const t={master:{...u.value&&s.value.plan_id&&{plan_id:s.value.plan_id},plan_name:s.value.plan_name,order_id:s.value.order_id||null,employee_name:s.value.employee_name||((n=l.user)==null?void 0:n.employee_name)||"",plan_reg_dt:s.value.plan_reg_dt,plan_start_dt:s.value.plan_start_dt,plan_end_dt:s.value.plan_end_dt,plan_remark:s.value.plan_remark||""},products:s.value.products.map(v=>({product_code:v.product_code,plan_qty:v.plan_qty||null,process_group_code:v.process_group_code||""}))};let o;u.value&&s.value.plan_id?(o=await k.put("/prodPlan",t),alert("생산계획 수정 완료")):(o=await k.post("/prodPlan",t),alert("생산계획 등록 완료"),o.data&&o.data.plan_id&&(s.value.plan_id=o.data.plan_id,u.value=!0))}catch(t){t.response?t.response.data&&t.response.data.error?alert(`저장 실패: ${t.response.data.error}`):alert(`저장 실패 (${t.response.status}): ${JSON.stringify(t.response.data)}`):alert("생산계획 저장에 실패했습니다.")}}},E=()=>{var t,o;if(!r("폼 초기화"))return;const n=new Date().toISOString().split("T")[0];s.value={plan_id:"",plan_name:"",order_id:"",employee_name:((t=l.user)==null?void 0:t.employee_name)||"",writer_name:((o=l.user)==null?void 0:o.employee_name)||"",plan_reg_dt:n,plan_start_dt:"",plan_end_dt:"",plan_remark:"",products:[]},u.value=!1};return P(()=>{var t,o;l.canManageProduction||alert("조회만 가능합니다. 생산 관리 권한이 없습니다.");const n=new Date().toISOString().split("T")[0];s.value.plan_reg_dt=n,s.value.employee_name=((t=l.user)==null?void 0:t.employee_name)||"",s.value.writer_name=((o=l.user)==null?void 0:o.employee_name)||"",s.value.plan_id=""}),(n,t)=>(d(),c("div",je,[t[28]||(t[28]=e("div",{class:"mb-3"},[e("h1",{class:"text-2xl font-bold text-gray-800"}," 생산계획 관리 ")],-1)),e("div",Ie,[e("div",Oe,[e("div",null,[t[12]||(t[12]=e("label",{class:"block text-xs font-medium text-blue-600 mb-1"},"계획번호",-1)),e("div",Te,[x(e("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>s.value.plan_id=o),class:"flex-1 px-2 py-1.5 border border-gray-300 rounded-l-md text-xs bg-gray-50",readonly:""},null,512),[[y,s.value.plan_id]]),e("button",{onClick:j,class:"px-2 bg-blue-500 text-white rounded-r-md hover:bg-blue-600 text-xs flex items-center justify-center",title:"기존 계획 불러오기"},t[11]||(t[11]=[e("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("circle",{cx:"11",cy:"11",r:"8"}),e("path",{d:"m21 21-4.35-4.35"})],-1)]))])]),e("div",null,[t[14]||(t[14]=e("label",{class:"block text-xs font-medium text-blue-600 mb-1"},"주문번호",-1)),e("div",Be,[x(e("input",{"onUpdate:modelValue":t[1]||(t[1]=o=>s.value.order_id=o),class:"flex-1 px-2 py-1.5 border border-gray-300 rounded-l-md text-xs bg-gray-50",readonly:""},null,512),[[y,s.value.order_id]]),e("button",{onClick:U,class:"px-2 bg-blue-500 text-white rounded-r-md hover:bg-blue-600 text-xs flex items-center justify-center"},t[13]||(t[13]=[e("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("circle",{cx:"11",cy:"11",r:"8"}),e("path",{d:"m21 21-4.35-4.35"})],-1)]))])])]),e("div",Le,[e("div",null,[t[15]||(t[15]=e("label",{class:"block text-xs font-medium text-blue-600 mb-1"},"계획명 *",-1)),x(e("input",{"onUpdate:modelValue":t[2]||(t[2]=o=>s.value.plan_name=o),class:"w-full px-2 py-1.5 border border-gray-300 rounded-md text-xs focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"생산계획명을 입력해주세요",required:""},null,512),[[y,s.value.plan_name]])]),e("div",null,[t[16]||(t[16]=e("label",{class:"block text-xs font-medium text-blue-600 mb-1"},"작성자",-1)),x(e("input",{"onUpdate:modelValue":t[3]||(t[3]=o=>s.value.writer_name=o),class:"w-full px-2 py-1.5 border border-gray-300 rounded-md text-xs bg-gray-50",readonly:"",placeholder:"로그인된 사용자"},null,512),[[y,s.value.writer_name]])])]),e("div",Ee,[e("div",null,[t[17]||(t[17]=e("label",{class:"block text-xs font-medium text-blue-600 mb-1"},"등록일",-1)),x(e("input",{"onUpdate:modelValue":t[4]||(t[4]=o=>s.value.plan_reg_dt=o),type:"date",class:"w-full px-2 py-1.5 border border-gray-300 rounded-md text-xs bg-gray-50",readonly:""},null,512),[[y,s.value.plan_reg_dt]])]),e("div",null,[t[18]||(t[18]=e("label",{class:"block text-xs font-medium text-blue-600 mb-1"},"계획시작일 *",-1)),x(e("input",{"onUpdate:modelValue":t[5]||(t[5]=o=>s.value.plan_start_dt=o),type:"date",class:"w-full px-2 py-1.5 border border-gray-300 rounded-md text-xs focus:outline-none focus:ring-1 focus:ring-blue-500",required:""},null,512),[[y,s.value.plan_start_dt]])]),e("div",null,[t[19]||(t[19]=e("label",{class:"block text-xs font-medium text-blue-600 mb-1"},"계획종료일 *",-1)),x(e("input",{"onUpdate:modelValue":t[6]||(t[6]=o=>s.value.plan_end_dt=o),type:"date",class:"w-full px-2 py-1.5 border border-gray-300 rounded-md text-xs focus:outline-none focus:ring-1 focus:ring-blue-500",required:""},null,512),[[y,s.value.plan_end_dt]])]),e("div",null,[t[20]||(t[20]=e("label",{class:"block text-xs font-medium text-blue-600 mb-1"},"비고",-1)),x(e("input",{"onUpdate:modelValue":t[7]||(t[7]=o=>s.value.plan_remark=o),class:"w-full px-2 py-1.5 border border-gray-300 rounded-md text-xs focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"비고 입력"},null,512),[[y,s.value.plan_remark]])])]),e("div",Ne,[e("div",Re,[t[21]||(t[21]=e("label",{class:"text-sm font-medium text-blue-600"},"제품 목록",-1)),$(l).canManageProduction?(d(),c("div",ze,[e("button",{onClick:B,class:"px-3 py-1.5 bg-red-500 text-white text-xs rounded hover:bg-red-600 transition-colors disabled:opacity-50",disabled:!_.value}," 제거 ",8,Fe),e("button",{onClick:V,class:"px-3 py-1.5 bg-green-600 text-white text-xs rounded hover:bg-green-700 transition-colors"}," 제품 추가 ")])):w("",!0)]),e("div",Ke,[e("table",Ae,[e("thead",Ge,[e("tr",null,[$(l).canManageProduction?(d(),c("th",Je,"#")):w("",!0),t[22]||(t[22]=e("th",{class:"border border-gray-200 px-2 py-1.5 text-left font-medium text-gray-700"},"제품코드",-1)),t[23]||(t[23]=e("th",{class:"border border-gray-200 px-2 py-1.5 text-left font-medium text-gray-700"},"제품명",-1)),t[24]||(t[24]=e("th",{class:"border border-gray-200 px-2 py-1.5 text-left font-medium text-gray-700"},"단위",-1)),t[25]||(t[25]=e("th",{class:"border border-gray-200 px-2 py-1.5 text-left font-medium text-gray-700"},"규격",-1)),t[26]||(t[26]=e("th",{class:"border border-gray-200 px-2 py-1.5 text-left font-medium text-gray-700"},"공정그룹코드",-1)),t[27]||(t[27]=e("th",{class:"border border-gray-200 px-2 py-1.5 text-center font-medium text-gray-700"},"계획수량",-1))])]),e("tbody",null,[s.value.products.length===0?(d(),c("tr",He,[e("td",{colspan:$(l).canManageProduction?7:6,class:"text-center text-gray-500 py-8"}," 등록된 제품이 없습니다. 제품을 추가해주세요. ",8,Qe)])):(d(!0),c(M,{key:1},C(s.value.products,(o,v)=>(d(),c("tr",{key:v,class:"hover:bg-gray-50"},[$(l).canManageProduction?(d(),c("td",We,[x(e("input",{type:"checkbox","onUpdate:modelValue":h=>o.selected=h,class:"rounded w-3 h-3"},null,8,Xe),[[F,o.selected]])])):w("",!0),e("td",Ye,i(o.product_code),1),e("td",Ze,i(o.product_name),1),e("td",et,i(o.product_unit),1),e("td",tt,i(o.product_stand),1),e("td",st,i(o.process_group_code),1),e("td",ot,[x(e("input",{"onUpdate:modelValue":h=>o.plan_qty=h,type:"number",min:"1",step:"1",class:"w-20 px-1 py-0.5 border border-gray-300 rounded text-xs text-center focus:outline-none focus:ring-1 focus:ring-blue-500",placeholder:"수량"},null,8,rt),[[y,o.plan_qty,void 0,{number:!0}]])])]))),128))])])]),$(l).canManageProduction?(d(),c("div",lt,[e("button",{onClick:L,class:"px-6 py-2 bg-blue-600 text-white rounded text-sm hover:bg-blue-700 transition-colors font-medium disabled:opacity-50",disabled:!m.value},i(u.value?"수정":"저장"),9,at),e("button",{onClick:E,class:"px-6 py-2 bg-gray-500 text-white rounded text-sm hover:bg-gray-600 transition-colors font-medium"}," 초기화 ")])):w("",!0)])]),b.value&&$(l).canManageProduction?(d(),S(ge,{key:0,onSelect:T,onClose:t[8]||(t[8]=o=>b.value=!1)})):w("",!0),p.value?(d(),S(le,{key:1,onSelect:I,onClose:t[9]||(t[9]=o=>p.value=!1)})):w("",!0),a.value?(d(),S(Ue,{key:2,onSelect:O,onClose:t[10]||(t[10]=o=>a.value=!1)})):w("",!0)]))}},ut=R(nt,[["__scopeId","data-v-92f14800"]]);export{ut as default};
//# sourceMappingURL=ProdPlanManager-DZlZuh1p.js.map
