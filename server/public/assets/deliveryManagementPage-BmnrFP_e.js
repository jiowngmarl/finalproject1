import{d as x,n as _,o as T,e as f,f as N,p as B,i,j as m,w as p,v as u,m as v,t as L,_ as P}from"./index-BJgCI8mH.js";const U={class:"mrp-page"},V={class:"table-section"},F={class:"table-section"},H={class:"button-wrap"},I=x({__name:"deliveryManagementPage",setup(O){const y=_([]),s=_([]),l=_(null),b=_(1),S=[{key:"work_order_no",label:"요청코드"},{key:"product_unit",label:"단위"},{key:"product_name",label:"제품명"},{key:"product_stand",label:"규격"},{key:"production_qty",label:"요청수량"},{key:"order_start_dt",label:"요청일자",formatter:e=>k(e)},{key:"action",label:"선택"}],w=[{key:"work_order_no",label:"요청코드"},{key:"material_code",label:"자재코드"},{key:"material_name",label:"자재명"},{key:"material_unit",label:"단위"},{key:"quantity",label:"재고량"},{key:"qty",label:"출고 수량"},{key:"lot_number",label:"LOT번호"}],k=e=>{const t=new Date(e),a=new Date(t.getTime()+9*60*60*1e3),d=a.getFullYear(),r=String(a.getMonth()+1).padStart(2,"0"),c=String(a.getDate()).padStart(2,"0"),g=String(a.getHours()).padStart(2,"0"),o=String(a.getMinutes()).padStart(2,"0");return`${d}-${r}-${c} ${g}:${o}`},$=async()=>{try{const e=await u.get("/delivery");y.value=e.data,console.log(e.data)}catch(e){console.error("계획 조회 실패",e)}},h=async e=>{try{l.value=e;const t=await u.get(`/delivery/${e.work_order_no}`);s.value=t.data,console.log("응답 데이터:",t.data)}catch(t){console.error("계산 실패",t)}},q=async()=>{if(!l.value){alert("작업지시를 선택해주세요.");return}if(s.value.find(t=>t.qty>t.quantity)){alert("자재가 부족합니다.! 발주를 넣어주세요.!!!!");return}try{const t=[],a="이승민",d=l.value.work_order_no;for(const o of s.value){const n=new Date,C=n.getFullYear().toString()+(n.getMonth()+1).toString().padStart(2,"0")+n.getDate().toString().padStart(2,"0")+n.getHours().toString().padStart(2,"0")+n.getMinutes().toString().padStart(2,"0")+n.getSeconds().toString().padStart(2,"0"),M=Math.floor(Math.random()*1e3),D=`outbound-${C}-${M}`;t.push({outbound_id:D,work_order_no:d,material_code:o.material_code,outbound_qty:o.qty,name:a,lot_number:o.lot_number})}console.log(t);const r=await u.post("/delivery",t);let c=!0;for(const o of s.value)try{(await u.put(`/delivery/${o.material_code}/${o.lot_number}`,{quantity:o.quantity-o.qty})).data.isSuccessed||(c=!1)}catch(n){console.error("재고 업데이트 실패:",n),c=!1}const g=await u.put(`/delivery/${l.value.work_order_no}`);r.data.isSuccessed&&c&&g.data.isUpdated?(alert("출고가 완료되었습니다."),s.value=[],y.value=[],l.value=null):alert("출고 처리 중 일부 실패가 발생했습니다.")}catch(t){console.error("출고 실패",t),alert("출고 중 오류가 발생했습니다.")}};return T(()=>{$()}),(e,t)=>{const a=f("va-button"),d=f("va-data-table");return N(),B("div",U,[t[5]||(t[5]=i("h2",{class:"page-title"},"자재 출고",-1)),i("div",V,[t[2]||(t[2]=i("h3",{class:"table-title"},"작업지시 리스트",-1)),m(d,{"current-page":b.value,"onUpdate:currentPage":t[0]||(t[0]=r=>b.value=r),items:y.value,columns:S,"per-page":5,"track-by":"work_order_no"},{"cell(order_start_dt)":p(({row:r})=>[v(L(k(r.source.order_start_dt)),1)]),"cell(action)":p(({row:r})=>[m(a,{size:"small",onClick:c=>h(r.source)},{default:p(()=>t[1]||(t[1]=[v(" 선택 ")])),_:2,__:[1]},1032,["onClick"])]),_:1},8,["current-page","items"])]),i("div",F,[t[4]||(t[4]=i("h3",{class:"table-title"},"출고 자재 리스트",-1)),m(d,{items:s.value,columns:w,"track-by":"material_code"},null,8,["items"]),i("div",H,[m(a,{disabled:!l.value,onClick:q},{default:p(()=>t[3]||(t[3]=[v(" 출고 ")])),_:1,__:[3]},8,["disabled"])])])])}}}),Y=P(I,[["__scopeId","data-v-8c11b9e7"]]);export{Y as default};
//# sourceMappingURL=deliveryManagementPage-BmnrFP_e.js.map
