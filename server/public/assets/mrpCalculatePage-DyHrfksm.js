import{d as q,e as y,f as h,g as V,w as c,i as n,m as p,t as w,j as u,_ as T,n as i,o as F,p as N,v}from"./index-BJgCI8mH.js";const U={class:"mb-3"},Y={class:"custom-footer"},z=q({__name:"PlanDetailModal",props:{isOpen:{type:Boolean},products:{}},setup(I){const b=[{key:"product_code",label:"제품 코드"},{key:"product_name",label:"제품명"},{key:"plan_qty",label:"계획 수량"},{key:"product_safty",label:"안전 재고"}],f=o=>{if(!o)return"-";const a=new Date(o),d=new Date(a.getTime()+9*60*60*1e3);return`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-${String(d.getDate()).padStart(2,"0")} ${String(d.getHours()).padStart(2,"0")}:${String(d.getMinutes()).padStart(2,"0")}`};return(o,a)=>{const d=y("va-data-table"),_=y("va-button"),k=y("va-modal");return h(),V(k,{"model-value":o.isOpen,"no-actions":"","onUpdate:modelValue":a[1]||(a[1]=m=>o.$emit("close"))},{default:c(()=>{var m,$,S;return[a[6]||(a[6]=n("h3",{class:"mb-2"},"생산 계획 상세",-1)),n("div",U,[n("div",null,[a[2]||(a[2]=n("strong",null,"계획 ID:",-1)),p(" "+w((m=o.products[0])==null?void 0:m.plan_id),1)]),n("div",null,[a[3]||(a[3]=n("strong",null,"계획명:",-1)),p(" "+w(($=o.products[0])==null?void 0:$.plan_name),1)]),n("div",null,[a[4]||(a[4]=n("strong",null,"등록일:",-1)),p(" "+w(f((S=o.products[0])==null?void 0:S.plan_reg_dt)),1)])]),u(d,{items:o.products,columns:b,class:"mb-4"},null,8,["items"]),n("div",Y,[u(_,{color:"primary",onClick:a[0]||(a[0]=M=>o.$emit("close"))},{default:c(()=>a[5]||(a[5]=[p(" 닫기 ")])),_:1,__:[5]})])]}),_:1,__:[6]},8,["model-value"])}}}),E=T(z,[["__scopeId","data-v-45be33ab"]]),H={class:"mrp-page"},K={class:"table-section"},L={class:"table-section"},j={class:"button-wrap"},A=q({__name:"mrpCalculatePage",setup(I){const b=i([]),f=i([]),o=i([]),a=i(null),d=i(1),_=i(!1);i(null);const k=i([]),m=[{key:"plan_id",label:"계획번호"},{key:"plan_name",label:"계획명"},{key:"plan_reg_dt",label:"등록일",formatter:l=>M(l)},{key:"view",label:"상세보기"},{key:"action",label:"계산"}],$=[{key:"material_code",label:"자재코드"},{key:"material_name",label:"자재명"},{key:"current_stock_qty",label:"재고"},{key:"material_unit",label:"단위"},{key:"material_cls",label:"분류"},{key:"total_needed_qty",label:"필요 수량"},{key:"material_safty",label:"안재 재고 기준"},{key:"shortage_qty",label:"발주 수량"}],S=l=>{k.value=b.value.filter(t=>t.plan_id===l.plan_id),_.value=!0},M=l=>{const t=new Date(l),e=new Date(t.getTime()+9*60*60*1e3),r=e.getFullYear(),s=String(e.getMonth()+1).padStart(2,"0"),g=String(e.getDate()).padStart(2,"0"),C=String(e.getHours()).padStart(2,"0"),D=String(e.getMinutes()).padStart(2,"0");return`${r}-${s}-${g} ${C}:${D}`},P=async()=>{try{const l=await v.get("/mrps");b.value=l.data;const t=new Map;l.data.forEach(e=>{t.has(e.plan_id)||t.set(e.plan_id,{plan_id:e.plan_id,plan_name:e.plan_name,plan_reg_dt:e.plan_reg_dt})}),f.value=Array.from(t.values())}catch(l){console.error("계획 조회 실패",l)}},B=async l=>{try{a.value=l;const t=await v.get(`/mrps/${l.plan_id}`);o.value=t.data,console.log("MRP 응답 데이터:",t.data)}catch(t){console.error("MRP 계산 실패",t)}},O=async()=>{if(!a.value){alert("먼저 생산계획에서 계산 버튼을 눌러주세요.");return}const l=a.value.plan_id;if(o.value.length>0)try{const t=o.value.map(e=>{const r=new Date,s=r.getFullYear(),g=String(r.getMonth()+1).padStart(2,"0"),C=String(r.getDate()).padStart(2,"0"),D=`${s}${g}${C}`,R=Math.floor(100+Math.random()*900);return{purchase_order_id:`${e.material_code}-${D}-${R}`,purchase_order_name:`${e.material_name}-${e.shortage_qty}`,purchase_order_quantity:e.shortage_qty,material_code:e.material_code}});console.log("발주내용:",t);try{const e=await v.post("/puOrder",t),r=await v.put(`/mrps/${l}`);console.log(e.data),console.log(r.data),e.data.isSuccessed&&r.data.isUpdated?(alert("부족 자재 등록 완료!"),await P(),o.value=[],a.value=null):alert("등록 실패")}catch(e){console.error("등록 실패:",e),alert("서버 오류 발생!")}}catch(t){console.error("발주 등록 실패:",t),alert("발주 등록 중 오류가 발생했습니다.")}else try{await v.put(`/mrps/${l}`),alert("부족한 자재가 없어 발주 없이 완료 처리했습니다.")}catch(t){console.error("is_ordered 업데이트 실패:",t),alert("처리 중 오류가 발생했습니다.")}};return F(()=>{P()}),(l,t)=>{const e=y("va-button"),r=y("va-data-table");return h(),N("div",H,[t[7]||(t[7]=n("h2",{class:"page-title"},"MRP 계산",-1)),n("div",K,[t[4]||(t[4]=n("h3",{class:"table-title"},"생산계획 리스트",-1)),u(r,{"current-page":d.value,"onUpdate:currentPage":t[0]||(t[0]=s=>d.value=s),items:f.value,columns:m,"per-page":5,"track-by":"plan_id"},{"cell(plan_reg_dt)":c(({row:s})=>[p(w(M(s.source.plan_reg_dt)),1)]),"cell(view)":c(({row:s})=>[u(e,{size:"small",color:"info",onClick:g=>S(s.source)},{default:c(()=>t[2]||(t[2]=[p(" 상세보기 ")])),_:2,__:[2]},1032,["onClick"])]),"cell(action)":c(({row:s})=>[u(e,{size:"small",onClick:g=>B(s.source)},{default:c(()=>t[3]||(t[3]=[p(" 계산 ")])),_:2,__:[3]},1032,["onClick"])]),_:1},8,["current-page","items"]),u(E,{"is-open":_.value,products:k.value,onClose:t[1]||(t[1]=s=>_.value=!1)},null,8,["is-open","products"])]),n("div",L,[t[6]||(t[6]=n("h3",{class:"table-title"},"부족 자재 리스트",-1)),u(r,{items:o.value,columns:$,"track-by":"material_code"},null,8,["items"]),n("div",j,[u(e,{disabled:!a.value,onClick:O},{default:c(()=>t[5]||(t[5]=[p(" 발주관리 등록 ")])),_:1,__:[5]},8,["disabled"])])])])}}}),J=T(A,[["__scopeId","data-v-3583a30e"]]);export{J as default};
//# sourceMappingURL=mrpCalculatePage-DyHrfksm.js.map
