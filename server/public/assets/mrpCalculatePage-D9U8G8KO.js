import{d as h,e as V,w as c,g as y,h as q,i as n,j as p,m as u,t as w,_ as O,n as i,o as F,p as N,v}from"./index-1iuYf_qr.js";const Y={class:"mb-3"},z={class:"custom-footer"},E=h({__name:"PlanDetailModal",props:{isOpen:{type:Boolean},products:{}},setup(T){const b=[{key:"product_code",label:"제품 코드"},{key:"product_name",label:"제품명"},{key:"plan_qty",label:"계획 수량"},{key:"product_safty",label:"안전 재고"}],f=o=>{if(!o)return"-";const a=new Date(o),d=new Date(a.getTime()+9*60*60*1e3);return`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-${String(d.getDate()).padStart(2,"0")} ${String(d.getHours()).padStart(2,"0")}:${String(d.getMinutes()).padStart(2,"0")}`};return(o,a)=>{const d=y("va-data-table"),_=y("va-button"),k=y("va-modal");return q(),V(k,{"model-value":o.isOpen,"onUpdate:modelValue":a[1]||(a[1]=m=>o.$emit("close")),"no-actions":""},{default:c(()=>{var m,$,S;return[a[6]||(a[6]=n("h3",{class:"mb-2"},"생산 계획 상세",-1)),n("div",Y,[n("div",null,[a[2]||(a[2]=n("strong",null,"계획 ID:",-1)),u(" "+w((m=o.products[0])==null?void 0:m.plan_id),1)]),n("div",null,[a[3]||(a[3]=n("strong",null,"계획명:",-1)),u(" "+w(($=o.products[0])==null?void 0:$.plan_name),1)]),n("div",null,[a[4]||(a[4]=n("strong",null,"등록일:",-1)),u(" "+w(f((S=o.products[0])==null?void 0:S.plan_reg_dt)),1)])]),p(d,{items:o.products,columns:b,class:"mb-4"},null,8,["items"]),n("div",z,[p(_,{color:"primary",onClick:a[0]||(a[0]=M=>o.$emit("close"))},{default:c(()=>a[5]||(a[5]=[u("닫기")])),_:1,__:[5]})])]}),_:1,__:[6]},8,["model-value"])}}}),H=O(E,[["__scopeId","data-v-d881412e"]]),K={class:"mrp-page"},L={class:"table-section"},U={class:"table-section"},j={class:"button-wrap"},A=h({__name:"mrpCalculatePage",setup(T){const b=i([]),f=i([]),o=i([]),a=i(null),d=i(1),_=i(!1);i(null);const k=i([]),m=[{key:"plan_id",label:"계획번호"},{key:"plan_name",label:"계획명"},{key:"plan_reg_dt",label:"등록일",formatter:l=>M(l)},{key:"view",label:"상세보기"},{key:"action",label:"계산"}],$=[{key:"material_code",label:"자재코드"},{key:"material_name",label:"자재명"},{key:"current_stock_qty",label:"재고"},{key:"material_unit",label:"단위"},{key:"material_cls",label:"분류"},{key:"total_needed_qty",label:"필요 수량"},{key:"material_safty",label:"안재 재고 기준"},{key:"shortage_qty",label:"발주 수량"}],S=l=>{k.value=b.value.filter(t=>t.plan_id===l.plan_id),_.value=!0},M=l=>{const t=new Date(l),e=new Date(t.getTime()+9*60*60*1e3),s=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),g=String(e.getDate()).padStart(2,"0"),C=String(e.getHours()).padStart(2,"0"),D=String(e.getMinutes()).padStart(2,"0");return`${s}-${r}-${g} ${C}:${D}`},P=async()=>{try{const l=await v.get("/mrps");b.value=l.data;const t=new Map;l.data.forEach(e=>{t.has(e.plan_id)||t.set(e.plan_id,{plan_id:e.plan_id,plan_name:e.plan_name,plan_reg_dt:e.plan_reg_dt})}),f.value=Array.from(t.values())}catch(l){console.error("계획 조회 실패",l)}},I=async l=>{try{a.value=l;const t=await v.get(`/mrps/${l.plan_id}`);o.value=t.data,console.log("MRP 응답 데이터:",t.data)}catch(t){console.error("MRP 계산 실패",t)}},B=async()=>{if(!a.value){alert("먼저 생산계획에서 계산 버튼을 눌러주세요.");return}const l=a.value.plan_id;if(o.value.length>0)try{const t=o.value.map(e=>{const s=new Date,r=s.getFullYear(),g=String(s.getMonth()+1).padStart(2,"0"),C=String(s.getDate()).padStart(2,"0"),D=`${r}${g}${C}`,R=Math.floor(100+Math.random()*900);return{purchase_order_id:`${e.material_code}-${D}-${R}`,purchase_order_name:`${e.material_name}-${e.shortage_qty}`,purchase_order_quantity:e.shortage_qty,material_code:e.material_code}});console.log("발주내용:",t);try{let e=await v.post("/puOrder",t),s=await v.put(`/mrps/${l}`);console.log(e.data),console.log(s.data),e.data.isSuccessed&&s.data.isUpdated?(alert("부족 자재 등록 완료!"),await P(),o.value=[],a.value=null):alert("등록 실패")}catch(e){console.error("등록 실패:",e),alert("서버 오류 발생!")}}catch(t){console.error("발주 등록 실패:",t),alert("발주 등록 중 오류가 발생했습니다.")}else try{await v.put(`/mrps/${l}`),alert("부족한 자재가 없어 발주 없이 완료 처리했습니다.")}catch(t){console.error("is_ordered 업데이트 실패:",t),alert("처리 중 오류가 발생했습니다.")}};return F(()=>{P()}),(l,t)=>{const e=y("va-button"),s=y("va-data-table");return q(),N("div",K,[t[6]||(t[6]=n("h2",{class:"page-title"},"MRP 계산",-1)),n("div",L,[t[3]||(t[3]=n("h3",{class:"table-title"},"생산계획 리스트",-1)),p(s,{items:f.value,columns:m,"per-page":5,"current-page":d.value,"track-by":"plan_id"},{"cell(plan_reg_dt)":c(({row:r})=>[u(w(M(r.source.plan_reg_dt)),1)]),"cell(view)":c(({row:r})=>[p(e,{size:"small",color:"info",onClick:g=>S(r.source)},{default:c(()=>t[1]||(t[1]=[u("상세보기")])),_:2,__:[1]},1032,["onClick"])]),"cell(action)":c(({row:r})=>[p(e,{size:"small",onClick:g=>I(r.source)},{default:c(()=>t[2]||(t[2]=[u("계산")])),_:2,__:[2]},1032,["onClick"])]),_:1},8,["items","current-page"]),p(H,{isOpen:_.value,products:k.value,onClose:t[0]||(t[0]=r=>_.value=!1)},null,8,["isOpen","products"])]),n("div",U,[t[5]||(t[5]=n("h3",{class:"table-title"},"부족 자재 리스트",-1)),p(s,{items:o.value,columns:$,"track-by":"material_code"},null,8,["items"]),n("div",j,[p(e,{onClick:B,disabled:!a.value},{default:c(()=>t[4]||(t[4]=[u("발주관리 등록")])),_:1,__:[4]},8,["disabled"])])])])}}}),J=O(A,[["__scopeId","data-v-4e393ad1"]]);export{J as default};
//# sourceMappingURL=mrpCalculatePage-D9U8G8KO.js.map
