import{_ as nt,v as S,n as w,c as W,o as lt,x as ot,K as it,p as u,i as e,t as l,z as $,q as p,m as I,F as K,y as G,D as re,H as we,E as rt,s as ke,J as ut,h as dt,a as ct,A as vt,f as d,B as _t}from"./index-BJgCI8mH.js";const pt={class:"package-work-container"},ft={class:"work-header"},mt={class:"header-info"},yt={class:"header-left"},gt={class:"header-meta"},wt={key:0,class:"workflow-badge"},kt={key:0,class:"workflow-indicator"},bt={key:0,class:"debug-panel"},ht={class:"debug-header"},qt={class:"debug-content"},Tt={class:"debug-section"},Rt={key:0,class:"debug-info"},$t={class:"column-list"},Et={class:"debug-section"},Ot={key:0,class:"debug-info"},Ct={key:0},St={key:1,class:"workflow-guide"},It={class:"guide-content"},Dt={class:"guide-stats"},Nt={key:0,class:"output-qty"},Wt={class:"work-content"},Pt={class:"work-layout"},Mt={class:"work-main"},Qt={class:"control-panel"},At={class:"panel-header"},Lt={class:"control-section"},Ut={class:"control-row"},xt={class:"control-group"},Bt={class:"control-label"},Kt={key:0,class:"available-count"},Gt={class:"line-info"},Yt=["disabled"],Vt={value:""},zt={key:0,label:"시작 가능한 작업"},Ft=["value"],jt={key:1,label:"진행중인 작업"},Jt=["value"],Ht={key:2,label:"일시정지/부분완료된 작업"},Xt=["value"],Zt={key:0,class:"no-work-message"},es={key:1,class:"loading-work-message"},ts={class:"control-group"},ss={class:"control-display"},as={class:"display-value"},ns={class:"control-row"},ls={class:"control-group"},os={class:"control-display"},is={class:"control-group"},rs={class:"control-display"},us={class:"control-row"},ds={class:"control-group"},cs=["disabled"],vs={class:"control-group"},_s={class:"control-label"},ps={key:0,class:"target-info"},fs={key:1,class:"workflow-info"},ms=["placeholder","disabled","max"],ys={key:0,class:"workflow-linked-info"},gs={key:1,class:"partial-work-info"},ws={key:2,class:"input-warning"},ks={key:3,class:"workflow-suggestion"},bs={key:0,class:"selected-work-preview"},hs={class:"preview-grid"},qs={class:"preview-item"},Ts={class:"value"},Rs={class:"preview-item"},$s={class:"value"},Es={class:"preview-item"},Os={class:"preview-item"},Cs={class:"value"},Ss={class:"preview-item"},Is={class:"value"},Ds={class:"preview-item"},Ns={class:"value"},Ws={class:"preview-item"},Ps={class:"value"},Ms={key:0,class:"preview-item"},Qs={class:"value debug-keys"},As={class:"work-controls"},Ls={class:"main-actions"},Us=["disabled"],xs=["disabled"],Bs=["disabled"],Ks={class:"sub-actions"},Gs=["disabled"],Ys=["disabled"],Vs={class:"progress-panel"},zs={class:"progress-cards"},Fs={class:"progress-card"},js={class:"card-value"},Js={class:"progress-card success"},Hs={class:"card-value"},Xs={class:"progress-card danger"},Zs={class:"card-value"},ea={class:"progress-section"},ta={class:"progress-header"},sa={class:"progress-percent"},aa={class:"progress-bar"},na={class:"log-panel"},la={class:"log-container"},oa={class:"log-time"},ia={class:"log-content"},ra={class:"work-sidebar"},ua={key:0,class:"workflow-panel"},da={class:"workflow-chain"},ca={class:"chain-step completed"},va={class:"step-details"},_a={class:"detail-item"},pa={class:"detail-value"},fa={class:"detail-item"},ma={class:"detail-value"},ya={key:0,class:"detail-item"},ga={class:"detail-value highlight"},wa={class:"chain-step current"},ka={class:"step-details"},ba={class:"detail-item"},ha={class:"detail-value"},qa={class:"detail-item"},Ta={class:"detail-value"},Ra={class:"info-panel"},$a={class:"info-section"},Ea={class:"info-row"},Oa={class:"info-value"},Ca={class:"info-row"},Sa={class:"info-value"},Ia={class:"info-row"},Da={class:"info-value"},Na={class:"info-row"},Wa={class:"info-value"},Pa={class:"info-section"},Ma={class:"info-row"},Qa={class:"info-value"},Aa={class:"info-row"},La={class:"info-row"},Ua={class:"info-row"},xa={class:"info-section"},Ba={class:"info-row"},Ka={class:"info-value"},Ga={class:"info-row"},Ya={class:"info-value work-duration"},Va={class:"info-row"},za={class:"info-row"},Fa={class:"info-value"},ja={class:"info-section"},Ja={class:"info-row"},Ha={class:"info-row"},Xa={class:"info-value defect-rate"},Za={class:"info-section"},en={class:"info-row"},tn={class:"info-value worker-name"},sn={class:"info-row"},an={class:"info-value"},nn={key:0,class:"info-section debug-section"},ln={class:"info-row"},on={class:"info-value"},rn={class:"info-row"},un={class:"info-value"},dn={class:"line-change-panel"},cn={class:"line-change-help"},vn={class:"modal-header"},_n={class:"modal-body"},pn={class:"complete-summary"},fn={class:"summary-grid"},mn={class:"summary-item"},yn={class:"summary-value"},gn={class:"summary-item"},wn={class:"summary-value"},kn={class:"summary-item"},bn={class:"summary-value"},hn={class:"summary-item"},qn={class:"summary-value"},Tn={class:"summary-item"},Rn={class:"summary-value"},$n={class:"summary-item"},En={class:"summary-value"},On={key:0,class:"next-step-info inner-completion"},Cn={key:1,class:"next-step-info outer-completion"},Sn={key:2,class:"partial-completion-info"},In={class:"warning-box"},Dn={class:"warning-content"},Nn={class:"completion-stats"},Wn={class:"stat-item"},Pn={class:"stat-value"},Mn={class:"stat-item"},Qn={class:"stat-value"},An={class:"stat-item"},Ln={class:"stat-value shortage"},Un={class:"stat-item"},xn={class:"stat-value"},Bn={class:"confirmation-text"},Kn={class:"modal-actions"},Gn={key:0,class:"completion-options"},Yn={key:3,class:"auto-transition-overlay"},Vn={class:"transition-modal"},zn={class:"transition-progress"},Fn={class:"progress-bar"},jn={class:"progress-text"},Jn={key:4,class:"loading-overlay"},Hn={class:"loading-text"},Xn={key:5,class:"error-overlay"},Zn={class:"error-modal"},el={class:"error-body"},tl={__name:"PackageWork",setup(sl){S.defaults.timeout=15e3,S.defaults.headers.common["Content-Type"]="application/json";const ue=ct(),O=vt(),r=w({lineId:O.query.line_id||"1",lineName:O.query.line_name||"A라인 내포장",lineType:O.query.line_type||"INNER"}),i=w({step:O.query.workflow_step||null,innerCompleted:O.query.inner_completed==="true",innerWorkNo:O.query.inner_work_order_no||"",innerCompletionTime:O.query.inner_completion_time?new Date(O.query.inner_completion_time):null,innerOutputQty:parseInt(O.query.inner_output_qty)||0,autoStartGuide:O.query.auto_start_guide==="true"}),N=w(!1),q=w({tableStructure:null,lastApiResponse:null,mappingTest:null}),f=w(!1),C=w(""),ee=w(!1),de=w(""),k=w("READY"),m=w(!1),Y=w(null),te=w("00:00:00"),T=w(""),b=w(500),E=w([]),se=w(!1),Q=w(0),V=W(()=>a.value.step_status==="부분완료"||a.value.step_status==="PARTIAL_COMPLETE"||a.value.step_status==="partial_complete"),z=W(()=>E.value.filter(t=>{if(!t)return!1;const n=(t.step_status||"").toLowerCase();return!n||n===""||n==="ready"||n==="준비"||n==="null"||n==="undefined"||n==="available"}).sort((t,n)=>{const v=P(t.work_order_no),g=P(n.work_order_no);return v-g})),F=W(()=>E.value.filter(t=>{if(!t)return!1;const n=(t.step_status||"").toLowerCase();return n==="working"||n==="in_progress"||n==="진행중"||n==="진행"||n==="active"}).sort((t,n)=>{const v=P(t.work_order_no),g=P(n.work_order_no);return v-g})),j=W(()=>E.value.filter(t=>{if(!t)return!1;const n=(t.step_status||"").toLowerCase();return n==="paused"||n==="일시정지"||n==="partial_complete"||n==="부분완료"||n==="partial"}).sort((t,n)=>{const v=P(t.work_order_no),g=P(n.work_order_no);return v-g})),a=w({work_order_no:"",result_detail_id:null,result_id:"",product_name:"",product_code:"",package_type:"",target_quantity:0,current_quantity:0,remaining_quantity:0,output_qty:0,defect_qty:0,progressRate:0,passRate:0,defectRate:0,achievementRate:0,employee_id:2,worker_name:"김포장",department:"포장부",position:"작업자",start_time:null,end_time:null,work_duration:0,estimated_duration:0,step_status:"READY",process_code:"",eq_type_code:"",_original_keys:[],_processed_at:null}),A=w([]),J=w(!1);let h=null,y=null;const be=W(()=>{if(!a.value.end_time||!m.value)return!1;const s=new Date;return new Date(a.value.end_time).getTime()-s.getTime()<30*60*1e3}),R=w({productionSpeed:30,defectRate:.02,targetQty:0,currentProgress:0}),he=W(()=>{if(!T.value||m.value)return!1;if(V.value)return console.log("부분완료 작업 - 시작 가능"),!0;if(a.value.step_status==="일시정지"||a.value.step_status==="PAUSED")return console.log("일시정지 작업 - 재시작 가능"),!0;if(a.value.step_status==="진행중"||a.value.step_status==="IN_PROGRESS"||a.value.step_status==="WORKING")return console.log("진행중 작업 - 재시작 가능"),!0;const s=b.value>0;return console.log(`일반 작업 - 투입수량 확인: ${b.value} (시작가능: ${s})`),s}),L=W(()=>a.value.output_qty<a.value.target_quantity&&a.value.target_quantity>0);function D(){return Math.max(0,a.value.target_quantity-a.value.current_quantity)}function H(){return a.value.target_quantity<=0?100:Math.round(a.value.output_qty/a.value.target_quantity*100)}lt(async()=>{console.log("PackageWork 컴포넌트 마운트 - 실제 DB 연동 시작"),console.log("라인 정보:",r.value),console.log("워크플로우 정보:",i.value);try{f.value=!0,C.value="실제 데이터베이스에서 작업번호 목록을 불러오는 중...",await ce(),await ae(),r.value.lineType==="OUTER"&&(console.log("외포장 감지 - 워크플로우 데이터 로드"),await ve()),O.query.work_order_no?await Se(O.query.work_order_no):await ne(),i.value.step==="OUTER"&&i.value.innerCompleted&&o(`외포장 단계입니다. 내포장(${i.value.innerWorkNo})이 완료되었습니다.`,"success"),O.query.message&&o(O.query.message,"success"),o("실제 데이터베이스에서 작업번호 목록 로딩이 완료되었습니다.","success")}catch(s){console.error("작업번호 로딩 실패:",s),o(`초기화 실패: ${s.message}`,"error"),E.value=[],(s.message.includes("Unknown column")||s.message.includes("table")||s.message.includes("column"))&&(N.value=!0,o("테이블 구조 문제가 감지되어 디버깅 패널을 활성화했습니다.","warning"))}finally{f.value=!1}});async function ce(){try{console.log("테이블 구조 확인 중...");const s=await S.get("/packages/debug/table-structure");s.data.success&&s.data.data?(q.value.tableStructure=s.data.data,console.log("테이블 구조 확인 완료:",q.value.tableStructure),o(`테이블 구조 확인: ${q.value.tableStructure.column_count}개 컬럼, ${q.value.tableStructure.total_rows}개 행`,"info")):console.warn("테이블 구조 확인 실패:",s.data.error)}catch(s){console.warn("테이블 구조 확인 중 오류:",s.message)}}async function ae(){var s,t,n;try{console.log("실제 작업번호 목록 조회 시작");const v=r.value.lineType,g=await S.get("/packages/works",{params:{package_type:v,line_id:r.value.lineId,line_name:r.value.lineName}});if(q.value.lastApiResponse=g.data,g.data.success&&g.data.data){const ie=g.data.data;if(console.log(`전체 작업 ${ie.length}개 조회됨`),o(`실제 DB에서 ${ie.length}개 작업을 조회했습니다.`,"success"),g.data.metadata){const _=g.data.metadata;if(o(`데이터 품질: 제품명 ${((s=_.data_quality)==null?void 0:s.with_product_name)||0}개, 라인정보 ${((t=_.data_quality)==null?void 0:t.with_line_info)||0}개`,"info"),_.status_breakdown){const tt=Object.entries(_.status_breakdown).map(([st,at])=>`${st}: ${at}개`).join(", ");o(`작업 상태 분포: ${tt}`,"info")}}E.value=ie.map(_=>({work_order_no:_.work_order_no,step_name:_.step_name||_.final_product_name||"포장작업",product_name:_.final_product_name||_.product_name||qe(_.step_name),product_code:_.product_code,step_status:_.step_status||"READY",order_qty:_.order_qty||_.target_qty||_.input_qty||1e3,target_qty:_.target_qty||_.order_qty||_.input_qty||1e3,input_qty:_.input_qty||0,output_qty:_.output_qty||0,defect_qty:_.defect_qty||0,progress_rate:_.progress_rate||0,employee_name:_.employee_name||_.emp_name||"김포장",employee_id:_.employee_id||2,line_name:_.line_name||r.value.lineName,line_id:_.line_id||r.value.lineId,package_type:_.package_type||r.value.lineType,line_type:_.line_type||(r.value.lineType==="INNER"?"내포장":"외포장"),start_time:_.start_time,end_time:_.end_time,reg_date:_.reg_date,_original_keys:_._original_keys||Object.keys(_),_processed_at:_._processed_at||new Date().toISOString()})),o(`${r.value.lineName}의 작업번호 ${E.value.length}개를 처리했습니다.`,"success")}else throw new Error(g.data.message||"작업번호 목록 조회 실패")}catch(v){if(console.error("실제 작업번호 조회 실패:",v),((n=v.response)==null?void 0:n.status)===404)o("해당 라인의 작업번호가 없습니다.","warning"),E.value=[];else throw v.message.includes("Unknown column")&&(o("데이터베이스 컬럼 구조 문제가 발견되었습니다. 디버깅 패널을 확인하세요.","error"),N.value=!0),v}}function qe(s){return s?s.includes("타이레놀")?"타이레놀정500mg":s.includes("게보린")?"게보린정":s.includes("부루펜")?"부루펜시럽":s.includes("베아르")?"베아르정":s.includes("A라인")?"A라인 제품":s.includes("B라인")?"B라인 제품":s.includes("C라인")?"C라인 제품":s||"제품명없음":"제품명없음"}async function ve(){try{console.log("외포장 워크플로우 데이터 로드 시작");const s=r.value.lineName.replace(/\s*(내포장|외포장).*$/,"");console.log("기본 라인명:",s);let t=null;try{const n=await S.get("/packages/workflow/inner-completed",{params:{base_line_name:s}});n.data.success&&n.data.data&&(t=n.data.data,console.log("API에서 내포장 완료 정보 조회 성공:",t))}catch(n){console.log("API 호출 실패, 대안 데이터 소스 확인:",n.message)}if(!t&&i.value.innerOutputQty>0&&(t={work_order_no:i.value.innerWorkNo,output_qty:i.value.innerOutputQty,completion_time:i.value.innerCompletionTime,step_status:"완료"},console.log("URL 파라미터에서 워크플로우 데이터 사용:",t)),!t&&window.workflowData){const n=`workflow_${s.replace(/\s+/g,"_")}`,v=window.workflowData[n];v&&v.inner_output_qty>0&&(t={work_order_no:v.inner_work_order_no,output_qty:v.inner_output_qty,completion_time:v.inner_completion_time,step_status:"완료"},console.log("메모리에서 워크플로우 데이터 사용:",t))}return t&&t.output_qty>0?(i.value.innerCompleted=!0,i.value.innerWorkNo=t.work_order_no,i.value.innerOutputQty=t.output_qty,i.value.innerCompletionTime=new Date(t.completion_time||t.end_time),i.value.step="OUTER",b.value=t.output_qty,o(`${s} 내포장 완료 정보를 연결했습니다.`,"success"),o(`완료 작업: ${t.work_order_no}, 완료수량: ${c(t.output_qty)}개`,"info"),o(`외포장 투입수량을 ${c(t.output_qty)}개로 설정했습니다.`,"success"),!0):(console.log("연결된 내포장 완료 정보 없음"),o(`${s}의 내포장 완료 정보를 찾을 수 없습니다.`,"warning"),!1)}catch(s){return console.error("워크플로우 데이터 로드 실패:",s),o("워크플로우 연계에 실패했습니다. 수동으로 설정해주세요.","warning"),!1}}async function Te(){try{f.value=!0,C.value="테이블 구조 테스트 중...";const s=await S.get("/packages/debug/table-structure");s.data.success?(q.value.tableStructure=s.data.data,o(`테이블 구조 테스트 완료: ${s.data.data.column_count}개 컬럼`,"success")):o(`테이블 구조 테스트 실패: ${s.data.error}`,"error")}catch(s){console.error("테이블 구조 테스트 실패:",s),o(`테이블 구조 테스트 실패: ${s.message}`,"error")}finally{f.value=!1}}async function Re(){try{f.value=!0,C.value="데이터 매핑 테스트 중...";const s=await S.get("/packages/debug/data-mapping-test");s.data.success?(q.value.mappingTest=s.data.data,o(`데이터 매핑 테스트 완료: ${s.data.data.total_sample_count}개 샘플`,"success"),o(`성공적 매핑: ${s.data.data.summary.successful_mappings}개`,"info")):o(`데이터 매핑 테스트 실패: ${s.data.error}`,"error")}catch(s){console.error("데이터 매핑 테스트 실패:",s),o(`데이터 매핑 테스트 실패: ${s.message}`,"error")}finally{f.value=!1}}async function $e(){try{f.value=!0,C.value="필터링 테스트 중...";const s=await S.get("/packages/debug/filter-test",{params:{test_package_type:r.value.lineType,test_line_id:r.value.lineId,test_line_name:r.value.lineName}});s.data.success?(o(`필터링 테스트 완료: 원본 ${s.data.data.original_data_count}개`,"success"),s.data.data.filter_tests.forEach(t=>{o(`${t.filter_type} 필터: ${t.original_count} → ${t.filtered_count}개`,"info")})):o(`필터링 테스트 실패: ${s.data.error}`,"error")}catch(s){console.error("필터링 테스트 실패:",s),o(`필터링 테스트 실패: ${s.message}`,"error")}finally{f.value=!1}}async function X(){if(!T.value){fe();return}try{f.value=!0,C.value="작업 정보를 불러오는 중...",console.log(`작업번호 ${T.value} 선택`);const s=E.value.find(t=>t.work_order_no===T.value);if(!s)throw new Error(`작업번호 ${T.value}를 찾을 수 없습니다.`);if(console.log("선택된 작업 정보:",s),a.value={work_order_no:s.work_order_no,product_name:s.final_product_name||s.product_name,product_code:s.product_code,package_type:s.package_type,target_quantity:s.target_qty||s.order_qty||1e3,current_quantity:s.input_qty||0,remaining_quantity:0,output_qty:s.output_qty||0,defect_qty:s.defect_qty||0,progressRate:parseFloat(s.progress_rate)||0,passRate:0,defectRate:0,achievementRate:0,employee_id:s.employee_id||2,worker_name:s.employee_name||"김포장",department:"포장부",position:"작업자",start_time:s.start_time,end_time:s.end_time,work_duration:0,estimated_duration:0,step_status:s.step_status||"READY",_original_keys:s._original_keys||[],_processed_at:s._processed_at||new Date().toISOString()},r.value.lineType==="OUTER"&&i.value.innerCompleted&&i.value.innerOutputQty>0&&(console.log(`외포장 워크플로우 연계: ${i.value.innerOutputQty}개`),a.value.current_quantity=i.value.innerOutputQty,b.value=i.value.innerOutputQty,o(`워크플로우 연계: 내포장 완료수량 ${c(i.value.innerOutputQty)}개를 투입량으로 설정`,"success")),a.value.step_status==="부분완료"||a.value.step_status==="PARTIAL_COMPLETE"||a.value.step_status==="partial_complete"){const t=a.value.target_quantity-a.value.output_qty;o("부분완료된 작업을 발견했습니다.","warning"),o(`이전 생산량: ${c(a.value.output_qty)}개`,"info"),o(`남은 수량: ${c(t)}개`,"warning"),t>0&&(b.value=t,o(`투입수량을 남은 ${c(t)}개로 설정했습니다.`,"success"))}else(!b.value||b.value===0)&&(b.value=Math.min(500,a.value.target_quantity||500));U(),o(`작업번호 ${T.value} 정보를 불러왔습니다. (실제 DB 데이터)`,"success"),s._original_keys&&s._original_keys.length>0&&o(`원본 DB 컬럼 ${s._original_keys.length}개를 성공적으로 매핑했습니다.`,"info")}catch(s){console.error(`작업번호 ${T.value} 조회 실패:`,s),Z(`작업번호 ${T.value} 정보를 불러올 수 없습니다: ${s.message}`),fe()}finally{f.value=!1}}async function Ee(){if(m.value)_e();else try{f.value=!0,C.value="작업을 시작하는 중...";const s=await S.put(`/packages/${a.value.work_order_no}`,{step_status:"WORKING",input_qty:b.value,start_time:new Date().toISOString(),employee_id:a.value.employee_id});if(s.data.success)o("작업이 시작되었습니다. (실제 DB 업데이트됨)","success"),m.value=!0,k.value="WORKING",Y.value=new Date,a.value.start_time=Y.value,a.value.current_quantity=b.value,R.value.targetQty=b.value,R.value.currentProgress=a.value.output_qty||0,U(),ge(),pe(),o(`목표수량: ${c(b.value)}개로 작업을 시작했습니다.`,"success");else throw new Error(s.data.message||"작업 시작 실패")}catch(s){console.error("작업 시작 실패:",s),Z(`작업 시작 실패: ${s.message}`)}finally{f.value=!1}}async function Oe(){try{f.value=!0,C.value="작업을 완료하는 중...";const s=await S.put(`/packages/${a.value.work_order_no}/complete`,{output_qty:a.value.output_qty,defect_qty:a.value.defect_qty,end_time:new Date().toISOString(),employee_id:a.value.employee_id});if(s.data.success)o("작업이 완료되었습니다. (실제 DB 업데이트됨)","success"),r.value.lineType==="INNER"&&await Ce(),m.value=!1,k.value="COMPLETED",h&&(clearInterval(h),h=null),y&&(clearInterval(y),y=null),M(),r.value.lineType==="INNER"?(o("내포장 작업 완료 - 외포장 라인 선택으로 이동합니다...","success"),ye()):(o("모든 포장 작업이 완료되었습니다!","success"),ye());else throw new Error(s.data.message||"작업 완료 실패")}catch(s){console.error("작업 완료 실패:",s),o(`작업 완료 처리 중 오류: ${s.message}`,"error")}finally{f.value=!1}}async function Ce(){try{console.log("내포장→외포장 워크플로우 연계 시작");const s=r.value.lineName.replace(/\s*(내포장|외포장).*$/,""),t={base_line_name:s,inner_work_order_no:a.value.work_order_no,inner_output_qty:a.value.output_qty,inner_completion_time:new Date().toISOString(),completion_type:"complete",completed_by:a.value.employee_id},n=await S.post("/packages/workflow/update-outer-linkage",t);if(n.data.success){o(`${s} 외포장에 워크플로우 연계 완료 (${c(a.value.output_qty)}개)`,"success"),window.workflowData||(window.workflowData={});const v=`workflow_${s.replace(/\s+/g,"_")}`;window.workflowData[v]={inner_work_order_no:a.value.work_order_no,inner_output_qty:a.value.output_qty,inner_completion_time:new Date().toISOString(),completion_type:"complete"}}else console.warn("워크플로우 연계 실패:",n.data.message)}catch(s){console.error("워크플로우 연계 실패:",s),o("외포장 연계에 실패했지만 작업은 완료되었습니다.","warning")}}function P(s){if(!s)return 0;const t=s.toString().match(/\d+/);return t?parseInt(t[0],10):0}async function ne(){if(E.value.length===0){console.log("자동 선택할 작업번호가 없음");return}const s=[...F.value,...j.value,...z.value];if(s.length>0){const t=s[0];console.log(`자동 선택: ${t.work_order_no} (상태: ${x(t.step_status)})`),T.value=t.work_order_no,await X(),o(`자동 선택: ${t.work_order_no} - ${t.product_name||t.final_product_name}`,"success")}}async function Se(s,t=2){for(let n=1;n<=t;n++)try{if(console.log(`작업번호 ${s} 선택 시도 ${n}/${t}`),E.value.find(g=>g.work_order_no===s)){T.value=s,await X(),console.log(`작업번호 ${s} 선택 성공`),o(`URL에서 작업번호 ${s}가 선택되었습니다.`,"info");return}else console.log(`시도 ${n}: 작업번호 ${s}를 목록에서 찾을 수 없음`),n<t&&await ae()}catch(v){console.error(`시도 ${n} 실패:`,v),n===t&&o(`작업번호 ${s} 선택에 실패했습니다.`,"warning")}}async function le(){try{o("강력 새로고침을 시작합니다...","info"),f.value=!0,C.value="강력 새로고침 중 (실제 DB 재조회)...";const s=T.value;E.value=[],q.value.lastApiResponse=null,await new Promise(t=>setTimeout(t,500)),await ce(),await ae(),r.value.lineType==="OUTER"&&await ve(),s?E.value.find(n=>n.work_order_no===s)?(T.value=s,await X(),o(`이전 작업(${s})을 복원했습니다.`,"success")):(o(`이전 작업(${s})을 찾을 수 없어 자동 선택합니다.`,"warning"),await ne()):await ne(),o("강력 새로고침이 완료되었습니다. (실제 DB 기반)","success")}catch(s){console.error("강력 새로고침 실패:",s),o(`강력 새로고침 실패: ${s.message}`,"error"),(s.message.includes("Unknown column")||s.message.includes("table"))&&(N.value=!0,o("데이터베이스 구조 문제가 감지되어 디버깅 패널을 활성화했습니다.","warning")),confirm("새로고침에 실패했습니다. 페이지를 새로고침하시겠습니까?")&&window.location.reload()}finally{f.value=!1}}ot(b,s=>{if(T.value&&s>0){if(r.value.lineType==="OUTER"&&i.value.innerCompleted&&i.value.innerOutputQty>0){s!==i.value.innerOutputQty&&(o("워크플로우 연계 중입니다. 투입수량은 내포장 완료수량으로 고정됩니다.","warning"),_t(()=>{b.value=i.value.innerOutputQty}));return}a.value.current_quantity=s,U()}}),it(()=>{h&&(clearInterval(h),h=null),y&&(clearInterval(y),y=null)});function Ie(){if(T.value&&b.value>0){if(r.value.lineType==="OUTER"&&i.value.innerCompleted&&i.value.innerOutputQty>0){console.log("외포장 워크플로우 연계 중 - 투입수량 변경 제한");return}a.value.current_quantity=b.value,U()}}function _e(){m.value=!1,k.value="PAUSED",y&&(clearInterval(y),y=null),h&&(clearInterval(h),h=null),o("작업을 일시정지했습니다.","warning")}function De(){m.value=!0,k.value="WORKING",ge(),pe(),o("작업을 재시작했습니다.","success")}function pe(){y&&clearInterval(y),o("생산 시뮬레이션을 시작합니다...","info"),y=setInterval(()=>{if(!m.value)return;const s=R.value.productionSpeed;R.value.currentProgress=Math.min(R.value.currentProgress+s,R.value.targetQty);const t=R.value.currentProgress,n=Math.floor(t*R.value.defectRate),v=t-n,g=a.value.target_quantity||R.value.targetQty;a.value.output_qty=v,a.value.defect_qty=n,a.value.progressRate=Math.min(100,Math.round(v/g*100)),a.value.passRate=t>0?Math.round(v/t*100):0,a.value.defectRate=t>0?Math.round(n/t*100):0,U(),t>0&&t%(R.value.productionSpeed*5)===0&&o(`생산 진행: ${v}개 완료 (불량: ${n}개, 진행률: ${a.value.progressRate}%)`,"info"),t>=R.value.targetQty&&Ne()},1e3)}function Ne(){y&&(clearInterval(y),y=null),m.value=!1,k.value="COMPLETED",o("생산이 완료되었습니다!","success"),o('"완료 처리" 버튼을 눌러 작업을 마무리해주세요.',"info")}function We(){if(k.value==="COMPLETED"||!m.value){J.value=!0;return}J.value=!0}async function Pe(){try{m.value=!1,k.value="COMPLETED",h&&(clearInterval(h),h=null),y&&(clearInterval(y),y=null),o("작업을 강제 종료했습니다.","info")}catch(s){console.error("작업 종료 실패:",s),Z("작업 종료 처리에 실패했습니다.")}}async function Me(){try{f.value=!0,C.value="부분 완료 처리 중...",(await S.put(`/packages/${a.value.work_order_no}/partial-complete`,{output_qty:a.value.output_qty,defect_qty:a.value.defect_qty,remaining_qty:D(),completion_rate:H(),employee_id:a.value.employee_id})).data.success&&(o(`부분 완료 처리되었습니다. (달성률: ${H()}%) - 실제 DB 업데이트됨`,"warning"),m.value=!1,k.value="PARTIAL_COMPLETE",h&&(clearInterval(h),h=null),y&&(clearInterval(y),y=null),M(),D()>0&&(o(`지시수량 미달성: ${c(D())}개 남음`,"warning"),o("나중에 같은 작업번호를 선택하여 계속 작업할 수 있습니다.","info")))}catch(s){console.error("부분 완료 처리 실패:",s),o(`부분 완료 처리 중 오류: ${s.message}`,"error")}finally{f.value=!1}}async function Qe(){try{f.value=!0,C.value="일시정지 처리 중...",(await S.put(`/packages/${a.value.work_order_no}/pause`,{output_qty:a.value.output_qty,defect_qty:a.value.defect_qty,remaining_qty:D(),completion_rate:H(),employee_id:a.value.employee_id})).data.success&&o("일시정지되었습니다. 나중에 계속할 수 있습니다. (실제 DB 업데이트됨)","info"),m.value=!1,k.value="PAUSED",h&&(clearInterval(h),h=null),y&&(clearInterval(y),y=null),M(),setTimeout(()=>{oe()},2e3)}catch(s){console.error("일시정지 처리 실패:",s),o(`일시정지 처리 중 오류: ${s.message}`,"error")}finally{f.value=!1}}async function Ae(){if(confirm("이 라인의 작업 상태를 초기화하시겠습니까?"))try{f.value=!0,C.value="라인 상태 초기화 중...",o("라인 상태를 초기화했습니다.","success"),await le()}catch(s){console.error("라인 초기화 실패:",s),o(`라인 초기화 실패: ${s.message}`,"error")}finally{f.value=!1}}function U(){if(a.value.target_quantity>0?(a.value.remaining_quantity=Math.max(0,a.value.target_quantity-a.value.current_quantity),a.value.achievementRate=Math.round(a.value.output_qty/a.value.target_quantity*100)):(a.value.remaining_quantity=0,a.value.achievementRate=0),m.value&&R.value.productionSpeed>0){const t=(R.value.targetQty-R.value.currentProgress)/R.value.productionSpeed;a.value.end_time=new Date(Date.now()+t*1e3),a.value.estimated_duration=Math.ceil(t)}}function fe(){a.value={work_order_no:"",result_detail_id:null,result_id:"",product_name:"",product_code:"",package_type:"",target_quantity:0,current_quantity:0,remaining_quantity:0,output_qty:0,defect_qty:0,progressRate:0,passRate:0,defectRate:0,achievementRate:0,employee_id:2,worker_name:"김포장",department:"포장부",position:"작업자",start_time:null,end_time:null,work_duration:0,estimated_duration:0,step_status:"READY",process_code:"",eq_type_code:"",_original_keys:[],_processed_at:null}}function Z(s){de.value=s,ee.value=!0,o(s,"error")}function me(){ee.value=!1}async function Le(){me();try{await le()}catch{Z("재연결에 실패했습니다.")}}function o(s,t="info"){A.value.unshift({id:Date.now(),timestamp:new Date,message:s,type:t}),A.value.length>50&&(A.value=A.value.slice(0,50)),console.log(`[${t.toUpperCase()}] ${s}`)}function M(){J.value=!1}function oe(){if(m.value&&!confirm("진행 중인 작업이 있습니다. 정말 돌아가시겠습니까?"))return;const s={from_work:"true",maintain_type:r.value.lineType,current_work:a.value.work_order_no};i.value.step==="OUTER"&&(s.inner_work_order_no=i.value.innerWorkNo,s.inner_completed="true"),ue.push({name:"package_line",query:s})}function Ue(){k.value==="READY"?Ee():k.value==="WORKING"?_e():k.value==="PAUSED"&&De()}function ye(){console.log("자동 전환 시작"),se.value=!0,Q.value=0;const s=3e3,t=50,n=100/(s/t),v=setInterval(()=>{if(Q.value+=n,Q.value>=100){clearInterval(v),se.value=!1;let g={};r.value.lineType==="INNER"?g={inner_completed:"true",prev_work:a.value.work_order_no,inner_work_order_no:a.value.work_order_no,inner_output_qty:a.value.output_qty,inner_completion_time:new Date().toISOString(),auto_start_guide:"true",message:`내포장 작업(${a.value.work_order_no})이 완료되었습니다. 완료수량 ${c(a.value.output_qty)}개를 외포장에 투입하세요.`,success_message:"내포장 작업이 성공적으로 완료되었습니다!"}:g={outer_completed:"true",prev_work:a.value.work_order_no,prev_inner_work:i.value.innerWorkNo,message:`모든 포장 작업이 완료되었습니다! 내포장(${i.value.innerWorkNo}) + 외포장(${a.value.work_order_no})`,success_message:"전체 포장 프로세스가 성공적으로 완료되었습니다!"},ue.push({name:"package_line",query:g}),o("라인 선택 페이지로 이동했습니다.","success")}},t)}function xe(){return i.value.step==="OUTER"?"외포장 (2단계)":i.value.step==="INNER"?"내포장 (1단계)":r.value.lineType==="INNER"?"내포장":"외포장"}function Be(){return r.value.lineType==="INNER"?"내포장 작업 완료 확인":"외포장 작업 완료 확인"}function Ke(){if(L.value){const s=D();if(s>0)return`지시량 ${c(a.value.target_quantity)}개 중 ${c(a.value.output_qty)}개만 완료되었습니다. 남은 ${c(s)}개는 어떻게 처리하시겠습니까?`}return r.value.lineType==="INNER"?"내포장 작업을 완료하고 외포장 라인 선택으로 이동하시겠습니까?":"외포장 작업을 완료하시겠습니까? 모든 포장 단계가 완료됩니다."}function Ge(){return r.value.lineType==="INNER"?"내포장 완료 → 외포장 선택":"외포장 완료 → 전체 완료"}function Ye(){const s=D();return s>0?`부분완료로 저장 (남은: ${c(s)}개)`:r.value.lineType==="INNER"?"내포장 완료 → 외포장 진행":"외포장 완료"}function Ve(){return r.value.lineType==="INNER"?"외포장 라인 선택으로 이동 중...":"작업 완료 - 라인 선택으로 이동 중..."}function ze(){return r.value.lineType==="INNER"?"내포장 작업이 완료되었습니다. 잠시 후 외포장이 활성화된 라인 선택 페이지로 이동합니다.":"모든 포장 작업이 완료되었습니다. 잠시 후 라인 선택 페이지로 이동합니다."}function Fe(){if(V.value&&!m.value)return"부분완료 작업 시작";switch(k.value){case"READY":return"작업 시작";case"WORKING":return"작업 일시정지";case"PAUSED":return"작업 재시작";case"COMPLETED":return"작업 완료됨";case"PARTIAL_COMPLETE":return"부분완료 작업 시작";default:return"작업 시작"}}function x(s){return{READY:"준비",WORKING:"작업중",IN_PROGRESS:"작업중",PAUSED:"일시정지",COMPLETED:"완료",PARTIAL_COMPLETE:"부분완료",partial_complete:"부분완료",준비:"준비",작업중:"작업중",진행중:"작업중",일시정지:"일시정지",완료:"완료",부분완료:"부분완료"}[s]||s||"준비"}function je(s){const t=(s||"").toLowerCase();return t.includes("ready")||t.includes("준비")||!s?"ready":t.includes("working")||t.includes("진행")||t.includes("progress")?"working":t.includes("paused")||t.includes("일시정지")?"paused":t.includes("completed")||t.includes("완료")?"completed":t.includes("partial")||t.includes("부분")?"partial":"unknown"}function Je(s){return s>=98?"excellent":s>=95?"good":s>=90?"warning":"danger"}function He(s){return s>=100?"excellent":s>=90?"good":s>=70?"warning":"danger"}function c(s){return s?s.toLocaleString():"0"}function B(s){return s?s instanceof Date?s.toLocaleTimeString("ko-KR",{hour:"2-digit",minute:"2-digit"}):new Date(s).toLocaleTimeString("ko-KR",{hour:"2-digit",minute:"2-digit"}):"-"}function Xe(s){return s?s instanceof Date?s.toLocaleString("ko-KR",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):new Date(s).toLocaleString("ko-KR",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}):"-"}function Ze(s){if(!s||s===0)return"-";const t=Math.floor(s/3600),n=Math.floor(s%3600/60),v=s%60;return t>0?`${t}시간 ${n}분`:n>0?`${n}분 ${v}초`:`${v}초`}function et(s){const t=Math.floor(s/36e5),n=Math.floor(s%(1e3*60*60)/(1e3*60)),v=Math.floor(s%(1e3*60)/1e3);return`${t.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}:${v.toString().padStart(2,"0")}`}function ge(){h=setInterval(()=>{if(Y.value){const s=new Date-Y.value;te.value=et(s),a.value.work_duration=Math.floor(s/1e3)}},1e3)}return(s,t)=>(d(),u("div",pt,[e("div",ft,[e("nav",{class:"breadcrumb"},[t[6]||(t[6]=e("span",{class:"breadcrumb-item"},"Home",-1)),t[7]||(t[7]=e("span",{class:"breadcrumb-separator"},"/",-1)),t[8]||(t[8]=e("span",{class:"breadcrumb-item"},"포장",-1)),t[9]||(t[9]=e("span",{class:"breadcrumb-separator"},"/",-1)),e("span",{class:"breadcrumb-item",style:{cursor:"pointer",color:"#3b82f6"},onClick:oe},"포장 라인 선택"),t[10]||(t[10]=e("span",{class:"breadcrumb-separator"},"/",-1)),t[11]||(t[11]=e("span",{class:"breadcrumb-item active"},"포장 작업 수행",-1))]),e("div",mt,[e("div",yt,[e("h1",null,l(r.value.lineName)+" - "+l(xe())+" 작업 수행 ",1),e("div",gt,[e("span",{class:$(["line-type-badge",r.value.lineType.toLowerCase()])},l(r.value.lineType==="INNER"?"내포장":"외포장"),3),e("span",{class:$(["work-status-badge",k.value.toLowerCase()])},l(x(k.value)),3),i.value.step==="OUTER"?(d(),u("span",wt," 2단계: 최종 포장 ")):p("",!0)])]),i.value.step?(d(),u("div",kt,[e("div",{class:$(["workflow-step",{completed:i.value.innerCompleted}])},t[12]||(t[12]=[e("div",{class:"step-text"},"내포장",-1)]),2),t[14]||(t[14]=e("div",{class:"workflow-arrow"},"→",-1)),e("div",{class:$(["workflow-step",{active:i.value.step==="OUTER"}])},t[13]||(t[13]=[e("div",{class:"step-text"},"외포장",-1)]),2)])):p("",!0)])]),N.value?(d(),u("div",bt,[e("div",ht,[t[15]||(t[15]=e("h3",null,"실제 데이터 디버깅",-1)),e("button",{class:"debug-close",onClick:t[0]||(t[0]=n=>N.value=!1)}," 닫기 ")]),e("div",qt,[e("div",Tt,[t[18]||(t[18]=e("h4",null,"테이블 구조 정보",-1)),q.value.tableStructure?(d(),u("div",Rt,[e("p",null,[t[16]||(t[16]=e("strong",null,"컬럼 수:",-1)),I(" "+l(q.value.tableStructure.column_count),1)]),e("p",null,[t[17]||(t[17]=e("strong",null,"전체 행 수:",-1)),I(" "+l(q.value.tableStructure.total_rows),1)]),e("details",null,[e("summary",null," 컬럼 목록 ("+l(Object.keys(q.value.tableStructure.columns||{}).length)+"개) ",1),e("ul",$t,[(d(!0),u(K,null,G(q.value.tableStructure.columns,(n,v)=>(d(),u("li",{key:v},[e("strong",null,l(v),1),I(" ("+l(n.type)+") ",1)]))),128))])])])):p("",!0)]),e("div",Et,[t[22]||(t[22]=e("h4",null,"API 응답 정보",-1)),q.value.lastApiResponse?(d(),u("div",Ot,[e("p",null,[t[19]||(t[19]=e("strong",null,"조회된 작업 수:",-1)),I(" "+l(q.value.lastApiResponse.count||0),1)]),e("p",null,[t[20]||(t[20]=e("strong",null,"필터 조건:",-1)),I(" "+l(JSON.stringify(q.value.lastApiResponse.filters||{})),1)]),q.value.lastApiResponse.metadata?(d(),u("details",Ct,[t[21]||(t[21]=e("summary",null,"메타데이터",-1)),e("pre",null,l(JSON.stringify(q.value.lastApiResponse.metadata,null,2)),1)])):p("",!0)])):p("",!0)]),e("div",{class:"debug-section"},[t[23]||(t[23]=e("h4",null,"매핑 테스트",-1)),e("div",{class:"debug-actions"},[e("button",{class:"debug-btn",onClick:Te}," 테이블 구조 확인 "),e("button",{class:"debug-btn",onClick:Re}," 데이터 매핑 테스트 "),e("button",{class:"debug-btn",onClick:$e}," 필터링 테스트 ")])])])])):p("",!0),i.value.step==="OUTER"&&i.value.innerCompleted?(d(),u("div",St,[e("div",It,[t[24]||(t[24]=e("h3",null,"외포장 작업 단계입니다",-1)),e("p",null," 내포장 작업("+l(i.value.innerWorkNo)+")이 완료되었습니다. 이제 최종 외포장 작업을 진행해주세요. ",1),e("div",Dt,[e("span",null,"내포장 완료: "+l(B(i.value.innerCompletionTime)),1),i.value.innerOutputQty>0?(d(),u("span",Nt," 완료수량: "+l(c(i.value.innerOutputQty))+"개 → 외포장 투입 ",1)):p("",!0)])])])):p("",!0),e("div",Wt,[e("div",Pt,[e("div",Mt,[e("div",Qt,[e("div",At,[t[25]||(t[25]=e("h3",null,"작업 제어",-1)),e("button",{class:"debug-toggle",onClick:t[1]||(t[1]=n=>N.value=!N.value)}," 디버깅 "+l(N.value?"숨김":"표시"),1)]),e("div",Lt,[e("div",Ut,[e("div",xt,[e("label",Bt,[t[26]||(t[26]=I(" 작업번호 선택 ")),E.value.length>0?(d(),u("span",Kt," ("+l(E.value.length)+"개 사용가능) ",1)):p("",!0),e("span",Gt,l(r.value.lineName),1)]),re(e("select",{"onUpdate:modelValue":t[2]||(t[2]=n=>T.value=n),class:"control-select",disabled:m.value,onChange:X},[e("option",Vt,l(r.value.lineName)+"의 작업을 선택하세요 ",1),z.value&&z.value.length>0?(d(),u("optgroup",zt,[(d(!0),u(K,null,G(z.value,n=>(d(),u("option",{key:n.work_order_no||Math.random(),value:n.work_order_no,class:"ready-option"},l(n.work_oder_no||"작업번호없음")+" - "+l(n.final_product_name||n.product_name||n.step_name||"제품명없음")+" ("+l(c(n.order_qty||n.target_qty||n.input_qty||1e3))+"개) ",9,Ft))),128))])):p("",!0),F.value&&F.value.length>0?(d(),u("optgroup",jt,[(d(!0),u(K,null,G(F.value,n=>(d(),u("option",{key:n.work_order_no||Math.random(),value:n.work_order_no,class:"working-option"},l(n.work_order_no||"작업번호없음")+" - "+l(n.final_product_name||n.product_name||n.step_name||"제품명없음")+" ("+l(n.progress_rate||0)+"% 완료) ",9,Jt))),128))])):p("",!0),j.value&&j.value.length>0?(d(),u("optgroup",Ht,[(d(!0),u(K,null,G(j.value,n=>(d(),u("option",{key:n.work_order_no||Math.random(),value:n.work_order_no,class:"paused-option"},l(n.work_order_no||"작업번호없음")+" - "+l(n.final_product_name||n.product_name||n.step_name||"제품명없음")+" ("+l(n.progress_rate||0)+"% 완료 - "+l(x(n.step_status))+") ",9,Xt))),128))])):p("",!0)],40,Yt),[[we,T.value]]),E.value.length===0&&!f.value?(d(),u("div",Zt,[e("div",null,[e("div",null,[e("strong",null,l(r.value.lineName)+"의 "+l(r.value.lineType==="INNER"?"내포장":"외포장")+" 작업번호가 없습니다.",1)]),t[27]||(t[27]=e("div",{style:{"font-size":"12px","margin-top":"4px"}},[I(" • 새로고침 버튼을 눌러보세요"),e("br"),I(" • 또는 테이블 구조 확인이 필요할 수 있습니다"),e("br"),I(" • 디버깅 패널에서 데이터를 확인해보세요 ")],-1))])])):p("",!0),f.value&&C.value.includes("작업번호")?(d(),u("div",es,[e("div",null,[e("strong",null,l(r.value.lineName)+" 작업번호를 불러오는 중...",1),t[28]||(t[28]=e("div",{style:{"font-size":"12px","margin-top":"4px"}}," 실제 데이터베이스에서 조회 중입니다. ",-1))])])):p("",!0)]),e("div",ts,[t[30]||(t[30]=e("label",{class:"control-label"},"지시량",-1)),e("div",ss,[e("span",as,l(c(a.value.target_quantity)),1),t[29]||(t[29]=e("span",{class:"display-unit"},"개",-1))])])]),e("div",ns,[e("div",ls,[t[32]||(t[32]=e("label",{class:"control-label"},"기투입량",-1)),e("div",os,[e("span",{class:$(["display-value",{"workflow-linked":r.value.lineType==="OUTER"&&i.value.innerOutputQty>0}])},l(c(a.value.current_quantity)),3),t[31]||(t[31]=e("span",{class:"display-unit"},"개",-1))])]),e("div",is,[t[34]||(t[34]=e("label",{class:"control-label"},"미투입량",-1)),e("div",rs,[e("span",{class:$(["display-value remaining-qty",{"remaining-qty-highlight":D()>0}])},l(c(a.value.remaining_quantity)),3),t[33]||(t[33]=e("span",{class:"display-unit"},"개",-1))])])]),e("div",us,[e("div",ds,[t[36]||(t[36]=e("label",{class:"control-label"},"생산속도 (개/초)",-1)),re(e("select",{"onUpdate:modelValue":t[3]||(t[3]=n=>R.value.productionSpeed=n),class:"control-select",disabled:m.value},t[35]||(t[35]=[e("option",{value:"10"},"느림 (10개/초)",-1),e("option",{value:"30"},"보통 (30개/초)",-1),e("option",{value:"60"},"빠름 (60개/초)",-1),e("option",{value:"100"},"매우빠름 (100개/초)",-1)]),8,cs),[[we,R.value.productionSpeed,void 0,{number:!0}]])]),e("div",vs,[e("label",_s,[t[37]||(t[37]=I(" 투입수량 ")),a.value.target_quantity>0?(d(),u("span",ps," (지시: "+l(c(a.value.target_quantity))+"개) ",1)):p("",!0),r.value.lineType==="OUTER"&&i.value.innerOutputQty>0?(d(),u("span",fs," (내포장 완료: "+l(c(i.value.innerOutputQty))+"개) ",1)):p("",!0)]),re(e("input",{"onUpdate:modelValue":t[4]||(t[4]=n=>b.value=n),type:"number",class:$(["control-input",{"workflow-linked":r.value.lineType==="OUTER"&&i.value.innerOutputQty>0,"partial-work":V.value}]),placeholder:r.value.lineType==="OUTER"&&i.value.innerOutputQty>0?i.value.innerOutputQty.toString():"500",disabled:!T.value||m.value||r.value.lineType==="OUTER"&&i.value.innerOutputQty>0,max:a.value.target_quantity,min:"1",onInput:Ie},null,42,ms),[[rt,b.value,void 0,{number:!0}]]),r.value.lineType==="OUTER"&&i.value.innerOutputQty>0?(d(),u("div",ys," 연계: 내포장 완료수량으로 자동 설정됨 ("+l(c(i.value.innerOutputQty))+"개) ",1)):p("",!0),V.value?(d(),u("div",gs," 부분완료 작업 - 남은 수량: "+l(c(D()))+"개 ",1)):p("",!0),b.value>a.value.target_quantity&&a.value.target_quantity>0?(d(),u("div",ws," 투입수량이 지시수량을 초과합니다 ")):p("",!0),r.value.lineType==="OUTER"&&i.value.innerOutputQty>0&&b.value!==i.value.innerOutputQty?(d(),u("div",ks," 내포장 완료수량("+l(c(i.value.innerOutputQty))+"개)과 다릅니다 ",1)):p("",!0)])]),T.value&&a.value.work_order_no?(d(),u("div",bs,[t[46]||(t[46]=e("h4",null,"선택된 작업 정보 (실제 DB 데이터)",-1)),e("div",hs,[e("div",qs,[t[38]||(t[38]=e("span",{class:"label"},"작업번호:",-1)),e("span",Ts,l(a.value.work_order_no),1)]),e("div",Rs,[t[39]||(t[39]=e("span",{class:"label"},"제품명:",-1)),e("span",$s,l(a.value.product_name),1)]),e("div",Es,[t[40]||(t[40]=e("span",{class:"label"},"작업상태:",-1)),e("span",{class:$(["value",je(a.value.step_status)])},l(x(a.value.step_status)),3)]),e("div",Os,[t[41]||(t[41]=e("span",{class:"label"},"지시수량:",-1)),e("span",Cs,l(c(a.value.target_quantity))+"개",1)]),e("div",Ss,[t[42]||(t[42]=e("span",{class:"label"},"현재 진행률:",-1)),e("span",Is,l(a.value.progressRate)+"%",1)]),e("div",Ds,[t[43]||(t[43]=e("span",{class:"label"},"작업자:",-1)),e("span",Ns,l(a.value.worker_name),1)]),e("div",Ws,[t[44]||(t[44]=e("span",{class:"label"},"라인:",-1)),e("span",Ps,l(r.value.lineName),1)]),a.value._original_keys?(d(),u("div",Ms,[t[45]||(t[45]=e("span",{class:"label"},"원본 키:",-1)),e("span",Qs,l(a.value._original_keys.length)+"개 컬럼",1)])):p("",!0)])])):p("",!0)]),e("div",As,[e("div",Ls,[e("button",{disabled:!he.value&&!m.value&&k.value!=="PAUSED",class:$(["btn","btn-work",{working:m.value}]),onClick:Ue},l(Fe()),11,Us),e("button",{disabled:!m.value&&k.value!=="COMPLETED",class:$(["btn","btn-complete",{ready:k.value==="COMPLETED"}]),onClick:We},l(k.value==="COMPLETED"?"완료 처리":"생산 완료"),11,xs),e("button",{disabled:!m.value,class:"btn btn-stop",onClick:Pe}," 작업 종료 ",8,Bs)]),e("div",Ks,[e("button",{disabled:f.value,class:"btn btn-refresh",onClick:le}," 강력 새로고침 ",8,Gs),e("button",{disabled:f.value||m.value,class:"btn btn-reset",title:"라인 초기화",onClick:Ae}," 초기화 ",8,Ys)])])]),e("div",Vs,[t[54]||(t[54]=e("h3",null,"실시간 진행 상황",-1)),e("div",zs,[e("div",Fs,[t[47]||(t[47]=e("div",{class:"card-header"},[e("span",{class:"card-title"},"생산수량")],-1)),e("div",js,l(c(R.value.currentProgress)),1),t[48]||(t[48]=e("div",{class:"card-unit"},"개",-1))]),e("div",Js,[t[49]||(t[49]=e("div",{class:"card-header"},[e("span",{class:"card-title"},"합격수량")],-1)),e("div",Hs,l(c(a.value.output_qty)),1),t[50]||(t[50]=e("div",{class:"card-unit"},"개",-1))]),e("div",Xs,[t[51]||(t[51]=e("div",{class:"card-header"},[e("span",{class:"card-title"},"불량수량")],-1)),e("div",Zs,l(c(a.value.defect_qty)),1),t[52]||(t[52]=e("div",{class:"card-unit"},"개",-1))])]),e("div",ea,[e("div",ta,[t[53]||(t[53]=e("span",null,"전체 진행률",-1)),e("span",sa,l(a.value.progressRate)+"%",1)]),e("div",aa,[e("div",{class:"progress-fill",style:ke({width:a.value.progressRate+"%"})},null,4)])])]),e("div",na,[t[55]||(t[55]=e("h3",null,"작업 로그",-1)),e("div",la,[(d(!0),u(K,null,G(A.value,n=>(d(),u("div",{key:n.id,class:$(["log-item",n.type])},[e("div",oa,l(Xe(n.timestamp)),1),e("div",ia,l(n.message),1)],2))),128))])])]),e("div",ra,[i.value.step==="OUTER"&&i.value.innerCompleted?(d(),u("div",ua,[t[64]||(t[64]=e("h3",null,"워크플로우 정보",-1)),e("div",da,[e("div",ca,[t[59]||(t[59]=e("div",{class:"step-header"},[e("span",{class:"step-title"},"내포장 완료")],-1)),e("div",va,[e("div",_a,[t[56]||(t[56]=e("span",{class:"detail-label"},"작업번호:",-1)),e("span",pa,l(i.value.innerWorkNo),1)]),e("div",fa,[t[57]||(t[57]=e("span",{class:"detail-label"},"완료시간:",-1)),e("span",ma,l(B(i.value.innerCompletionTime)),1)]),i.value.innerOutputQty>0?(d(),u("div",ya,[t[58]||(t[58]=e("span",{class:"detail-label"},"완료수량:",-1)),e("span",ga,l(c(i.value.innerOutputQty))+"개",1)])):p("",!0)])]),t[63]||(t[63]=e("div",{class:"chain-arrow"},null,-1)),e("div",wa,[t[62]||(t[62]=e("div",{class:"step-header"},[e("span",{class:"step-title"},"외포장 진행")],-1)),e("div",ka,[e("div",ba,[t[60]||(t[60]=e("span",{class:"detail-label"},"라인:",-1)),e("span",ha,l(r.value.lineName),1)]),e("div",qa,[t[61]||(t[61]=e("span",{class:"detail-label"},"상태:",-1)),e("span",Ta,l(x(k.value)),1)])])])])])):p("",!0),e("div",Ra,[t[88]||(t[88]=e("h3",null,"현재 작업 정보",-1)),e("div",$a,[e("div",Ea,[t[65]||(t[65]=e("span",{class:"info-label"},"라인 정보",-1)),e("span",Oa,l(r.value.lineName)+" ("+l(r.value.lineId)+")",1)]),e("div",Ca,[t[66]||(t[66]=e("span",{class:"info-label"},"작업번호",-1)),e("span",Sa,l(a.value.work_order_no||"-"),1)]),e("div",Ia,[t[67]||(t[67]=e("span",{class:"info-label"},"제품명",-1)),e("span",Da,l(a.value.product_name||"-"),1)]),e("div",Na,[t[68]||(t[68]=e("span",{class:"info-label"},"포장형태",-1)),e("span",Wa,l(r.value.lineType==="INNER"?"내포장":"외포장"),1)])]),e("div",Pa,[t[73]||(t[73]=e("h4",null,"작업량 정보",-1)),e("div",Ma,[t[69]||(t[69]=e("span",{class:"info-label"},"지시량",-1)),e("span",Qa,l(c(a.value.target_quantity)||"-"),1)]),e("div",Aa,[t[70]||(t[70]=e("span",{class:"info-label"},"기투입량",-1)),e("span",{class:$(["info-value",{"workflow-linked":r.value.lineType==="OUTER"&&i.value.innerOutputQty>0}])},l(c(a.value.current_quantity)||"-"),3)]),e("div",La,[t[71]||(t[71]=e("span",{class:"info-label"},"미투입량",-1)),e("span",{class:$(["info-value remaining-qty",{"remaining-qty-highlight":D()>0}])},l(c(a.value.remaining_quantity)||"-"),3)]),e("div",Ua,[t[72]||(t[72]=e("span",{class:"info-label"},"달성률",-1)),e("span",{class:$(["info-value achievement-rate",He(a.value.achievementRate)])},l(a.value.achievementRate)+"% ",3)])]),e("div",xa,[t[78]||(t[78]=e("h4",null,"시간 정보",-1)),e("div",Ba,[t[74]||(t[74]=e("span",{class:"info-label"},"시작시간",-1)),e("span",Ka,l(B(a.value.start_time)),1)]),e("div",Ga,[t[75]||(t[75]=e("span",{class:"info-label"},"작업시간",-1)),e("span",Ya,l(te.value),1)]),e("div",Va,[t[76]||(t[76]=e("span",{class:"info-label"},"종료예정시간",-1)),e("span",{class:$(["info-value estimated-time",{"time-warning":be.value}])},l(B(a.value.end_time)),3)]),e("div",za,[t[77]||(t[77]=e("span",{class:"info-label"},"예상소요시간",-1)),e("span",Fa,l(Ze(a.value.estimated_duration)),1)])]),e("div",ja,[t[81]||(t[81]=e("h4",null,"품질 정보",-1)),e("div",Ja,[t[79]||(t[79]=e("span",{class:"info-label"},"합격률",-1)),e("span",{class:$(["info-value quality-rate",Je(a.value.passRate)])},l(a.value.passRate)+"% ",3)]),e("div",Ha,[t[80]||(t[80]=e("span",{class:"info-label"},"불량률",-1)),e("span",Xa,l(a.value.defectRate)+"%",1)])]),e("div",Za,[t[84]||(t[84]=e("h4",null,"담당자 정보",-1)),e("div",en,[t[82]||(t[82]=e("span",{class:"info-label"},"작업자명",-1)),e("span",tn,l(a.value.worker_name||"김포장"),1)]),e("div",sn,[t[83]||(t[83]=e("span",{class:"info-label"},"사번",-1)),e("span",an,l(a.value.employee_id||"-"),1)])]),N.value&&a.value._original_keys?(d(),u("div",nn,[t[87]||(t[87]=e("h4",null,"실제 DB 정보",-1)),e("div",ln,[t[85]||(t[85]=e("span",{class:"info-label"},"원본 컬럼 수",-1)),e("span",on,l(a.value._original_keys.length)+"개",1)]),e("div",rn,[t[86]||(t[86]=e("span",{class:"info-label"},"처리 시간",-1)),e("span",un,l(a.value._processed_at?B(new Date(a.value._processed_at)):"-"),1)])])):p("",!0)]),e("div",dn,[e("button",{class:"btn-line-change",onClick:oe}," 다른 라인으로 변경하기 "),e("p",cn,[t[89]||(t[89]=I(" 현재: ")),e("strong",null,l(r.value.lineName),1),t[90]||(t[90]=e("br",null,null,-1)),t[91]||(t[91]=I(" 잘못된 라인을 선택했거나 다른 라인에서 작업하고 싶다면 클릭하세요 "))])])])])]),J.value?(d(),u("div",{key:2,class:"modal-overlay",onClick:M},[e("div",{class:"modal-content",onClick:t[5]||(t[5]=dt(()=>{},["stop"]))},[e("div",vn,[e("h3",null,l(Be()),1),e("button",{class:"modal-close",onClick:M},"닫기")]),e("div",_n,[e("div",pn,[t[98]||(t[98]=e("h4",null,"작업 결과",-1)),e("div",fn,[e("div",mn,[t[92]||(t[92]=e("span",{class:"summary-label"},"지시량",-1)),e("span",yn,l(c(a.value.target_quantity))+"개",1)]),e("div",gn,[t[93]||(t[93]=e("span",{class:"summary-label"},"투입수량",-1)),e("span",wn,l(c(a.value.current_quantity))+"개",1)]),e("div",kn,[t[94]||(t[94]=e("span",{class:"summary-label"},"합격수량",-1)),e("span",bn,l(c(a.value.output_qty))+"개",1)]),e("div",hn,[t[95]||(t[95]=e("span",{class:"summary-label"},"불량수량",-1)),e("span",qn,l(c(a.value.defect_qty))+"개",1)]),e("div",Tn,[t[96]||(t[96]=e("span",{class:"summary-label"},"합격률",-1)),e("span",Rn,l(a.value.passRate)+"%",1)]),e("div",$n,[t[97]||(t[97]=e("span",{class:"summary-label"},"작업시간",-1)),e("span",En,l(te.value),1)])])]),r.value.lineType==="INNER"&&!L.value?(d(),u("div",On,t[99]||(t[99]=[e("div",{class:"info-box"},[e("div",{class:"info-content"},[e("h5",null,"다음 단계: 외포장 라인 선택"),e("p",null," 내포장 작업 완료 후 외포장이 활성화된 라인 선택 페이지로 자동 이동합니다. "),e("ul",null,[e("li",null,"내포장 작업 완료 처리"),e("li",null,"라인 선택 페이지로 자동 이동"),e("li",null,"외포장 라인 자동 활성화"),e("li",null,"추천 라인 표시")])])],-1)]))):r.value.lineType==="OUTER"&&!L.value?(d(),u("div",Cn,t[100]||(t[100]=[ut('<div class="info-box" data-v-f47913b8><div class="info-content" data-v-f47913b8><h5 data-v-f47913b8>전체 포장 작업 완료!</h5><p data-v-f47913b8>모든 포장 단계가 완료되었습니다.</p><div class="completion-chain" data-v-f47913b8><div class="chain-item" data-v-f47913b8><span class="chain-text" data-v-f47913b8>내포장</span><span class="chain-status" data-v-f47913b8>완료</span></div><div class="chain-arrow" data-v-f47913b8>→</div><div class="chain-item" data-v-f47913b8><span class="chain-text" data-v-f47913b8>외포장</span><span class="chain-status" data-v-f47913b8>완료</span></div></div></div></div>',1)]))):p("",!0),L.value?(d(),u("div",Sn,[e("div",In,[e("div",Dn,[t[105]||(t[105]=e("h5",null,"지시량 미달성",-1)),e("div",Nn,[e("div",Wn,[t[101]||(t[101]=e("span",{class:"stat-label"},"지시량:",-1)),e("span",Pn,l(c(a.value.target_quantity))+"개",1)]),e("div",Mn,[t[102]||(t[102]=e("span",{class:"stat-label"},"현재 생산:",-1)),e("span",Qn,l(c(a.value.output_qty))+"개",1)]),e("div",An,[t[103]||(t[103]=e("span",{class:"stat-label"},"미달성:",-1)),e("span",Ln,l(c(D()))+"개",1)]),e("div",Un,[t[104]||(t[104]=e("span",{class:"stat-label"},"달성률:",-1)),e("span",xn,l(H())+"%",1)])]),t[106]||(t[106]=e("p",{class:"warning-text"}," 지시량을 모두 달성하지 못했습니다. 어떻게 처리하시겠습니까? ",-1))])])])):p("",!0),e("p",Bn,l(Ke()),1)]),e("div",Kn,[e("button",{class:"btn-cancel",onClick:M},"취소"),L.value?(d(),u("div",Gn,[e("button",{class:"btn-partial",onClick:Me},l(Ye()),1),e("button",{class:"btn-continue",onClick:Qe}," 나중에 계속하기 ")])):(d(),u("button",{key:1,class:"btn-confirm",onClick:Oe},l(Ge()),1))])])])):p("",!0),se.value?(d(),u("div",Yn,[e("div",Vn,[e("h3",null,l(Ve()),1),e("p",null,l(ze()),1),e("div",zn,[e("div",Fn,[e("div",{class:"progress-fill",style:ke({width:Q.value+"%"})},null,4)]),e("span",jn,l(Math.round(Q.value))+"%",1)])])])):p("",!0),f.value?(d(),u("div",Jn,[t[107]||(t[107]=e("div",{class:"loading-spinner"},null,-1)),e("div",Hn,l(C.value),1)])):p("",!0),ee.value?(d(),u("div",Xn,[e("div",Zn,[t[109]||(t[109]=e("div",{class:"error-header"},[e("h3",null,"연결 오류")],-1)),e("div",el,[e("p",null,l(de.value),1),t[108]||(t[108]=e("p",{class:"error-help"},"서버 상태를 확인하고 다시 시도해주세요.",-1))]),e("div",{class:"error-actions"},[e("button",{class:"btn-error-close",onClick:me},"확인"),e("button",{class:"btn-retry",onClick:Le},"다시 시도")])])])):p("",!0)]))}},nl=nt(tl,[["__scopeId","data-v-f47913b8"]]);export{nl as default};
//# sourceMappingURL=PackageWork-BO6YzdQO.js.map
