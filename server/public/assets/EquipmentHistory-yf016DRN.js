import{d as A,n as d,c as S,x as G,o as J,p as H,i as l,j as r,w as o,g as p,v as K,h as N,q as M,t as i,e as Q,m as w,_ as W}from"./index-1iuYf_qr.js";import{u as D,w as X}from"./xlsx-DrgRuPKf.js";const Z={class:"equipment-history-page"},ee={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},te={class:"flex justify-end gap-2 mt-4"},ae={class:"flex items-center"},ne={class:"flex justify-between items-center mb-4"},oe={class:"va-h5"},se={class:"flex gap-2"},le={class:"flex items-center"},re={class:"flex items-center"},ce={class:"font-semibold"},ie={class:"font-medium"},ue={class:"text-sm"},de={class:"text-sm"},pe={class:"text-sm"},_e={key:0,class:"text-center py-8 text-secondary"},me=A({__name:"EquipmentHistory",setup(fe){const v=d(!1),I=d(!1),x=d(!1),L=d([]),h=d([]),_=d(30),C=d(0),n=d({inspectionLogId:"",equipmentName:"",operatorId:"",dateRange:null});let k=null;const j=[{key:"inspection_log_id",label:"점검 이력 코드",sortable:!0},{key:"eq_name",label:"설비명",sortable:!0},{key:"operator_name",label:"작업자",sortable:!0},{key:"inspection_type_name",label:"점검 유형",sortable:!0},{key:"status_name",label:"점검 진행 상황",sortable:!0},{key:"start_time",label:"시작 시간",sortable:!0},{key:"end_time",label:"종료 시간",sortable:!0},{key:"result_name",label:"판정 결과",sortable:!0},{key:"inspection_remark",label:"비고"},{key:"confirmer_name",label:"확인자"}],z=S(()=>!!(n.value.inspectionLogId||n.value.equipmentName||n.value.operatorId||n.value.dateRange)),m=S(()=>L.value.filter(a=>{if(n.value.inspectionLogId&&!a.inspection_log_id.toString().includes(n.value.inspectionLogId)||n.value.equipmentName&&a.eq_name&&!a.eq_name.toLowerCase().includes(n.value.equipmentName.toLowerCase())||n.value.operatorId&&!a.operator_id.toLowerCase().includes(n.value.operatorId.toLowerCase()))return!1;if(n.value.dateRange&&n.value.dateRange.length===2){const e=new Date(n.value.dateRange[0]),c=new Date(n.value.dateRange[1]),u=new Date(a.start_time);if(u<e||u>c)return!1}return!0})),R=S(()=>_.value<m.value.length),V=()=>{h.value=m.value.slice(0,_.value)};G(m,a=>{C.value=a.length,V()});const B=async()=>{v.value=!0;try{const e=(await K.get("/equipment-history")).data;e.isSuccessed&&(L.value=e.data,C.value=e.totalCount||e.data.length,V())}catch(a){console.error("설비 이력 목록 불러오기 실패:",a),alert("설비 이력 목록을 불러올 수 없습니다.")}finally{v.value=!1}},g=()=>{k&&clearTimeout(k),k=setTimeout(()=>{z.value?_.value=Math.max(m.value.length,999999):_.value=30},300)},E=()=>{I.value=!0,setTimeout(()=>{_.value+=30,V(),I.value=!1},300)},U=()=>{n.value={inspectionLogId:"",equipmentName:"",operatorId:"",dateRange:null},_.value=30},T=a=>({n1:"info",n2:"success",n3:"primary",n4:"danger"})[a]||"secondary",F=a=>({p1:"info",p2:"warning",p3:"success"})[a]||"secondary",O=a=>({j1:"success",j2:"danger"})[a]||"secondary",b=a=>{if(!a||a==="")return"-";try{if(typeof a=="string"){if(/^\d{4}-\d{2}-\d{2} \d{2}:\d{2}$/.test(a))return a.replace("-",".").replace("-",".");if(/^\d{4}-\d{2}-\d{2}$/.test(a))return a.replace(/-/g,".")}const e=new Date(a);if(isNaN(e.getTime()))return"-";const c=e.getFullYear(),u=String(e.getMonth()+1).padStart(2,"0"),f=String(e.getDate()).padStart(2,"0"),s=String(e.getHours()).padStart(2,"0"),y=String(e.getMinutes()).padStart(2,"0");return`${c}.${u}.${f} ${s}:${y}`}catch(e){return console.error("날짜 포맷팅 오류:",e,"Input:",a),"-"}},P=async()=>{if(m.value.length===0){alert("내보낼 데이터가 없습니다.");return}x.value=!0;try{const a=m.value.map(s=>({"점검 이력 코드":s.inspection_log_id,"설비 ID":s.eq_id,설비명:s.eq_name||"-","작업자 ID":s.operator_id,작업자명:s.operator_name||"-","점검 유형":s.inspection_type_name||s.inspection_type_code,"점검 진행 상황":s.status_name||s.status_code,"시작 시간":b(s.start_time),"종료 시간":b(s.end_time),"판정 결과":s.result_name||s.result_code,비고:s.inspection_remark||"-","확인자 ID":s.confirmer_id||"-",확인자명:s.confirmer_name||"-"})),e=D.json_to_sheet(a),c=D.book_new();D.book_append_sheet(c,e,"설비 이력");const f=`설비이력_${new Date().toISOString().slice(0,10)}.xlsx`;X(c,f)}catch(a){console.error("엑셀 내보내기 실패:",a),alert("엑셀 파일 생성에 실패했습니다.")}finally{x.value=!1}};return J(()=>{B()}),(a,e)=>{const c=p("VaIcon"),u=p("VaInput"),f=p("VaDateInput"),s=p("VaButton"),y=p("VaCardContent"),$=p("VaCard"),q=p("VaChip"),Y=p("VaDataTable");return N(),H("div",Z,[e[8]||(e[8]=l("h1",{class:"va-h3 mb-6"},"설비 이력 조회",-1)),r($,{class:"mb-6"},{default:o(()=>[r(y,null,{default:o(()=>[e[5]||(e[5]=l("h2",{class:"va-h5 mb-4"},"검색 조건",-1)),l("div",ee,[r(u,{modelValue:n.value.inspectionLogId,"onUpdate:modelValue":e[0]||(e[0]=t=>n.value.inspectionLogId=t),label:"점검 이력 코드",placeholder:"점검 이력 코드를 입력하세요",clearable:"",onInput:g},{appendInner:o(()=>[r(c,{name:"search",color:"secondary"})]),_:1},8,["modelValue"]),r(u,{modelValue:n.value.equipmentName,"onUpdate:modelValue":e[1]||(e[1]=t=>n.value.equipmentName=t),label:"설비명",placeholder:"설비명을 입력하세요",clearable:"",onInput:g},{appendInner:o(()=>[r(c,{name:"search",color:"secondary"})]),_:1},8,["modelValue"]),r(u,{modelValue:n.value.operatorId,"onUpdate:modelValue":e[2]||(e[2]=t=>n.value.operatorId=t),label:"작업자 사원번호",placeholder:"사원번호를 입력하세요",clearable:"",onInput:g},{appendInner:o(()=>[r(c,{name:"search",color:"secondary"})]),_:1},8,["modelValue"]),r(f,{modelValue:n.value.dateRange,"onUpdate:modelValue":[e[3]||(e[3]=t=>n.value.dateRange=t),g],label:"기간",mode:"range",placeholder:"기간을 선택하세요",clearable:""},null,8,["modelValue"])]),l("div",te,[r(s,{color:"secondary",onClick:U},{default:o(()=>[l("div",ae,[r(c,{name:"refresh",size:"16px",class:"mr-1"}),e[4]||(e[4]=l("span",null,"초기화",-1))])]),_:1})])]),_:1,__:[5]})]),_:1}),r($,null,{default:o(()=>[r(y,null,{default:o(()=>[l("div",ne,[l("h2",oe,"설비 이력 목록 (총 "+i(C.value)+"개)",1),l("div",se,[R.value?(N(),Q(s,{key:0,color:"info",onClick:E,loading:I.value,disabled:!R.value},{default:o(()=>[l("div",le,[r(c,{name:"expand_more",size:"16px",class:"mr-1"}),e[6]||(e[6]=l("span",null,"더보기",-1))])]),_:1},8,["loading","disabled"])):M("",!0),r(s,{color:"success",onClick:P,loading:x.value},{default:o(()=>[l("div",re,[r(c,{name:"file_download",size:"16px",class:"mr-1"}),e[7]||(e[7]=l("span",null,"엑셀 다운로드",-1))])]),_:1},8,["loading"])])]),r(Y,{items:h.value,columns:j,loading:v.value,hoverable:"","sticky-header":""},{"cell(inspection_log_id)":o(({rowData:t})=>[l("span",ce,i(t.inspection_log_id),1)]),"cell(eq_name)":o(({rowData:t})=>[l("span",ie,i(t.eq_name||"-"),1)]),"cell(operator_name)":o(({rowData:t})=>[l("span",null,i(t.operator_name||t.operator_id),1)]),"cell(inspection_type_name)":o(({rowData:t})=>[r(q,{color:T(t.inspection_type_code),size:"small",flat:""},{default:o(()=>[w(i(t.inspection_type_name||t.inspection_type_code),1)]),_:2},1032,["color"])]),"cell(status_name)":o(({rowData:t})=>[r(q,{color:F(t.status_code),size:"small",flat:""},{default:o(()=>[w(i(t.status_name||t.status_code),1)]),_:2},1032,["color"])]),"cell(start_time)":o(({rowData:t})=>[l("span",ue,i(b(t.start_time)),1)]),"cell(end_time)":o(({rowData:t})=>[l("span",de,i(b(t.end_time)),1)]),"cell(result_name)":o(({rowData:t})=>[r(q,{color:O(t.result_code),size:"small",flat:""},{default:o(()=>[w(i(t.result_name||t.result_code),1)]),_:2},1032,["color"])]),"cell(inspection_remark)":o(({rowData:t})=>[l("span",pe,i(t.inspection_remark||"-"),1)]),"cell(confirmer_name)":o(({rowData:t})=>[l("span",null,i(t.confirmer_name||t.confirmer_id||"-"),1)]),_:1},8,["items","loading"]),h.value.length===0&&!v.value?(N(),H("div",_e," 조회된 설비 이력이 없습니다. ")):M("",!0)]),_:1})]),_:1})])}}}),be=W(me,[["__scopeId","data-v-696caa2a"]]);export{be as default};
//# sourceMappingURL=EquipmentHistory-yf016DRN.js.map
