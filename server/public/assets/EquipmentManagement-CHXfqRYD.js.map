{"version":3,"file":"EquipmentManagement-CHXfqRYD.js","sources":["../../../client/src/pages/equipment/EquipmentManagement.vue"],"sourcesContent":["<template>\n  <div class=\"equipment-management-page\">\n    <h1 class=\"va-h3 mb-6\">ÏÑ§ÎπÑ Í¥ÄÎ¶¨</h1>\n\n    <!-- Í≤ÄÏÉâ -->\n    <VaCard class=\"mb-6\">\n      <VaCardContent>\n        <h2 class=\"va-h5 mb-4\">Í≤ÄÏÉâ Ï°∞Í±¥</h2>\n        <div class=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\n          <VaInput\n            v-model=\"searchParams.equipmentCode\"\n            label=\"ÏÑ§ÎπÑÎ≤àÌò∏\"\n            placeholder=\"ÏÑ§ÎπÑÎ≤àÌò∏ ÏûÖÎ†•\"\n            clearable\n          />\n          <VaInput\n            v-model=\"searchParams.equipmentName\"\n            label=\"ÏÑ§ÎπÑÎ™Ö\"\n            placeholder=\"ÏÑ§ÎπÑÎ™Ö ÏûÖÎ†•\"\n            clearable\n          />\n          <VaSelect\n            v-model=\"searchParams.category\"\n            label=\"ÏÑ§ÎπÑÎ∂ÑÎ•ò\"\n            :options=\"categoryOptions\"\n            text-by=\"label\"\n            value-by=\"value\"\n            clearable\n            placeholder=\"Ï†ÑÏ≤¥\"\n          />\n          <VaSelect\n            v-model=\"searchParams.status\"\n            label=\"ÏÑ§ÎπÑÏÉÅÌÉú\"\n            :options=\"statusOptions\"\n            text-by=\"label\"\n            value-by=\"value\"\n            clearable\n            placeholder=\"Ï†ÑÏ≤¥\"\n          />\n        </div>\n        <div class=\"flex justify-end gap-2 mt-4\">\n          <VaButton color=\"secondary\" @click=\"resetSearch\">Ï¥àÍ∏∞Ìôî</VaButton>\n        </div>\n      </VaCardContent>\n    </VaCard>\n\n    <!-- Î™©Î°ù -->\n    <VaCard>\n      <VaCardContent>\n        <div class=\"flex justify-between items-center mb-4\">\n          <h2 class=\"va-h5\">\n            ÏÑ§ÎπÑ Î™©Î°ù (Ï¥ù {{ filteredEquipments.length }}Í∞ú)\n          </h2>\n          <div class=\"flex gap-2\">\n            <VaButton color=\"warning\" @click=\"handleEdit\">ÏàòÏ†ï</VaButton>\n            <VaButton color=\"danger\" @click=\"handleDelete\">ÏÇ≠Ï†ú</VaButton>\n          </div>\n        </div>\n\n        <VaDataTable\n          v-model=\"selectedRows\"\n          :items=\"filteredEquipments\"\n          :columns=\"columns\"\n          item-key=\"eq_id\"\n          selectable\n          select-mode=\"multiple\"\n          sticky-header\n          hoverable\n        >\n          <template #cell(eq_group_name)=\"{ rowData }\">\n            <VaChip\n              :color=\"getCategoryColor(rowData.eq_group_code)\"\n              size=\"small\"\n              flat\n            >\n              {{ rowData.eq_group_name || rowData.eq_group_code }}\n            </VaChip>\n          </template>\n          <template #cell(location)=\"{ rowData }\">\n            <span class=\"text-sm\">{{ getLocationText(rowData) }}</span>\n          </template>\n          <template #cell(eq_run_name)=\"{ rowData }\">\n            <VaChip\n              :color=\"getStatusColor(rowData.eq_run_code)\"\n              size=\"small\"\n              flat\n            >\n              {{ rowData.eq_run_name || rowData.eq_run_code }}\n            </VaChip>\n          </template>\n        </VaDataTable>\n      </VaCardContent>\n    </VaCard>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, computed, onMounted } from \"vue\";\nimport { useRouter } from \"vue-router\";\nimport axios from \"axios\";\nimport { useAuthStore } from \"@/stores/authStore\";\n\nconst authStore = useAuthStore();\n\nconsole.log(\"‚úÖ auth_type Í∞íÏùÄ:\", authStore.user?.auth_type);\n\ninterface Equipment {\n  eq_id: string;\n  eq_name: string;\n  eq_group_code: string;\n  eq_group_name?: string;\n  eq_run_code: string;\n  eq_run_name?: string;\n  factory_name?: string;\n  floor_name?: string;\n  room_name?: string;\n}\n\ninterface CodeOption {\n  label: string;\n  value: string;\n}\n\nconst router = useRouter();\nconst equipments = ref<Equipment[]>([]);\nconst selectedRows = ref<Equipment[]>([]);\n\nconst searchParams = ref({\n  equipmentCode: \"\",\n  equipmentName: \"\",\n  category: \"\",\n  status: \"\",\n});\n\nconst categoryOptions = ref<CodeOption[]>([]);\nconst statusOptions = ref<CodeOption[]>([]);\n\nconst columns = [\n  { key: \"eq_id\", label: \"ÏÑ§ÎπÑ Î≤àÌò∏\", sortable: true },\n  { key: \"eq_name\", label: \"ÏÑ§ÎπÑÎ™Ö\", sortable: true },\n  { key: \"eq_group_name\", label: \"Î∂ÑÎ•ò\", sortable: true },\n  { key: \"location\", label: \"ÏúÑÏπò\", sortable: true },\n  { key: \"eq_run_name\", label: \"ÏÑ§ÎπÑÏÉÅÌÉú\", sortable: true },\n];\n\nconst filteredEquipments = computed(() =>\n  equipments.value.filter((eq) => {\n    const matchCode =\n      !searchParams.value.equipmentCode ||\n      eq.eq_id\n        .toLowerCase()\n        .includes(searchParams.value.equipmentCode.toLowerCase());\n    const matchName =\n      !searchParams.value.equipmentName ||\n      eq.eq_name\n        .toLowerCase()\n        .includes(searchParams.value.equipmentName.toLowerCase());\n    const matchCategory =\n      !searchParams.value.category ||\n      eq.eq_group_code === searchParams.value.category;\n    const matchStatus =\n      !searchParams.value.status ||\n      eq.eq_run_code === searchParams.value.status;\n    return matchCode && matchName && matchCategory && matchStatus;\n  }),\n);\n\nconst resetSearch = async () => {\n  searchParams.value = {\n    equipmentCode: \"\",\n    equipmentName: \"\",\n    category: \"\",\n    status: \"\",\n  };\n  selectedRows.value = [];\n  await loadEquipments();\n};\n\n// ÏÑ§ÎπÑ Í¥ÄÎ¶¨ ÌéòÏù¥ÏßÄÏùò handleEdit Ìï®Ïàò\nconst handleEdit = async () => {\n  if (authStore.user?.department_code !== \"04\") {\n    alert(\"ÏÑ§ÎπÑÌåÄÎßå ÏàòÏ†ïÌï† Ïàò ÏûàÏäµÎãàÎã§.\");\n    return;\n  }\n\n  if (selectedRows.value.length !== 1) {\n    alert(\"ÏàòÏ†ïÌï† ÏÑ§ÎπÑ 1Í∞úÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.\");\n    return;\n  }\n\n  const id = selectedRows.value[0].eq_id;\n  console.log(\"üîó ÏàòÏ†ï Î≤ÑÌäº ÌÅ¥Î¶≠. Ïù¥ÎèôÌï† ID:\", id); // Ïù¥ Î°úÍ∑∏ Ï∂îÍ∞Ä\n\n  router.push({\n    path: \"/faq/equipment-register\",\n    query: {\n      mode: \"edit\",\n      eq_id: id, // Ïù¥ Í∞íÏù¥ Ï†úÎåÄÎ°ú ÏÑ§Ï†ïÎêòÎäîÏßÄ ÌôïÏù∏\n    },\n  });\n};\n\nconst handleDelete = async () => {\n  if (authStore.user?.department_code !== \"04\") {\n    alert(\"ÏÑ§ÎπÑÌåÄÎßå ÏÇ≠Ï†úÌï† Ïàò ÏûàÏäµÎãàÎã§.\");\n    return;\n  }\n\n  if (selectedRows.value.length === 0) {\n    alert(\"ÏÇ≠Ï†úÌï† ÏÑ§ÎπÑÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.\");\n    return;\n  }\n  const confirmed = confirm(\n    `${selectedRows.value.length}Í∞ú ÏÑ§ÎπÑÎ•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?`,\n  );\n  if (!confirmed) return;\n\n  const ids = selectedRows.value.map((eq) => eq.eq_id);\n  try {\n    await axios.post(\"/equipments/delete\", { eq_ids: ids });\n    alert(\"ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.\");\n    await loadEquipments();\n    selectedRows.value = [];\n  } catch (err) {\n    console.error(err);\n    alert(\"ÏÇ≠Ï†ú Ïã§Ìå®\");\n  }\n};\n\nconst loadCommonCodes = async () => {\n  const res = await axios.get(\"/common-codes?groups=0E,0S\");\n  categoryOptions.value = res.data[\"0E\"] || [];\n  statusOptions.value = res.data[\"0S\"] || [];\n};\n\nconst loadEquipments = async () => {\n  const res = await axios.get(\"/equipments\");\n  if (res.data.isSuccessed) {\n    equipments.value = res.data.data.map((eq: any) => ({\n      ...eq,\n      eq_id: eq.eq_id?.toString(),\n    }));\n  }\n};\n\nconst getCategoryColor = (code: string) =>\n  ({ e1: \"primary\", e2: \"success\", e3: \"warning\" })[code] || \"secondary\";\nconst getStatusColor = (code: string) =>\n  ({ s1: \"success\", s2: \"info\", s3: \"danger\" })[code] || \"secondary\";\nconst getLocationText = (eq: Equipment) =>\n  [eq.factory_name, eq.floor_name, eq.room_name].filter(Boolean).join(\" > \") ||\n  \"-\";\n\nonMounted(() => {\n  loadEquipments();\n  loadCommonCodes();\n});\n</script>\n\n<style scoped>\n.equipment-management-page {\n  padding: 1.5rem;\n}\n</style>\n"],"names":["authStore","useAuthStore","_a","router","useRouter","equipments","ref","selectedRows","searchParams","categoryOptions","statusOptions","columns","filteredEquipments","computed","eq","matchCode","matchName","matchCategory","matchStatus","resetSearch","loadEquipments","handleEdit","id","handleDelete","ids","axios","err","loadCommonCodes","res","getCategoryColor","code","getStatusColor","getLocationText","onMounted","_openBlock","_createElementBlock","_hoisted_1","_cache","_createElementVNode","_createVNode","_component_VaCard","_component_VaCardContent","_hoisted_2","_component_VaInput","$event","_component_VaSelect","_hoisted_3","_component_VaButton","_hoisted_4","_hoisted_5","_hoisted_6","_component_VaDataTable","_withCtx","rowData","_component_VaChip","_createTextVNode","_toDisplayString","_hoisted_7"],"mappings":"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"}