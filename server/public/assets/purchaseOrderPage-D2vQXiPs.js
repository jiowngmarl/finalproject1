import{d as D,n as d,o as N,p as B,i as p,j as n,w as s,g as i,v as m,h as L,m as f,t as R,_ as q}from"./index-DTBJ0DMA.js";const x={class:"mrp-page"},F={class:"table-section"},j={class:"table-section"},E={class:"button-wrap"},T=D({__name:"purchaseOrderPage",setup(Y){const v=d([]),_=d([]),o=d([]),U=d(null),h=d(1),r=d([]),w=[{key:"material_code",label:"자재코드"},{key:"material_name",label:"자재명"},{key:"material_safty",label:"안전재고"},{key:"material_unit",label:"단위"},{key:"material_cls",label:"분류"},{key:"purchase_order_quantity",label:"발주수량"},{key:"action",label:"선택"}],$=[{key:"select",label:"선택"},{key:"purchase_order_name",label:"발주명"},{key:"material_code",label:"자재코드"},{key:"material_name",label:"자재명"},{key:"purchase_order_quantity",label:"요청수량"},{key:"purchase_order_date",label:"발주 요청일"},{key:"material_unit",label:"단위"},{key:"due_date",label:"납기일"},{key:"account_id",label:"거래처코드"},{key:"account_name",label:"거래처 명"},{key:"name",label:"담당자"}],g=e=>{if(!e)return"";const a=typeof e=="string"?new Date(e):e;return`${a.getFullYear()}-${a.getMonth()+1}-${a.getDate()}`},k=async()=>{try{const e=await m.get("/purchase");_.value=Array.isArray(e.data)?e.data:[]}catch(e){console.error("계획 조회 실패",e),_.value=[]}},y=async()=>{try{const e=await m.get("/purchaseIn");o.value=Array.isArray(e.data)?e.data:[]}catch(e){console.error("계획 조회 실패",e),_.value=[]}},C=async()=>{try{const e=await m.get("/account");v.value=e.data}catch(e){console.error("거래처 목록 불러오기 실패",e)}},A=async e=>{try{U.value=e,await m.put(`/purchase/${e.purchase_order_id}`),await k(),await y()}catch(a){console.error("MRP 계산 실패",a)}},O=async()=>{if(r.value.length===0){alert("선택된 항목이 없습니다.");return}const a=o.value.filter(l=>r.value.includes(l.purchase_order_id)).map(l=>({purchase_order_id:l.purchase_order_id,due_date:g(l.due_date),account_id:l.account_id,name:l.name}));try{for(const l of a)(await m.put(`/puOrder/${l.purchase_order_id}`,l)).data.isSuccessed||console.warn(`❌ 발주 등록 실패: ${l.purchase_order_id}`);alert("발주 등록 완료!"),r.value=[],y()}catch(l){console.error("발주 등록 실패:",l),alert("서버 오류 발생")}},I=e=>{const a=String(o.value[e].account_id),l=v.value.find(u=>String(u.account_id)===a);l&&(o.value[e].account_name=l.account_name)},M=e=>{const a=o.value[e].account_name,l=v.value.find(u=>u.account_name===a);l&&(o.value[e].account_id=l.account_id)};return N(()=>{k(),y(),C()}),(e,a)=>{const l=i("va-button"),u=i("va-data-table"),P=i("va-pagination"),S=i("va-checkbox"),z=i("va-date-input"),b=i("va-input");return L(),B("div",x,[p("div",F,[a[2]||(a[2]=p("h3",{class:"table-title"},"발주 요청 자재",-1)),n(u,{items:_.value,columns:w,"per-page":5,"current-page":h.value,"track-by":"purchase_order_id"},{"cell(action)":s(({row:t})=>[n(l,{size:"small",onClick:c=>A(t.source)},{default:s(()=>a[1]||(a[1]=[f("선택")])),_:2,__:[1]},1032,["onClick"])]),_:1},8,["items","current-page"]),n(P,{modelValue:h.value,"onUpdate:modelValue":a[0]||(a[0]=t=>h.value=t),pages:Math.ceil(_.value.length/5),class:"mt-2"},null,8,["modelValue","pages"])]),p("div",j,[a[4]||(a[4]=p("h3",{class:"table-title"},"발주 등록",-1)),n(u,{items:o.value,columns:$,"track-by":"purchase_order_id"},{"cell(select)":s(({row:t})=>[n(S,{"model-value":r.value.includes(t.source.purchase_order_id),"onUpdate:modelValue":c=>{const V=t.source.purchase_order_id;c?r.value.push(V):r.value.splice(r.value.indexOf(V),1)}},null,8,["model-value","onUpdate:modelValue"])]),"cell(purchase_order_date)":s(({row:t})=>[f(R(g(t.source.purchase_order_date)),1)]),"cell(due_date)":s(({rowIndex:t})=>[n(z,{modelValue:o.value[t].due_date,"onUpdate:modelValue":c=>o.value[t].due_date=c,placeholder:"납기일",clearable:!1,style:{width:"130px","min-width":"0"}},null,8,["modelValue","onUpdate:modelValue"])]),"cell(account_id)":s(({rowIndex:t})=>[n(b,{modelValue:o.value[t].account_id,"onUpdate:modelValue":c=>o.value[t].account_id=c,placeholder:"거래처 코드",size:"small",class:"input-compact",onInput:c=>I(t)},null,8,["modelValue","onUpdate:modelValue","onInput"])]),"cell(account_name)":s(({rowIndex:t})=>[n(b,{modelValue:o.value[t].account_name,"onUpdate:modelValue":c=>o.value[t].account_name=c,placeholder:"거래처명",size:"small",class:"input-compact",onInput:c=>M(t)},null,8,["modelValue","onUpdate:modelValue","onInput"])]),"cell(name)":s(({rowIndex:t})=>[n(b,{modelValue:o.value[t].name,"onUpdate:modelValue":c=>o.value[t].name=c,placeholder:"담당자",size:"small",class:"input-compact"},null,8,["modelValue","onUpdate:modelValue"])]),_:1},8,["items"]),p("div",E,[n(l,{onClick:O},{default:s(()=>a[3]||(a[3]=[f("등록")])),_:1,__:[3]})])])])}}}),H=q(T,[["__scopeId","data-v-f4e514a6"]]);export{H as default};
//# sourceMappingURL=purchaseOrderPage-D2vQXiPs.js.map
