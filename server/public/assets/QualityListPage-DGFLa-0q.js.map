{"version":3,"file":"QualityListPage-DGFLa-0q.js","sources":["../../../client/src/pages/quality/QualityListPage.vue"],"sourcesContent":["<template>\n  <div class=\"product-form\">\n    <h3 class=\"form-title\">제품품질검사</h3>\n    <br />\n\n    <div class=\"form-section\">\n      <h3 class=\"form-title\">조회</h3>\n      <br />\n      <div class=\"input-row\">\n        <!-- 제품명 선택 -->\n        <va-select\n          v-model=\"form.productCode\"\n          :options=\"productOptions\"\n          label=\"제품명\"\n          class=\"quarter-width\"\n          value-by=\"value\"\n          text-by=\"label\"\n          placeholder=\"제품을 선택하세요\"\n          @update:modelValue=\"onProductChange\"\n        />\n\n        <!-- 작업지시서 번호 선택 -->\n        <va-select\n          v-model=\"form.workOrderNo\"\n          :options=\"workOrderOptions\"\n          label=\"작업지시서 번호\"\n          class=\"quarter-width\"\n          value-by=\"value\"\n          text-by=\"label\"\n          placeholder=\"작업지시서 번호를 선택하세요\"\n          :disabled=\"workOrderOptions.length === 0\"\n        />\n      </div>\n      <div class=\"input-row\">\n        <va-input v-model=\"resultInfo.processName\" label=\"공정명\" readonly />\n        <va-input v-model=\"resultInfo.managerId\" label=\"담당자\" readonly />\n        <va-input v-model=\"resultInfo.passQty\" label=\"투입량\" readonly />\n      </div>\n      <div class=\"input-row\">\n        <va-input\n          v-if=\"finalResultVisible\"\n          v-model=\"form.qualRemark\"\n          label=\"불합 판정 상세 사유\"\n          placeholder=\"불합 사유를 입력하세요\"\n          class=\"half-width\"\n          :rules=\"[(v) => !!v || '불합 사유는 필수입니다.']\"\n        />\n      </div>\n    </div>\n    <div class=\"form-section\">\n      <table class=\"custom-table\">\n        <thead>\n          <tr>\n            <th>판정방식</th>\n            <th>단위</th>\n            <th>기준값</th>\n            <th>측정값</th>\n            <th>판정결과</th>\n          </tr>\n        </thead>\n        <tbody>\n          <tr v-for=\"(item, index) in inspectionStandardList\" :key=\"index\">\n            <td>{{ item.insp_value_type }}</td>\n            <td>{{ item.insp_unit }}</td>\n            <td>{{ item.insp_value_qty }}</td>\n            <td>\n              <va-input\n                v-model.number=\"item.insp_measured_value\"\n                @input=\"evaluateResult(item)\"\n                type=\"number\"\n                placeholder=\"측정값 입력\"\n              />\n            </td>\n            <td>\n              <va-input\n                :model-value=\"item.insp_result || '판정대기'\"\n                readonly\n                color=\"primary\"\n              />\n            </td>\n          </tr>\n        </tbody>\n      </table>\n      <div class=\"form-buttons\">\n        <va-button @click=\"submitForm\" color=\"primary\">등록</va-button>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\" setup>\nimport { ref, onMounted, watch, computed } from \"vue\";\nimport axios from \"axios\";\n\n// 폼 상태\nconst form = ref({\n  productCode: \"\",\n  workOrderNo: \"\",\n  qualRemark: \"\",\n});\n\n// 검사 기준 목록\nconst inspectionStandardList = ref<\n  {\n    insp_value_type: string;\n    insp_unit: string;\n    insp_value_qty: number;\n    insp_value_min: number;\n    insp_value_max: number;\n    insp_measured_value: number;\n    insp_result: string;\n  }[]\n>([]);\n\n// 이거 지워도 되는건지 확인\nconst finalResult = computed(() => {\n  return inspectionStandardList.value.some((item) => item.insp_result !== \"합\")\n    ? \"불합\"\n    : \"합\";\n});\n\nconst finalResultVisible = computed(() => {\n  return inspectionStandardList.value.some((item) => {\n    return (\n      item.insp_measured_value !== undefined &&\n      item.insp_measured_value !== null &&\n      item.insp_result === \"불합\"\n    );\n  });\n});\n\n// 제품명 옵션 리스트\nconst productOptions = ref<{ label: string; value: string }[]>([]);\n\n// 작업지시서 번호 옵션 리스트\nconst workOrderOptions = ref<{ label: string; value: string }[]>([]);\n\n// 페이지 진입 시 제품명 목록 불러오기\nonMounted(async () => {\n  try {\n    const res = await axios.get(\"/qualitys/productList\");\n    productOptions.value = res.data.map((item: any) => ({\n      label: item.product_name,\n      value: item.product_code,\n    }));\n  } catch (err) {\n    console.error(\"제품명 목록 조회 실패:\", err);\n  }\n});\n\n// 제품 선택 시 작업지시서 번호 목록 불러오기\nconst onProductChange = async (selectedProductCode: string) => {\n  console.log(\"제품 선택:\", selectedProductCode);\n\n  form.value.workOrderNo = \"\";\n  workOrderOptions.value = [];\n\n  if (!selectedProductCode) return;\n\n  try {\n    const res = await axios.get(\"/qualitys/workOrderNoList\", {\n      params: { productCode: selectedProductCode },\n    });\n    workOrderOptions.value = res.data.map((item: any) => ({\n      label: item.work_order_no,\n      value: item.work_order_no,\n    }));\n  } catch (err) {\n    console.error(\"작업지시서 목록 조회 실패:\", err);\n  }\n};\n\nconst resultInfo = ref({\n  processName: \"\",\n  managerId: \"\",\n  passQty: 0,\n});\n\n// 작업지시서 선택 시 상세 정보 조회\nwatch(\n  () => form.value.workOrderNo,\n  async (newVal) => {\n    if (!newVal) {\n      resultInfo.value = { processName: \"\", managerId: \"\", passQty: 0 };\n      return;\n    }\n\n    try {\n      const res = await axios.get(\"/qualitys/workOrderDetail\", {\n        params: { workOrderNo: newVal },\n      });\n\n      if (res.data.length > 0) {\n        const first = res.data[0]; // 여러 개 중 첫 번째만 표시\n        resultInfo.value = {\n          processName: first.process_name || \"\",\n          managerId: first.manager_id || \"\",\n          passQty: first.pass_qty || 0,\n        };\n      } else {\n        resultInfo.value = { processName: \"\", managerId: \"\", passQty: 0 };\n      }\n    } catch (err) {\n      console.error(\"작업지시서 상세 조회 실패:\", err);\n    }\n  },\n);\n\nwatch(\n  () => resultInfo.value.processName,\n  async (processName) => {\n    if (!processName) {\n      inspectionStandardList.value = [];\n      return;\n    }\n\n    try {\n      const res = await axios.get(\"/qualitys/inspectionStandard\", {\n        params: { processName },\n      });\n      console.log(\"검사 기준 응답:\", res.data); // ← 디버깅용\n      inspectionStandardList.value = res.data;\n    } catch (err) {\n      console.error(\"검사 기준 조회 실패:\", err);\n      inspectionStandardList.value = [];\n    }\n  },\n);\n\nconst evaluateResult = (item: any) => {\n  const value = item.insp_measured_value;\n\n  if (value === null || value === undefined || value === \"\") {\n    item.insp_result = \"판정대기\";\n    return;\n  }\n\n  const min = item.insp_value_min;\n  const max = item.insp_value_max;\n\n  if (value >= min && value <= max) {\n    item.insp_result = \"합\";\n  } else {\n    item.insp_result = \"불합\";\n  }\n};\n\nconst submitForm = async () => {\n  if (!form.value.productCode || !form.value.workOrderNo) {\n    alert(\"제품명과 작업지시서 번호를 선택하세요.\");\n    return;\n  }\n\n  const totalMeasured = inspectionStandardList.value\n    .map((item) => item.insp_measured_value)\n    .filter((v) => v !== null && v !== undefined);\n\n  const averageMeasuredValue =\n    totalMeasured.length > 0\n      ? totalMeasured.reduce((a, b) => a + b, 0) / totalMeasured.length\n      : null;\n\n  if (averageMeasuredValue === null) {\n    alert(\"측정값을 입력해주세요.\");\n    return;\n  }\n\n  if (finalResultVisible.value && !form.value.qualRemark) {\n    alert(\"불합 사유를 입력해주세요.\");\n    return;\n  }\n\n  const inspValueQty =\n    finalResult.value === \"불합\" ? resultInfo.value.passQty : 0;\n\n  try {\n    const res = await axios.post(\"/qualitys/registerTest\", {\n      productCode: form.value.productCode,\n      workOrderNo: form.value.workOrderNo,\n      qual_measured_value: averageMeasuredValue,\n      qual_result: finalResult.value,\n      process_name: resultInfo.value.processName,\n      pass_qty: resultInfo.value.passQty, // 전체 투입량\n      insp_value_qty: inspValueQty, // 여기 새로 추가됨\n      qual_remark: finalResultVisible.value ? form.value.qualRemark : null,\n    });\n\n    if (res.data.success) {\n      alert(\"검사 결과 등록 완료\");\n      form.value.qualRemark = \"\";\n    } else {\n      alert(\"등록 실패\");\n    }\n  } catch (err) {\n    console.error(\"등록 오류:\", err);\n    alert(\"서버 오류로 등록 실패\");\n  }\n};\n</script>\n\n<style scoped>\n/* 전체 레이아웃 */\n.product-page {\n  padding: 1.5rem;\n  display: flex;\n  justify-content: center;\n  height: 739px;\n}\n\n.product-container {\n  width: 1060px;\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n}\n\n.product-form {\n  border-radius: 0.5rem;\n  box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);\n  padding: 1rem;\n}\n\n/* 섹션 스타일 */\n.form-section {\n  border: 1px solid #ccc;\n  border-radius: 0.5rem;\n  padding: 1rem;\n  margin-bottom: 1rem;\n  background-color: white;\n}\n\n.form-title {\n  font-size: 1.125rem;\n  font-weight: 600;\n  margin-bottom: 0.5rem;\n}\n\n/* 입력 행 정렬 */\n.input-row {\n  display: flex;\n  gap: 1rem;\n  margin-bottom: 0.5rem;\n}\n\n/* 셀렉트 박스 기본 스타일 */\nselect {\n  border: 1px solid #ccc;\n  border-radius: 4px;\n  padding: 0.3rem 0.5rem;\n  font-size: 1rem;\n  outline: none;\n  box-sizing: border-box;\n}\n\n/* 너비 클래스 */\n.quarter-width {\n  flex: 1;\n}\n\n.half-width {\n  flex: 2;\n}\n\n/* 버튼 정렬 */\n.form-buttons {\n  display: flex;\n  justify-content: flex-end;\n  gap: 0.5rem;\n  margin-top: 0.5rem;\n}\n\n/* 테이블 스타일 */\n.custom-table {\n  width: 100%;\n  border-collapse: collapse;\n  background-color: white;\n  border-radius: 0.5rem;\n  overflow: hidden;\n  table-layout: fixed; /* 추가: 고정된 열 너비를 적용하려면 필요 */\n}\n\n.custom-table th,\n.custom-table td {\n  padding: 0.75rem;\n  border-bottom: 1px solid #e0e0e0;\n  text-align: center;\n  width: 25%; /* ✅ 추가된 부분 */\n  box-sizing: border-box; /* ✅ 패딩 포함한 계산을 위해 추가 */\n}\n\n.custom-table th {\n  background-color: #ffffff;\n  font-weight: bold;\n}\n</style>\n"],"names":["form","ref","inspectionStandardList","finalResult","computed","item","finalResultVisible","productOptions","workOrderOptions","onMounted","res","axios","err","onProductChange","selectedProductCode","resultInfo","watch","newVal","first","processName","evaluateResult","value","min","max","submitForm","totalMeasured","v","averageMeasuredValue","a","b","inspValueQty","_openBlock","_createElementBlock","_hoisted_1","_cache","_createElementVNode","_hoisted_2","_hoisted_3","_createVNode","_component_va_select","$event","_hoisted_4","_component_va_input","_hoisted_5","_createBlock","_hoisted_6","_hoisted_7","_Fragment","_renderList","index","_toDisplayString","_hoisted_8","_component_va_button"],"mappings":"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"}