import{d as T,n as _,o as V,p as O,i as p,j as d,w as s,g,v as n,h as U,m,t as b,_ as P}from"./index-DTBJ0DMA.js";const Q={class:"receipt-page"},B={class:"table-section"},F={class:"table-section"},Y=T({__name:"receivingManagementPage",setup(I){const h=t=>{const e=new Date(t),r=new Date(e.getTime()+9*60*60*1e3);return`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}-${String(r.getDate()).padStart(2,"0")} ${String(r.getHours()).padStart(2,"0")}:${String(r.getMinutes()).padStart(2,"0")}`},M=t=>t.split("T")[0],k=t=>{const e=new Date,r=`${e.getFullYear()}${String(e.getMonth()+1).padStart(2,"0")}${String(e.getDate()).padStart(2,"0")}`,i=Math.floor(100+Math.random()*900);return`LOT${t}-${r} - ${i}`},$=_([]),f=_([]),w=_(1),x=_(1),c=_([]),C=[{key:"select",label:"선택"},{key:"purchase_order_id",label:"발주코드"},{key:"material_code",label:"자재코드"},{key:"material_name",label:"자재명"},{key:"material_unit",label:"단위"},{key:"purchase_order_quantity",label:"발주 수량"},{key:"received_quantity",label:"받은 수량"},{key:"receive_qty",label:"수령 수량"},{key:"purchase_order_date",label:"발주일"},{key:"account_id",label:"거래처코드"},{key:"account_name",label:"거래처명"}],L=[{key:"purchase_order_id",label:"발주코드"},{key:"material_code",label:"자재코드"},{key:"material_name",label:"자재명"},{key:"purchase_order_quantity",label:"입고 수량"},{key:"material_unit",label:"단위"},{key:"material_expiration_date",label:"유통기한"},{key:"lot_number",label:"LOT번호"},{key:"action",label:"입고"}],S=async()=>{const t=await n.get("/materialLot");$.value=t.data},q=async()=>{const t=await n.get("/orderCheck");f.value=t.data},D=async t=>{const r={lot_number:k(t.material_code),material_code:t.material_code,expiry_date:M(t.material_expiration_date),quantity:t.purchase_order_quantity,purchase_order_id:t.purchase_order_id},i=await n.post("/materialLot",r),u=await n.put(`/materialLot/${r.purchase_order_id}`);i.data.isSuccessed&&u.data.isUpdated?(alert("LOT 등록 완료!"),await S()):alert("등록 실패")},N=async()=>{for(const t of c.value){const e=t.purchase_order_id,r=Number(t.receive_qty||0);if(!(await n.put(`/receiveQty/${e}`,{receive_qty:r})).data.isUpdated){alert(`[${e}] 수령 수량 업데이트 실패`);continue}const o=(await n.get(`/orderCheck/${e}`)).data[0];if(console.log(o.received_quantity),console.log(o.purchase_order_quantity),console.log(`${e}`),o.received_quantity===o.purchase_order_quantity){const a=new Date,l=`${a.getFullYear()}${String(a.getMonth()+1).padStart(2,"0")}${String(a.getDate()).padStart(2,"0")}`,y=Math.floor(100+Math.random()*900),v=`QUN-${l}-${y}`;await n.put(`/orderCheck/${e}`),await n.post("/qualityTest",{material_qual_num:v,purchase_order_id:e,material_code:o.material_code}),alert(`[${e}] 수령 및 품질검사 등록 완료!`)}else alert(`[${e}] 수령 완료! (누적 수령 중)`)}c.value=[],await q()};return V(()=>{S(),q()}),(t,e)=>{const r=g("va-input"),i=g("va-checkbox"),u=g("va-data-table"),o=g("va-button");return U(),O("div",Q,[e[4]||(e[4]=p("h2",{class:"page-title"},"자재 입고",-1)),p("div",B,[e[1]||(e[1]=p("h3",{class:"table-title"},"발주 리스트",-1)),d(u,{items:f.value,columns:C,"per-page":5,"current-page":w.value,"track-by":"purchase_order_id"},{"cell(purchase_order_date)":s(({row:a})=>[m(b(h(a.source.purchase_order_date)),1)]),"cell(receive_qty)":s(({row:a})=>[d(r,{modelValue:a.source.receive_qty,"onUpdate:modelValue":l=>a.source.receive_qty=l,type:"number",min:"1",placeholder:"수령 수"},null,8,["modelValue","onUpdate:modelValue"])]),"cell(select)":s(({row:a})=>[d(i,{"model-value":c.value.some(l=>l.purchase_order_id===a.source.purchase_order_id),"onUpdate:modelValue":l=>{if(l)c.value.push(a.source);else{const y=c.value.findIndex(v=>v.purchase_order_id===a.source.purchase_order_id);y!==-1&&c.value.splice(y,1)}},disabled:!a.source.receive_qty},null,8,["model-value","onUpdate:modelValue","disabled"])]),_:1},8,["items","current-page"]),d(o,{class:"mt-4",onClick:N,disabled:c.value.length===0},{default:s(()=>e[0]||(e[0]=[m(" 선택 항목 수령 ")])),_:1,__:[0]},8,["disabled"])]),p("div",F,[e[3]||(e[3]=p("h3",{class:"table-title"},"입고 자재",-1)),d(u,{items:$.value,columns:L,"per-page":5,"current-page":x.value,"track-by":"material_code"},{"cell(material_expiration_date)":s(({row:a})=>[m(b(h(a.source.material_expiration_date)),1)]),"cell(lot_number)":s(({row:a})=>[m(b(k(a.source.material_code)),1)]),"cell(action)":s(({row:a})=>[d(o,{size:"small",onClick:l=>D(a.source)},{default:s(()=>e[2]||(e[2]=[m("입고")])),_:2,__:[2]},1032,["onClick"])]),_:1},8,["items","current-page"])])])}}}),j=P(Y,[["__scopeId","data-v-fbf907e8"]]);export{j as default};
//# sourceMappingURL=receivingManagementPage-DfHmuKQt.js.map
