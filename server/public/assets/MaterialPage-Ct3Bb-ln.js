import{d as P,n as s,c as $,o as R,e as V,f as C,p as U,i as n,j as o,w as c,q as j,v as g,m as y,_ as q}from"./index-BJgCI8mH.js";const A={class:"material-page"},E={class:"material-container"},L={class:"material-grid"},S={class:"material-table"},z={class:"material-filters"},G={class:"material-form"},H={class:"form-header"},J={key:0,class:"image-preview"},K=["src"],O={class:"form-buttons"},Q=P({__name:"MaterialPage",setup(W){const b=s([]),_=async()=>{try{const t=await g.get("/material");b.value=t.data}catch(t){console.log("❌ 자재 목록 조회 실패:",t)}},w=[{key:"select",label:"선택"},{key:"material_code",label:"자재코드"},{key:"material_name",label:"자재명"},{key:"material_cls",label:"분류"},{key:"material_unit",label:"단위"},{key:"material_stand",label:"규격"}],i=s({material_code:"",material_name:"",material_cls:""}),k=s(1),x=$(()=>b.value.filter(t=>(!i.value.material_code||t.material_code.includes(i.value.material_code))&&(!i.value.material_name||t.material_name.includes(i.value.material_name))&&(!i.value.material_cls||t.material_cls.includes(i.value.material_cls)))),a=s({material_code:"",material_name:"",material_pay:"",material_cls:"",material_stand:"",material_unit:"",material_safty:"",material_img:""}),v=s(null),m=s(null);function d(){a.value={material_code:"",material_name:"",material_pay:"",material_cls:"",material_stand:"",material_unit:"",material_safty:"",material_img:""},v.value=null,m.value=null}async function M(){if(!a.value.material_code||!a.value.material_name){alert("필수값 누락");return}const t=new FormData;for(const e in a.value)t.append(e,a.value[e]);m.value&&t.append("image",m.value);try{(await g.post("/material",t,{headers:{"Content-Type":"multipart/form-data"}})).data.isSuccessed==!0?(alert("등록완료!"),await _(),d()):alert("등록 실패!")}catch(e){console.log("오류 발생:",e),alert("서버 오류!")}}async function D(){const t=a.value.material_code.trim();if(!t){alert("자재코드가 없습니다. 수정할 수 없습니다.");return}const e=new FormData;for(const r in a.value)e.append(r,a.value[r]);m.value&&e.append("image",m.value);try{(await g.put(`/material/${t}`,e,{headers:{"Content-Type":"multipart/form-data"}})).data.isUpdated==!0?(alert("수정 완료!"),await _(),d()):alert("수정 실패!")}catch(r){console.error("❌ 수정 중 오류 발생:",r),alert("서버 오류!")}}async function F(){const t=a.value.material_code.trim();if(!t){alert("자재코드가 없습니다. 삭제할 수 없습니다.");return}if(confirm(`정말로 ${t} 자재을 삭제하시겠습니까?`))try{(await g.delete(`/material/${t}`)).data?(alert("삭제 완료!"),await _(),d()):alert("삭제 실패! (해당 자재이 존재하지 않거나 이미 삭제됨)")}catch(e){console.error("❌ 삭제 중 오류 발생:",e),alert("서버 오류!")}}const u=s(null);function N(t,e){t?(u.value=e.material_code,a.value={...e}):u.value===e.material_code&&(u.value=null,d())}function T(t){var p;const e=(p=t.target.files)==null?void 0:p[0];if(!e)return;m.value=e,a.value.material_img=e.name;const r=new FileReader;r.onload=()=>{v.value=r.result},r.readAsDataURL(e)}return R(()=>{_()}),(t,e)=>{const r=V("va-input"),p=V("va-checkbox"),B=V("va-data-table"),f=V("va-button");return C(),U("div",A,[n("div",E,[e[16]||(e[16]=n("h2",{class:"material-title"},"자재 관리",-1)),n("div",L,[n("div",S,[n("div",z,[o(r,{modelValue:i.value.material_code,"onUpdate:modelValue":e[0]||(e[0]=l=>i.value.material_code=l),label:"자재코드",class:"filter-input"},null,8,["modelValue"]),o(r,{modelValue:i.value.material_name,"onUpdate:modelValue":e[1]||(e[1]=l=>i.value.material_name=l),label:"자재명",class:"filter-input"},null,8,["modelValue"]),o(r,{modelValue:i.value.material_cls,"onUpdate:modelValue":e[2]||(e[2]=l=>i.value.material_cls=l),label:"분류",class:"filter-spec-input"},null,8,["modelValue"])]),o(B,{"current-page":k.value,"onUpdate:currentPage":e[3]||(e[3]=l=>k.value=l),items:x.value,columns:w,"per-page":10,"track-by":"material_code"},{"cell(select)":c(({row:l})=>[o(p,{"model-value":u.value===l.source.material_code,disabled:u.value!==null&&u.value!==l.source.material_code,"onUpdate:modelValue":I=>N(I,l.source)},null,8,["model-value","disabled","onUpdate:modelValue"])]),_:1},8,["current-page","items"])]),n("div",G,[n("div",H,[e[11]||(e[11]=n("h3",{class:"form-title"},"자재 등록",-1)),n("input",{type:"file",accept:"image/*",onChange:T},null,32)]),v.value?(C(),U("div",J,[n("img",{src:v.value,alt:"첨부 이미지 미리보기"},null,8,K)])):j("",!0),o(r,{modelValue:a.value.material_code,"onUpdate:modelValue":e[4]||(e[4]=l=>a.value.material_code=l),label:"자재코드"},null,8,["modelValue"]),o(r,{modelValue:a.value.material_name,"onUpdate:modelValue":e[5]||(e[5]=l=>a.value.material_name=l),label:"자재명"},null,8,["modelValue"]),o(r,{modelValue:a.value.material_pay,"onUpdate:modelValue":e[6]||(e[6]=l=>a.value.material_pay=l),label:"단가"},null,8,["modelValue"]),o(r,{modelValue:a.value.material_cls,"onUpdate:modelValue":e[7]||(e[7]=l=>a.value.material_cls=l),label:"분류"},null,8,["modelValue"]),o(r,{modelValue:a.value.material_stand,"onUpdate:modelValue":e[8]||(e[8]=l=>a.value.material_stand=l),label:"규격"},null,8,["modelValue"]),o(r,{modelValue:a.value.material_unit,"onUpdate:modelValue":e[9]||(e[9]=l=>a.value.material_unit=l),label:"단위"},null,8,["modelValue"]),o(r,{modelValue:a.value.material_safty,"onUpdate:modelValue":e[10]||(e[10]=l=>a.value.material_safty=l),label:"안전재고"},null,8,["modelValue"]),n("div",O,[o(f,{color:"primary",onClick:M},{default:c(()=>e[12]||(e[12]=[y(" 등록 ")])),_:1,__:[12]}),o(f,{color:"secondary",onClick:d},{default:c(()=>e[13]||(e[13]=[y(" 초기화 ")])),_:1,__:[13]}),o(f,{color:"warning",onClick:D},{default:c(()=>e[14]||(e[14]=[y(" 수정 ")])),_:1,__:[14]}),o(f,{color:"danger",onClick:F},{default:c(()=>e[15]||(e[15]=[y(" 삭제 ")])),_:1,__:[15]})])])])])])}}}),Y=q(Q,[["__scopeId","data-v-69ce50cd"]]);export{Y as default};
//# sourceMappingURL=MaterialPage-Ct3Bb-ln.js.map
