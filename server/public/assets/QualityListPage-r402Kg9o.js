import{d as h,n as i,c as x,o as C,v,x as w,e as _,f as c,p as y,i as a,j as n,g as I,q as Q,F as R,y as U,t as f,w as L,m as B,_ as M}from"./index-BJgCI8mH.js";const F={class:"product-form"},S={class:"form-section"},D={class:"input-row"},T={class:"input-row"},j={class:"input-row"},E={class:"form-section"},P={class:"custom-table"},$={class:"form-buttons"},z=h({__name:"QualityListPage",setup(A){const r=i({productCode:"",workOrderNo:"",qualRemark:""}),d=i([]),p=x(()=>d.value.some(l=>l.insp_result!=="합")?"불합":"합"),b=i([]),m=i([]);C(async()=>{try{const l=await v.get("/qualitys/productList");b.value=l.data.map(e=>({label:e.product_name,value:e.product_code}))}catch(l){console.error("제품명 목록 조회 실패:",l)}});const V=async l=>{if(console.log("제품 선택:",l),r.value.workOrderNo="",m.value=[],!!l)try{const e=await v.get("/qualitys/workOrderNoList",{params:{productCode:l}});m.value=e.data.map(o=>({label:o.work_order_no,value:o.work_order_no}))}catch(e){console.error("작업지시서 목록 조회 실패:",e)}},s=i({processName:"",managerId:"",passQty:0});w(()=>r.value.workOrderNo,async l=>{if(!l){s.value={processName:"",managerId:"",passQty:0};return}try{const e=await v.get("/qualitys/workOrderDetail",{params:{workOrderNo:l}});if(e.data.length>0){const o=e.data[0];s.value={processName:o.process_name||"",managerId:o.manager_id||"",passQty:o.pass_qty||0}}else s.value={processName:"",managerId:"",passQty:0}}catch(e){console.error("작업지시서 상세 조회 실패:",e)}}),w(()=>s.value.processName,async l=>{if(!l){d.value=[];return}try{const e=await v.get("/qualitys/inspectionStandard",{params:{processName:l}});console.log("검사 기준 응답:",e.data),d.value=e.data}catch(e){console.error("검사 기준 조회 실패:",e),d.value=[]}});const g=l=>{const e=l.insp_measured_value;if(e==null||e===""){l.insp_result="판정대기";return}const o=l.insp_value_min,u=l.insp_value_max;e>=o&&e<=u?l.insp_result="합":l.insp_result="불합"},N=async()=>{if(!r.value.productCode||!r.value.workOrderNo){alert("제품명과 작업지시서 번호를 선택하세요.");return}const l=d.value.map(o=>o.insp_measured_value).filter(o=>o!=null),e=l.length>0?l.reduce((o,u)=>o+u,0)/l.length:null;if(e===null){alert("측정값을 입력해주세요.");return}if(p.value==="불합"&&!r.value.qualRemark){alert("불합 사유를 입력해주세요.");return}try{(await v.post("/qualitys/registerTest",{productCode:r.value.productCode,workOrderNo:r.value.workOrderNo,qual_measured_value:e,qual_result:p.value,process_name:s.value.processName,pass_qty:p.value==="합"?s.value.passQty:0,qual_remark:p.value==="불합"?r.value.qualRemark:null})).data.success?(alert("검사 결과 등록 완료"),r.value.qualRemark=""):alert("등록 실패")}catch(o){console.error("등록 오류:",o),alert("서버 오류로 등록 실패")}};return(l,e)=>{const o=_("va-select"),u=_("va-input"),q=_("va-button");return c(),y("div",F,[e[10]||(e[10]=a("h3",{class:"form-title"},"제품품질검사",-1)),e[11]||(e[11]=a("br",null,null,-1)),a("div",S,[e[6]||(e[6]=a("h3",{class:"form-title"},"조회",-1)),e[7]||(e[7]=a("br",null,null,-1)),a("div",D,[n(o,{modelValue:r.value.productCode,"onUpdate:modelValue":[e[0]||(e[0]=t=>r.value.productCode=t),V],options:b.value,label:"제품명",class:"quarter-width","value-by":"value","text-by":"label",placeholder:"제품을 선택하세요"},null,8,["modelValue","options"]),n(o,{modelValue:r.value.workOrderNo,"onUpdate:modelValue":e[1]||(e[1]=t=>r.value.workOrderNo=t),options:m.value,label:"작업지시서 번호",class:"quarter-width","value-by":"value","text-by":"label",placeholder:"작업지시서 번호를 선택하세요",disabled:m.value.length===0},null,8,["modelValue","options","disabled"])]),a("div",T,[n(u,{modelValue:s.value.processName,"onUpdate:modelValue":e[2]||(e[2]=t=>s.value.processName=t),label:"공정명",readonly:""},null,8,["modelValue"]),n(u,{modelValue:s.value.managerId,"onUpdate:modelValue":e[3]||(e[3]=t=>s.value.managerId=t),label:"담당자",readonly:""},null,8,["modelValue"]),n(u,{modelValue:s.value.passQty,"onUpdate:modelValue":e[4]||(e[4]=t=>s.value.passQty=t),label:"투입량",readonly:""},null,8,["modelValue"])]),a("div",j,[p.value==="불합"?(c(),I(u,{key:0,modelValue:r.value.qualRemark,"onUpdate:modelValue":e[5]||(e[5]=t=>r.value.qualRemark=t),label:"불합 판정 상세 사유",placeholder:"불합 사유를 입력하세요",class:"half-width",rules:[t=>!!t||"불합 사유는 필수입니다."]},null,8,["modelValue","rules"])):Q("",!0)])]),a("div",E,[a("table",P,[e[8]||(e[8]=a("thead",null,[a("tr",null,[a("th",null,"판정방식"),a("th",null,"단위"),a("th",null,"기준값"),a("th",null,"측정값"),a("th",null,"판정결과")])],-1)),a("tbody",null,[(c(!0),y(R,null,U(d.value,(t,O)=>(c(),y("tr",{key:O},[a("td",null,f(t.insp_value_type),1),a("td",null,f(t.insp_unit),1),a("td",null,f(t.insp_value_qty),1),a("td",null,[n(u,{modelValue:t.insp_measured_value,"onUpdate:modelValue":k=>t.insp_measured_value=k,modelModifiers:{number:!0},type:"number",placeholder:"측정값 입력",onInput:k=>g(t)},null,8,["modelValue","onUpdate:modelValue","onInput"])]),a("td",null,[n(u,{"model-value":t.insp_result||"판정대기",readonly:"",color:"primary"},null,8,["model-value"])])]))),128))])]),a("div",$,[n(q,{color:"primary",onClick:N},{default:L(()=>e[9]||(e[9]=[B(" 등록 ")])),_:1,__:[9]})])])])}}}),H=M(z,[["__scopeId","data-v-c06ce479"]]);export{H as default};
//# sourceMappingURL=QualityListPage-r402Kg9o.js.map
