import{d as P,b as Q,A as X,a as Y,n as y,c as U,o as Z,x as A,e as b,f as _,p as S,i as n,t as M,g as D,w as x,v as R,j as s,m as T,q as F,B as ee,_ as ae}from"./index-KTdWOH4t.js";const le={class:"equipment-form-page"},te={class:"va-h3 mb-6"},oe={class:"flex flex-col items-center gap-2"},se={class:"w-40 h-40 border rounded flex items-center justify-center bg-gray-100 overflow-hidden"},ue=["src"],ne={key:1,class:"text-gray-500"},re={class:"grid grid-cols-3 gap-4 va-label-lg"},ie={class:"grid grid-cols-3 gap-4 va-label-lg"},de={class:"grid grid-cols-2 gap-4 va-label-lg"},me={class:"grid grid-cols-2 gap-4 va-label-lg"},pe={class:"grid grid-cols-2 gap-4 va-label-lg"},ve={class:"relative"},ce={class:"grid grid-cols-2 gap-4 va-label-lg"},ge={class:"relative"},fe={class:"relative"},ye={class:"flex justify-center gap-4 mt-6"},be=P({__name:"EquipmentForm",setup(_e){const O=Q(),g=X(),I=Y(),N=y(),E=y(),c=y(""),V=y(""),$={a1:["t1"],a2:["t2"],a3:["t3"],a4:["t4"],a5:["t5"],a6:["t7"],a7:["t7"],a8:["t7"],a9:["t8"],a10:["t8"],a11:["t8"],a12:["t8"],a13:["t6"],a14:["t6"],a15:["t6"],a16:["t6"],a17:["t6"],a18:["t6"],a19:["t6"]},i=U(()=>g.params.id||g.query.mode==="edit"&&g.query.eq_id?"edit":"register"),w=U(()=>g.params.id||g.query.eq_id),h=U(()=>i.value==="edit"?"설비 수정":"설비 등록"),B=U(()=>{if(!a.value.baseName)return[];const l=$[a.value.baseName]||[];return m.value.eq_type.filter(e=>l.includes(e.value))}),r=l=>!!l||"필수 입력 항목입니다",k=()=>({image:[],id:"",baseName:"",name:"",category:"",line:"",type:"",factory:"",floor:"",room:"",installType:"",manufactureDate:null,registerDate:new Date().toISOString().slice(0,10),maker:"",model:"",serial:"",power:"",maxRuntime:"",maintenanceCycle:"",note:""}),a=y(k()),j=y(0),m=y({factory:[],floor:[],room:[],eq_group:[],eq_type:[],eq_import:[],eq_base_name:[],line:[]}),z=l=>{if(a.value.type="",l){["a1","a2","a3","a4","a5"].includes(l)?a.value.category="e1":["a6","a7","a8","a9","a10","a11","a12"].includes(l)?a.value.category="e2":["a13","a14","a15","a16","a17","a18","a19"].includes(l)&&(a.value.category="e3");const e=$[l]||[];e.length===1&&(a.value.type=e[0])}},K=l=>{const e=Array.isArray(l)?l[0]:l;e instanceof File&&(a.value.image=[e],c.value=URL.createObjectURL(e))},W=async()=>{try{const{data:l}=await R.get("/common-codes?groups=0F,0L,0M,0E,0T,0I,0A,line");console.log("Loaded common codes:",l),m.value={factory:l["0F"]||[],floor:l["0L"]||[],room:l["0M"]||[],eq_group:l["0E"]||[],eq_type:l["0T"]||[],eq_import:l["0I"]||[],eq_base_name:l["0A"]||[],line:l.line||[]}}catch(l){console.error("공통코드 로드 실패:",l),alert("공통코드를 불러오는데 실패했습니다.")}},C=async l=>{var e,d,v;try{const u=await R.get(`/equipments/${l}`);if(u.data.isSuccessed&&u.data.data){const o=u.data.data,q=((e=o.eq_name)==null?void 0:e.replace(/\d+$/,""))||"",p=m.value.eq_base_name.find(f=>f.label===q);a.value={image:[],id:o.eq_id||"",baseName:(p==null?void 0:p.value)||"",name:o.eq_name||"",category:o.eq_group_code||"",line:o.line_id||"",type:o.eq_type_code||"",factory:o.eq_factory_code||"",floor:o.eq_floor_code||"",room:o.eq_room_code||"",installType:o.eq_import_code||"",manufactureDate:o.eq_manufacture_date||null,registerDate:o.eq_registration_date||new Date().toISOString().slice(0,10),maker:o.eq_manufacturer||"",model:o.eq_model||"",serial:o.eq_serial_number||"",power:o.eq_power_spec||"",maxRuntime:((d=o.eq_max_operation_time)==null?void 0:d.toString())||"",maintenanceCycle:((v=o.eq_inspection_cycle)==null?void 0:v.toString())||"",note:o.eq_remark||""},o.eq_image&&(V.value=o.eq_image,c.value=`/uploads/equipment/${o.eq_image}`)}}catch(u){console.error("설비 데이터 로드 실패:",u),alert("설비 데이터를 불러오는데 실패했습니다.")}},L=async()=>{var l,e;c.value&&!V.value&&URL.revokeObjectURL(c.value),c.value="",V.value="",a.value=k(),j.value+=1,await ee(),(e=(l=E.value)==null?void 0:l.reset)==null||e.call(l),i.value==="edit"&&w.value&&await C(w.value)};Z(async()=>{var e;if(!(((e=O.user)==null?void 0:e.department_code)==="04")){alert("설비팀만 접근할 수 있습니다."),I.replace({name:"dashboard"});return}await W(),i.value==="edit"&&w.value&&await C(w.value)}),A([()=>g.params.id,()=>g.query],async([l,e])=>{const d=l||e.eq_id;i.value==="edit"&&d?await C(d):d||(a.value=k(),c.value="",V.value="")},{deep:!0}),A(()=>a.value.category,l=>{l!=="e3"&&(a.value.line="")});const G=async()=>{var l;if(confirm(`${i.value==="edit"?"수정":"등록"}하시겠습니까?`)&&(l=N.value)!=null&&l.validate())try{const e=i.value==="edit"?`/equipments/${a.value.id}`:"/equipments",d=i.value==="edit"?"put":"post",v=new FormData,u=m.value.eq_base_name.find(p=>p.value===a.value.baseName),o={...a.value,name:(u==null?void 0:u.label)||a.value.baseName};Object.entries(o).forEach(([p,f])=>{p!=="image"&&p!=="baseName"&&f!==null&&f!==""&&v.append(p,String(f))}),a.value.image.length>0&&a.value.image[0]instanceof File?v.append("image",a.value.image[0]):i.value==="edit"&&V.value&&v.append("existingImage",V.value);const q=await R[d](e,v,{headers:{"Content-Type":"multipart/form-data"}});q.data.isSuccessed?(alert(`설비 ${i.value==="edit"?"수정":"등록"}에 성공했습니다!`),i.value==="register"?await L():I.push("/faq/equipment-management")):alert(`실패: ${q.data.message}`)}catch(e){console.error(`설비 ${i.value==="edit"?"수정":"등록"} 실패:`,e),alert(`설비 ${i.value==="edit"?"수정":"등록"}에 실패했습니다.`)}},H=async()=>{confirm("정말 초기화하시겠습니까?")&&await L()};return(l,e)=>{const d=b("VaButton"),v=b("VaFileUpload"),u=b("VaInput"),o=b("VaSelect"),q=b("VaDateInput"),p=b("VaTextarea"),f=b("VaForm");return _(),S("div",le,[n("h1",te,M(h.value),1),(_(),D(f,{ref_key:"formRef",ref:N,key:j.value,class:"max-w-5xl mx-auto p-6 flex flex-col gap-6 bg-white shadow rounded"},{default:x(({isValid:J})=>[n("div",oe,[n("div",se,[c.value?(_(),S("img",{key:0,src:c.value,class:"object-contain max-w-full max-h-full"},null,8,ue)):(_(),S("span",ne,"이미지 미리보기"))]),s(v,{ref_key:"fileUploadRef",ref:E,type:"single","hide-file-list":"","onUpdate:modelValue":K},{default:x(()=>[s(d,{size:"small"},{default:x(()=>e[18]||(e[18]=[T("파일 선택")])),_:1,__:[18]})]),_:1},512)]),s(u,{modelValue:a.value.id,"onUpdate:modelValue":e[0]||(e[0]=t=>a.value.id=t),label:"설비 번호",readonly:"",placeholder:"등록 시 자동 생성됩니다",inputClass:"bg-gray-100",class:"va-label-lg"},null,8,["modelValue"]),s(o,{modelValue:a.value.baseName,"onUpdate:modelValue":[e[1]||(e[1]=t=>a.value.baseName=t),z],label:"설비명",options:m.value.eq_base_name,rules:[r],"value-by":"value","text-by":"label",class:"va-label-lg"},null,8,["modelValue","options","rules"]),n("div",re,[s(o,{modelValue:a.value.category,"onUpdate:modelValue":e[2]||(e[2]=t=>a.value.category=t),label:"설비 분류",options:m.value.eq_group,rules:[r],"value-by":"value","text-by":"label",disabled:!a.value.baseName,placeholder:"설비명을 먼저 선택해주세요"},null,8,["modelValue","options","rules","disabled"]),s(o,{modelValue:a.value.type,"onUpdate:modelValue":e[3]||(e[3]=t=>a.value.type=t),label:"설비 세부 유형",options:B.value,rules:[r],"value-by":"value","text-by":"label",disabled:!a.value.baseName,placeholder:"설비명을 먼저 선택해주세요"},null,8,["modelValue","options","rules","disabled"]),s(o,{modelValue:a.value.installType,"onUpdate:modelValue":e[4]||(e[4]=t=>a.value.installType=t),label:"도입 유형",options:m.value.eq_import,rules:[r],"value-by":"value","text-by":"label"},null,8,["modelValue","options","rules"])]),a.value.category==="e3"?(_(),D(o,{key:0,modelValue:a.value.line,"onUpdate:modelValue":e[5]||(e[5]=t=>a.value.line=t),label:"생산 라인",options:m.value.line,rules:[r],"value-by":"value","text-by":"label",class:"va-label-lg"},null,8,["modelValue","options","rules"])):F("",!0),n("div",ie,[s(o,{modelValue:a.value.factory,"onUpdate:modelValue":e[6]||(e[6]=t=>a.value.factory=t),label:"공장",options:m.value.factory,rules:[r],"value-by":"value","text-by":"label"},null,8,["modelValue","options","rules"]),a.value.factory?(_(),D(o,{key:0,modelValue:a.value.floor,"onUpdate:modelValue":e[7]||(e[7]=t=>a.value.floor=t),label:"층",options:m.value.floor,rules:[r],"value-by":"value","text-by":"label"},null,8,["modelValue","options","rules"])):F("",!0),a.value.floor?(_(),D(o,{key:1,modelValue:a.value.room,"onUpdate:modelValue":e[8]||(e[8]=t=>a.value.room=t),label:"공정실",options:m.value.room,rules:[r],"value-by":"value","text-by":"label"},null,8,["modelValue","options","rules"])):F("",!0)]),n("div",de,[s(q,{modelValue:a.value.manufactureDate,"onUpdate:modelValue":e[9]||(e[9]=t=>a.value.manufactureDate=t),label:"설비 제조일",rules:[r],clearable:""},null,8,["modelValue","rules"]),s(u,{modelValue:a.value.registerDate,"onUpdate:modelValue":e[10]||(e[10]=t=>a.value.registerDate=t),label:"설비 등록일",readonly:"",inputClass:"bg-gray-100"},null,8,["modelValue"])]),n("div",me,[s(u,{modelValue:a.value.maker,"onUpdate:modelValue":e[11]||(e[11]=t=>a.value.maker=t),label:"제조사",rules:[r]},null,8,["modelValue","rules"]),s(u,{modelValue:a.value.model,"onUpdate:modelValue":e[12]||(e[12]=t=>a.value.model=t),label:"모델명",rules:[r]},null,8,["modelValue","rules"])]),n("div",pe,[s(u,{modelValue:a.value.serial,"onUpdate:modelValue":e[13]||(e[13]=t=>a.value.serial=t),label:"제조번호 (Serial No.)",rules:[r]},null,8,["modelValue","rules"]),n("div",ve,[s(u,{modelValue:a.value.power,"onUpdate:modelValue":e[14]||(e[14]=t=>a.value.power=t),label:"정격 전력",rules:[r],inputClass:"pr-12",class:"w-full"},null,8,["modelValue","rules"]),e[19]||(e[19]=n("span",{class:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 text-sm pointer-events-none"},"kW",-1))])]),n("div",ce,[n("div",ge,[s(u,{modelValue:a.value.maxRuntime,"onUpdate:modelValue":e[15]||(e[15]=t=>a.value.maxRuntime=t),label:"최대 가동 시간",rules:[r],inputClass:"pr-12",class:"w-full"},null,8,["modelValue","rules"]),e[20]||(e[20]=n("span",{class:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 text-sm pointer-events-none"},"시간",-1))]),n("div",fe,[s(u,{modelValue:a.value.maintenanceCycle,"onUpdate:modelValue":e[16]||(e[16]=t=>a.value.maintenanceCycle=t),label:"정기 점검 주기",rules:[r],inputClass:"pr-12",class:"w-full"},null,8,["modelValue","rules"]),e[21]||(e[21]=n("span",{class:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 text-sm pointer-events-none"},"일",-1))])]),s(p,{modelValue:a.value.note,"onUpdate:modelValue":e[17]||(e[17]=t=>a.value.note=t),label:"비고",placeholder:"특이사항이 있다면 입력해 주세요",class:"va-label-lg"},null,8,["modelValue"]),n("div",ye,[s(d,{disabled:!J,color:i.value==="edit"?"warning":"primary",onClick:G},{default:x(()=>[T(M(i.value==="edit"?"수정":"등록"),1)]),_:2},1032,["disabled","color"]),s(d,{color:"secondary",onClick:H},{default:x(()=>e[22]||(e[22]=[T("초기화")])),_:1,__:[22]})])]),_:1}))])}}}),qe=ae(be,[["__scopeId","data-v-2c8486bf"]]);export{qe as default};
//# sourceMappingURL=EquipmentForm-DjnwGYzh.js.map
