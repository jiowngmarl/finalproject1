import{d as _e,b as be,n,c as A,o as Ve,v as S,x as L,e as v,f as m,p as _,i as l,j as t,w as u,k as V,q as M,F as ye,y as Ne,z as he,h as we,g as j,t as p,m as r,_ as ke}from"./index-KTdWOH4t.js";const xe={class:"account-page-container"},$e={class:"account-list-panel"},Ue={class:"search-filter-area"},Ce={class:"search-bar"},Te={class:"filter-row"},Ae={class:"filter-item"},Se={class:"filter-item"},Ye={key:0,class:"action-buttons"},Ie={key:1,class:"permission-notice"},De={class:"table-container"},Pe={class:"account-table"},Me={key:0,width:"40"},Be=["onClick"],Fe={class:"address-cell"},Oe={key:0,class:"no-data"},qe={class:"pagination-area"},ze={class:"page-info"},Ee={class:"page-controls"},Le={key:0,class:"account-detail-panel"},je={class:"detail-header"},Re={class:"action-buttons"},Ge={class:"detail-form"},He={class:"form-row"},Je={class:"form-group"},Ke={class:"form-row"},Qe={class:"form-group"},We={class:"form-row"},Xe={class:"form-group"},Ze={class:"form-row"},el={class:"form-group"},ll={class:"form-row"},sl={class:"form-group"},al={class:"address-input-group"},ol={class:"form-row"},tl={class:"form-group"},nl={class:"form-row"},ul={class:"form-group"},rl={class:"radio-group"},dl={class:"form-row"},il={class:"form-group"},ml={class:"radio-group"},vl={class:"form-row"},pl={class:"form-group"},cl={class:"form-row"},fl={class:"form-group full-width"},gl={key:1,class:"permission-info-panel"},_l={class:"permission-content"},bl={class:"current-permission"},Vl=_e({__name:"AccountManagePage",setup(yl){const R=be(),{canManageSales:c,userRole:G}=R,x=n(""),i=n([]),B=n(!1),y=n(1),N=n(10),h=n([]),w=n(null),F=n(!1),b=n({accountName:"",businessNo:"",manager:"",phone:"",accountType:""}),o=n({accountName:"",businessNo:"",chargerName:"",phone:"",address:"",addressDetail:"",accountType:"customer",useYn:"Y",email:"",remarks:""}),d=n({accountName:!1,businessNo:!1,chargerName:!1,phone:!1}),O=n([]),H=n([]),J=n([]),K=n([]),Q=n([{text:"고객사",value:"customer"},{text:"공급사",value:"supplier"}]),$=A(()=>h.value.filter(s=>{const e=!x.value||s.account_name.toLowerCase().includes(x.value.toLowerCase())||s.business_no.includes(x.value),U=(!b.value.accountName||s.account_name===b.value.accountName)&&(!b.value.accountType||s.account_type===b.value.accountType);return e&&U})),W=A(()=>Math.ceil($.value.length/N.value)),Y=A(()=>(y.value-1)*N.value),q=A(()=>{const s=Y.value,e=s+N.value;return $.value.slice(s,e)});Ve(async()=>{await I(),X()});async function I(){try{F.value=!0;const s=await S.get("/account");h.value=s.data}catch(s){console.error("거래처 목록 로드 실패:",s),h.value=[]}finally{F.value=!1}}function X(){O.value=[...new Set(h.value.map(s=>s.account_name))],H.value=[...new Set(h.value.map(s=>s.business_no))],J.value=[...new Set(h.value.map(s=>s.charger_name))],K.value=[...new Set(h.value.map(s=>s.phone))]}function Z(){y.value=1}function ee(s){s?i.value=q.value.map(e=>e.account_id):i.value=[]}function le(s){if(!c){console.log("거래처 수정 권한이 없습니다.");return}w.value=s,o.value={accountName:s.account_name,businessNo:s.business_no,chargerName:s.charger_name,phone:s.phone,address:s.address,addressDetail:s.address_detail||"",accountType:s.account_type,useYn:s.use_yn,email:s.email||"",remarks:s.remarks||""},D()}function z(){w.value=null,o.value={accountName:"",businessNo:"",chargerName:"",phone:"",address:"",addressDetail:"",accountType:"customer",useYn:"Y",email:"",remarks:""},D()}function D(){d.value={accountName:!1,businessNo:!1,chargerName:!1,phone:!1}}function se(){D();let s=!0;return o.value.accountName.trim()||(d.value.accountName=!0,s=!1),(!o.value.businessNo||!ae(o.value.businessNo))&&(d.value.businessNo=!0,s=!1),o.value.chargerName.trim()||(d.value.chargerName=!0,s=!1),(!o.value.phone||!oe(o.value.phone))&&(d.value.phone=!0,s=!1),s}function ae(s){return/^\d{3}-\d{2}-\d{5}$/.test(s)}function oe(s){return/^\d{3}-\d{4}-\d{4}$|^\d{2}-\d{3}-\d{4}$|^\d{3}-\d{3}-\d{4}$|^\d{4}-\d{4}$/.test(s)}async function te(){if(!c){alert("거래처 관리 권한이 없습니다.");return}if(se())try{const s={account_name:o.value.accountName,business_no:o.value.businessNo,charger_name:o.value.chargerName,phone:o.value.phone,address:o.value.address,address_detail:o.value.addressDetail,account_type:o.value.accountType,use_yn:o.value.useYn,email:o.value.email,remarks:o.value.remarks};w.value?(await S.put(`/account/${w.value.account_id}`,s),alert("거래처가 수정되었습니다.")):(await S.post("/account",s),alert("거래처가 등록되었습니다.")),await I(),z()}catch(s){console.error("거래처 저장 실패:",s),alert("거래처 저장에 실패했습니다.")}}async function ne(){if(!c){alert("거래처 관리 권한이 없습니다.");return}if(console.log("삭제할 selectedIds:",i.value),i.value.length!==0&&confirm(`선택한 ${i.value.length}개의 거래처를 삭제하시겠습니까?`))try{const s=await S.post("/account/delete-multiple",{ids:i.value}),{success:e,deletedCount:U,failedCount:f,failedIds:g,message:k}=s.data;!e&&f>0?alert(`${k}

삭제 실패한 거래처 ID: ${g&&g.length?g.join(", "):"없음"}`):alert(k),await I(),i.value=[]}catch(s){console.error("거래처 삭제 실패:",s),alert("거래처 삭제에 실패했습니다.")}}function ue(){console.log("엑셀 내보내기"),alert("엑셀 내보내기 기능은 준비 중입니다.")}function re(){console.log("주소 검색"),alert("주소 검색 기능은 준비 중입니다.")}function de(s){const e=s.replace(/[^0-9]/g,"");e.length>=10?o.value.businessNo=`${e.slice(0,3)}-${e.slice(3,5)}-${e.slice(5)}`:e.length==3?o.value.businessNo=`${e.slice(0,3)}-`:e.length==5&&(o.value.businessNo=`${e.slice(0,3)}-${e.slice(3,5)}-`)}function ie(s){const e=s.replace(/[^0-9]/g,"");e.length==11?o.value.phone=`${e.slice(0,3)}-${e.slice(3,7)}-${e.slice(7)}`:e.length==9?o.value.phone=`${e.slice(0,2)}-${e.slice(2,5)}-${e.slice(5)}`:e.length==10&&(o.value.phone=`${e.slice(0,3)}-${e.slice(3,6)}-${e.slice(6)}`)}return L(b,()=>{y.value=1},{deep:!0}),L(N,()=>{y.value=1}),(s,e)=>{const U=v("va-icon"),f=v("va-input"),g=v("va-button"),k=v("va-select"),me=v("va-alert"),P=v("va-checkbox"),ve=v("va-tooltip"),pe=v("va-pagination"),C=v("va-radio"),ce=v("va-textarea"),fe=v("va-chip");return m(),_("div",xe,[l("div",$e,[e[36]||(e[36]=l("h1",{class:"page-title"},"거래처 관리",-1)),l("div",Ue,[l("div",Ce,[t(f,{modelValue:x.value,"onUpdate:modelValue":e[0]||(e[0]=a=>x.value=a),placeholder:"거래처명, 사업자 번호로 검색...",class:"search-input"},{prepend:u(()=>[t(U,{name:"search"})]),_:1},8,["modelValue"]),t(g,{onClick:Z},{default:u(()=>e[23]||(e[23]=[r("조회")])),_:1,__:[23]})]),l("div",Te,[l("div",Ae,[e[24]||(e[24]=l("label",null,"거래처명",-1)),t(k,{modelValue:b.value.accountName,"onUpdate:modelValue":e[1]||(e[1]=a=>b.value.accountName=a),options:O.value,placeholder:"전체",clearable:""},null,8,["modelValue","options"])]),l("div",Se,[e[25]||(e[25]=l("label",null,"거래처 구분",-1)),t(k,{modelValue:b.value.accountType,"onUpdate:modelValue":e[2]||(e[2]=a=>b.value.accountType=a),options:Q.value,"value-by":"value","text-by":"text",placeholder:"전체",clearable:""},null,8,["modelValue","options"])])])]),V(c)?(m(),_("div",Ye,[t(g,{preset:"secondary",icon:"delete_outline",onClick:ne,disabled:i.value.length===0},{default:u(()=>e[26]||(e[26]=[r(" 삭제 ")])),_:1,__:[26]},8,["disabled"]),t(g,{preset:"secondary",icon:"download",onClick:ue},{default:u(()=>e[27]||(e[27]=[r(" 엑셀 ")])),_:1,__:[27]})])):(m(),_("div",Ie,[t(me,{color:"info",icon:"info"},{default:u(()=>e[28]||(e[28]=[r(" 조회 전용 모드입니다. 거래처 관리는 영업부서 권한이 필요합니다. ")])),_:1,__:[28]})])),l("div",De,[l("table",Pe,[l("thead",null,[l("tr",null,[V(c)?(m(),_("th",Me,[t(P,{modelValue:B.value,"onUpdate:modelValue":[e[3]||(e[3]=a=>B.value=a),ee]},null,8,["modelValue"])])):M("",!0),e[29]||(e[29]=l("th",{width:"60"},"번호",-1)),e[30]||(e[30]=l("th",null,"거래처명",-1)),e[31]||(e[31]=l("th",null,"사업자 번호",-1)),e[32]||(e[32]=l("th",null,"담당자",-1)),e[33]||(e[33]=l("th",null,"연락처",-1)),e[34]||(e[34]=l("th",null,"주소",-1))])]),l("tbody",null,[(m(!0),_(ye,null,Ne(q.value,(a,ge)=>{var E;return m(),_("tr",{key:a.account_id,onClick:T=>V(c)?le(a):null,class:he({selected:((E=w.value)==null?void 0:E.account_id)===a.account_id&&V(c),"read-only":!V(c)})},[V(c)?(m(),_("td",{key:0,onClick:e[6]||(e[6]=we(()=>{},["stop"]))},[a.in_use?(m(),j(ve,{key:0,text:"주문 또는 발주에서 사용된 거래처는 삭제할 수 없습니다",placement:"top"},{activator:u(()=>[l("span",null,[t(P,{modelValue:i.value,"onUpdate:modelValue":e[4]||(e[4]=T=>i.value=T),"array-value":a.account_id,disabled:!!a.in_use},null,8,["modelValue","array-value","disabled"])])]),_:2},1024)):(m(),j(P,{key:1,modelValue:i.value,"onUpdate:modelValue":e[5]||(e[5]=T=>i.value=T),"array-value":a.account_id},null,8,["modelValue","array-value"]))])):M("",!0),l("td",null,p(Y.value+ge+1),1),l("td",null,p(a.account_name),1),l("td",null,p(a.business_no),1),l("td",null,p(a.charger_name),1),l("td",null,p(a.phone),1),l("td",Fe,p(a.address),1)],10,Be)}),128))])]),$.value.length===0?(m(),_("div",Oe," 검색 결과가 없습니다. ")):M("",!0)]),l("div",qe,[l("div",ze,p(Y.value+1)+"-"+p(Math.min(y.value*N.value,$.value.length))+" of "+p($.value.length),1),l("div",Ee,[e[35]||(e[35]=l("span",null,"Rows per page: ",-1)),t(k,{modelValue:N.value,"onUpdate:modelValue":e[7]||(e[7]=a=>N.value=a),options:[10,20,50],class:"rows-select"},null,8,["modelValue"]),t(pe,{modelValue:y.value,"onUpdate:modelValue":e[8]||(e[8]=a=>y.value=a),pages:W.value,"visible-pages":5,"buttons-preset":"secondary",rounded:"",gapped:"","border-color":"primary",class:"ml-3"},null,8,["modelValue","pages"])])])]),V(c)?(m(),_("div",Le,[l("div",je,[e[38]||(e[38]=l("h2",null,"거래처 등록/수정",-1)),l("div",Re,[t(g,{preset:"secondary",onClick:z},{default:u(()=>e[37]||(e[37]=[r("초기화")])),_:1,__:[37]}),t(g,{onClick:te},{default:u(()=>[r(p(w.value?"수정":"저장"),1)]),_:1})])]),l("div",Ge,[l("div",He,[l("div",Je,[e[39]||(e[39]=l("label",null,[r("거래처명 "),l("span",{class:"required"},"*")],-1)),t(f,{modelValue:o.value.accountName,"onUpdate:modelValue":e[9]||(e[9]=a=>o.value.accountName=a),placeholder:"거래처명을 입력하세요",error:d.value.accountName,"error-messages":d.value.accountName?"거래처명은 필수입니다":""},null,8,["modelValue","error","error-messages"])])]),l("div",Ke,[l("div",Qe,[e[40]||(e[40]=l("label",null,[r("사업자 번호 "),l("span",{class:"required"},"*")],-1)),t(f,{modelValue:o.value.businessNo,"onUpdate:modelValue":e[10]||(e[10]=a=>o.value.businessNo=a),placeholder:"10자리 숫자만 입력하세요",inputmode:"numeric",pattern:"[0-9]*",onInput:e[11]||(e[11]=a=>de(a.target.value)),error:d.value.businessNo,"error-messages":d.value.businessNo?"올바른 사업자번호를 입력하세요":"",maxlength:"10"},null,8,["modelValue","error","error-messages"])])]),l("div",We,[l("div",Xe,[e[41]||(e[41]=l("label",null,[r("담당자 "),l("span",{class:"required"},"*")],-1)),t(f,{modelValue:o.value.chargerName,"onUpdate:modelValue":e[12]||(e[12]=a=>o.value.chargerName=a),placeholder:"담당자명",error:d.value.chargerName,"error-messages":d.value.chargerName?"담당자명은 필수입니다":""},null,8,["modelValue","error","error-messages"])])]),l("div",Ze,[l("div",el,[e[42]||(e[42]=l("label",null,[r("연락처 "),l("span",{class:"required"},"*")],-1)),t(f,{modelValue:o.value.phone,"onUpdate:modelValue":e[13]||(e[13]=a=>o.value.phone=a),placeholder:"숫자만 입력하세요",inputmode:"numeric",pattern:"[0-9]*",onInput:e[14]||(e[14]=a=>ie(a.target.value)),error:d.value.phone,"error-messages":d.value.phone?"올바른 연락처를 입력하세요":"",maxlength:"15"},null,8,["modelValue","error","error-messages"])])]),l("div",ll,[l("div",sl,[e[44]||(e[44]=l("label",null,"주소",-1)),l("div",al,[t(f,{modelValue:o.value.address,"onUpdate:modelValue":e[15]||(e[15]=a=>o.value.address=a),placeholder:"주소를 입력하세요"},null,8,["modelValue"]),t(g,{preset:"secondary",onClick:re},{default:u(()=>e[43]||(e[43]=[r(" 주소 검색 ")])),_:1,__:[43]})])])]),l("div",ol,[l("div",tl,[e[45]||(e[45]=l("label",null,"상세주소",-1)),t(f,{modelValue:o.value.addressDetail,"onUpdate:modelValue":e[16]||(e[16]=a=>o.value.addressDetail=a),placeholder:"상세주소를 입력하세요"},null,8,["modelValue"])])]),l("div",nl,[l("div",ul,[e[48]||(e[48]=l("label",null,"구분",-1)),l("div",rl,[t(C,{modelValue:o.value.accountType,"onUpdate:modelValue":e[17]||(e[17]=a=>o.value.accountType=a),option:"customer"},{label:u(()=>e[46]||(e[46]=[l("span",{class:"radio-label"},"고객사",-1)])),_:1},8,["modelValue"]),t(C,{modelValue:o.value.accountType,"onUpdate:modelValue":e[18]||(e[18]=a=>o.value.accountType=a),option:"supplier"},{label:u(()=>e[47]||(e[47]=[l("span",{class:"radio-label"},"공급사",-1)])),_:1},8,["modelValue"])])])]),l("div",dl,[l("div",il,[e[51]||(e[51]=l("label",null,"사용여부",-1)),l("div",ml,[t(C,{modelValue:o.value.useYn,"onUpdate:modelValue":e[19]||(e[19]=a=>o.value.useYn=a),option:"Y"},{label:u(()=>e[49]||(e[49]=[l("span",{class:"radio-label"},"여",-1)])),_:1},8,["modelValue"]),t(C,{modelValue:o.value.useYn,"onUpdate:modelValue":e[20]||(e[20]=a=>o.value.useYn=a),option:"N"},{label:u(()=>e[50]||(e[50]=[l("span",{class:"radio-label"},"부",-1)])),_:1},8,["modelValue"])])])]),l("div",vl,[l("div",pl,[e[52]||(e[52]=l("label",null,"이메일",-1)),t(f,{modelValue:o.value.email,"onUpdate:modelValue":e[21]||(e[21]=a=>o.value.email=a),placeholder:"example@company.com",type:"email"},null,8,["modelValue"])])]),l("div",cl,[l("div",fl,[e[53]||(e[53]=l("label",null,"비고",-1)),t(ce,{modelValue:o.value.remarks,"onUpdate:modelValue":e[22]||(e[22]=a=>o.value.remarks=a),placeholder:"비고사항을 입력하세요","min-rows":3,"max-rows":5},null,8,["modelValue"])])])])])):(m(),_("div",gl,[l("div",_l,[t(U,{name:"lock",size:"large",color:"primary"}),e[54]||(e[54]=l("h3",null,"거래처 관리 권한 필요",-1)),e[55]||(e[55]=l("p",null,"거래처 등록 및 수정은 영업부서 권한이 필요합니다.",-1)),l("div",bl,[t(fe,{color:"info",size:"small"},{default:u(()=>[r(" 현재 권한: "+p(V(G)||"조회 전용"),1)]),_:1})]),e[56]||(e[56]=l("p",{class:"permission-desc"},[r(" 거래처 목록은 조회할 수 있지만,"),l("br"),r(" 등록, 수정, 삭제는 영업부서만 가능합니다. ")],-1))])]))])}}}),hl=ke(Vl,[["__scopeId","data-v-ba2facba"]]);export{hl as default};
//# sourceMappingURL=AccountManagePage-gmx1rbkt.js.map
