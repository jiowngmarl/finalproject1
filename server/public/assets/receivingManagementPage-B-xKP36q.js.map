{"version":3,"file":"receivingManagementPage-B-xKP36q.js","sources":["../../../client/src/pages/material/receivingManagementPage.vue"],"sourcesContent":["<template>\n  <div class=\"receipt-page\">\n    <h2 class=\"page-title\">자재 입고</h2>\n\n    <!-- 발주 리스트 -->\n    <div class=\"table-section\">\n      <h3 class=\"table-title\">발주 리스트</h3>\n      <va-data-table\n        v-model:current-page=\"orderPage\"\n        :items=\"orderCheckList\"\n        :columns=\"orderColumns\"\n        :per-page=\"5\"\n        track-by=\"purchase_order_id\"\n      >\n        <template #cell(purchase_order_date)=\"{ row }\">\n          {{ formatToKST(row.source.purchase_order_date) }}\n        </template>\n\n        <template #cell(receive_qty)=\"{ row }\">\n          <va-input\n            v-model=\"row.source.receive_qty\"\n            type=\"number\"\n            min=\"1\"\n            placeholder=\"수령 수\"\n          />\n        </template>\n\n        <template #cell(select)=\"{ row }\">\n          <va-checkbox\n            :model-value=\"\n              selectedRows.some(\n                (r) => r.purchase_order_id === row.source.purchase_order_id,\n              )\n            \"\n            :disabled=\"!row.source.receive_qty\"\n            @update:model-value=\"\n              (checked) => {\n                if (checked) {\n                  selectedRows.push(row.source);\n                } else {\n                  const index = selectedRows.findIndex(\n                    (r) => r.purchase_order_id === row.source.purchase_order_id,\n                  );\n                  if (index !== -1) selectedRows.splice(index, 1);\n                }\n              }\n            \"\n          />\n        </template>\n      </va-data-table>\n      <va-button\n        class=\"mt-4\"\n        :disabled=\"selectedRows.length === 0\"\n        @click=\"handleReceive\"\n      >\n        선택 항목 수령\n      </va-button>\n    </div>\n\n    <!-- 자재 입고 등록 -->\n    <div class=\"table-section\">\n      <h3 class=\"table-title\">입고 자재</h3>\n      <va-data-table\n        v-model:current-page=\"receiptPage\"\n        :items=\"materialOrderList\"\n        :columns=\"receiptColumns\"\n        :per-page=\"5\"\n        track-by=\"material_code\"\n      >\n        <template #cell(material_expiration_date)=\"{ row }\">\n          {{ formatToKST(row.source.material_expiration_date) }}\n        </template>\n\n        <template #cell(lot_number)=\"{ row }\">\n          {{ generateLotNumber(row.source.material_code) }}\n        </template>\n\n        <template #cell(action)=\"{ row }\">\n          <va-button size=\"small\" @click=\"saveMaterialLot(row.source)\">\n            입고\n          </va-button>\n        </template>\n      </va-data-table>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport axios from \"axios\";\nimport { ref, onMounted } from \"vue\";\n\ninterface MaterialReceipt {\n  purchase_order_id: string;\n  material_code: string;\n  material_name: string;\n  purchase_order_quantity: number;\n  received_quantity: number;\n  material_unit: string;\n  mat_qual_test_status: string;\n  lot_number: string;\n  material_expiration_date: string;\n  purchase_order_date: string;\n  account_id: string;\n  account_name: string;\n  receive_qty?: number;\n}\n\nconst formatToKST = (isoDate: string): string => {\n  const date = new Date(isoDate);\n  const kst = new Date(date.getTime() + 9 * 60 * 60 * 1000);\n  return `${kst.getFullYear()}-${String(kst.getMonth() + 1).padStart(\n    2,\n    \"0\",\n  )}-${String(kst.getDate()).padStart(2, \"0\")} ${String(\n    kst.getHours(),\n  ).padStart(2, \"0\")}:${String(kst.getMinutes()).padStart(2, \"0\")}`;\n};\n\nconst toDateOnly = (iso: string): string => iso.split(\"T\")[0];\n\nconst generateLotNumber = (materialCode: string): string => {\n  const now = new Date();\n  const yyyyMMdd = `${now.getFullYear()}${String(now.getMonth() + 1).padStart(\n    2,\n    \"0\",\n  )}${String(now.getDate()).padStart(2, \"0\")}`;\n  const random = Math.floor(100 + Math.random() * 900);\n  return `LOT${materialCode}-${yyyyMMdd} - ${random}`;\n};\n\nconst materialOrderList = ref<MaterialReceipt[]>([]);\nconst orderCheckList = ref<MaterialReceipt[]>([]);\nconst orderPage = ref(1);\nconst receiptPage = ref(1);\nconst selectedRows = ref<MaterialReceipt[]>([]);\n\nconst orderColumns = [\n  { key: \"select\", label: \"선택\" },\n  { key: \"purchase_order_id\", label: \"발주코드\" },\n  { key: \"material_code\", label: \"자재코드\" },\n  { key: \"material_name\", label: \"자재명\" },\n  { key: \"material_unit\", label: \"단위\" },\n  { key: \"purchase_order_quantity\", label: \"발주 수량\" },\n  { key: \"received_quantity\", label: \"받은 수량\" },\n  { key: \"receive_qty\", label: \"수령 수량\" },\n  { key: \"purchase_order_date\", label: \"발주일\" },\n  { key: \"account_id\", label: \"거래처코드\" },\n  { key: \"account_name\", label: \"거래처명\" },\n];\n\nconst receiptColumns = [\n  { key: \"purchase_order_id\", label: \"발주코드\" },\n  { key: \"material_code\", label: \"자재코드\" },\n  { key: \"material_name\", label: \"자재명\" },\n  { key: \"purchase_order_quantity\", label: \"입고 수량\" },\n  { key: \"material_unit\", label: \"단위\" },\n  { key: \"material_expiration_date\", label: \"유통기한\" },\n  { key: \"lot_number\", label: \"LOT번호\" },\n  { key: \"action\", label: \"입고\" },\n];\n\nconst fetchMaterialsOrder = async () => {\n  const res = await axios.get(\"/materialLot\");\n  materialOrderList.value = res.data;\n};\n\nconst fetchOrder = async () => {\n  const res = await axios.get(\"/orderCheck\");\n  orderCheckList.value = res.data;\n};\n\nconst saveMaterialLot = async (item: MaterialReceipt) => {\n  const lotNum = generateLotNumber(item.material_code);\n  const payload = {\n    lot_number: lotNum,\n    material_code: item.material_code,\n    expiry_date: toDateOnly(item.material_expiration_date),\n    quantity: item.purchase_order_quantity,\n    purchase_order_id: item.purchase_order_id,\n  };\n\n  const res = await axios.post(\"/materialLot\", payload);\n  const res2 = await axios.put(`/materialLot/${payload.purchase_order_id}`);\n  if (res.data.isSuccessed && res2.data.isUpdated) {\n    alert(\"LOT 등록 완료!\");\n    await fetchMaterialsOrder();\n  } else {\n    alert(\"등록 실패\");\n  }\n};\n\nconst handleReceive = async () => {\n  for (const item of selectedRows.value) {\n    const id = item.purchase_order_id;\n    const inputQty = Number(item.receive_qty || 0);\n\n    const res1 = await axios.put(`/receiveQty/${id}`, {\n      receive_qty: inputQty,\n    });\n\n    if (!res1.data.isUpdated) {\n      alert(`[${id}] 수령 수량 업데이트 실패`);\n      continue;\n    }\n\n    const res2 = await axios.get(`/orderCheck/${id}`);\n    const order = res2.data[0];\n    console.log(order.received_quantity);\n    console.log(order.purchase_order_quantity);\n    console.log(`${id}`);\n\n    if (order.received_quantity === order.purchase_order_quantity) {\n      const now = new Date();\n      const yyyyMMdd = `${now.getFullYear()}${String(\n        now.getMonth() + 1,\n      ).padStart(2, \"0\")}${String(now.getDate()).padStart(2, \"0\")}`;\n      const random = Math.floor(100 + Math.random() * 900);\n      const materialQualNum = `QUN-${yyyyMMdd}-${random}`;\n\n      await axios.put(`/orderCheck/${id}`);\n      await axios.post(\"/qualityTest\", {\n        material_qual_num: materialQualNum,\n        purchase_order_id: id,\n        material_code: order.material_code,\n      });\n\n      alert(`[${id}] 수령 및 품질검사 등록 완료!`);\n    } else {\n      alert(`[${id}] 수령 완료! (누적 수령 중)`);\n    }\n  }\n\n  selectedRows.value = [];\n  await fetchOrder();\n};\n\nonMounted(() => {\n  fetchMaterialsOrder();\n  fetchOrder();\n});\n</script>\n\n<style scoped>\n.receipt-page {\n  padding: 1.5rem;\n  max-width: 1000px;\n  margin: 0 auto;\n}\n\n.page-title {\n  font-size: 1.5rem;\n  font-weight: bold;\n  margin-bottom: 2rem;\n}\n\n.table-section {\n  margin-bottom: 2rem;\n}\n\n.table-title {\n  font-size: 1.2rem;\n  font-weight: 600;\n  margin-bottom: 1rem;\n}\n</style>\n"],"names":["formatToKST","isoDate","date","kst","toDateOnly","iso","generateLotNumber","materialCode","now","yyyyMMdd","random","materialOrderList","ref","orderCheckList","orderPage","receiptPage","selectedRows","orderColumns","receiptColumns","fetchMaterialsOrder","res","axios","fetchOrder","saveMaterialLot","item","payload","res2","handleReceive","id","inputQty","order","materialQualNum","onMounted","_openBlock","_createElementBlock","_hoisted_1","_cache","_createElementVNode","_hoisted_2","_createVNode","_component_va_data_table","$event","_withCtx","row","_createTextVNode","_toDisplayString","_component_va_input","_component_va_checkbox","r","checked","index","_component_va_button","_hoisted_3"],"mappings":"yPA2GM,MAAAA,EAAeC,GAA4B,CACzC,MAAAC,EAAO,IAAI,KAAKD,CAAO,EACvBE,EAAM,IAAI,KAAKD,EAAK,UAAY,EAAI,GAAK,GAAK,GAAI,EACjD,MAAA,GAAGC,EAAI,YAAA,CAAa,IAAI,OAAOA,EAAI,SAAA,EAAa,CAAC,EAAE,SACxD,EACA,GACD,CAAA,IAAI,OAAOA,EAAI,QAAS,CAAA,EAAE,SAAS,EAAG,GAAG,CAAC,IAAI,OAC7CA,EAAI,SAAS,CACb,EAAA,SAAS,EAAG,GAAG,CAAC,IAAI,OAAOA,EAAI,WAAA,CAAY,EAAE,SAAS,EAAG,GAAG,CAAC,EAAA,EAG3DC,EAAcC,GAAwBA,EAAI,MAAM,GAAG,EAAE,CAAC,EAEtDC,EAAqBC,GAAiC,CACpD,MAAAC,MAAU,KACVC,EAAW,GAAGD,EAAI,YAAa,CAAA,GAAG,OAAOA,EAAI,WAAa,CAAC,EAAE,SACjE,EACA,GAAA,CACD,GAAG,OAAOA,EAAI,QAAS,CAAA,EAAE,SAAS,EAAG,GAAG,CAAC,GACpCE,EAAS,KAAK,MAAM,IAAM,KAAK,OAAA,EAAW,GAAG,EACnD,MAAO,MAAMH,CAAY,IAAIE,CAAQ,MAAMC,CAAM,EAAA,EAG7CC,EAAoBC,EAAuB,CAAA,CAAE,EAC7CC,EAAiBD,EAAuB,CAAA,CAAE,EAC1CE,EAAYF,EAAI,CAAC,EACjBG,EAAcH,EAAI,CAAC,EACnBI,EAAeJ,EAAuB,CAAA,CAAE,EAExCK,EAAe,CACnB,CAAE,IAAK,SAAU,MAAO,IAAK,EAC7B,CAAE,IAAK,oBAAqB,MAAO,MAAO,EAC1C,CAAE,IAAK,gBAAiB,MAAO,MAAO,EACtC,CAAE,IAAK,gBAAiB,MAAO,KAAM,EACrC,CAAE,IAAK,gBAAiB,MAAO,IAAK,EACpC,CAAE,IAAK,0BAA2B,MAAO,OAAQ,EACjD,CAAE,IAAK,oBAAqB,MAAO,OAAQ,EAC3C,CAAE,IAAK,cAAe,MAAO,OAAQ,EACrC,CAAE,IAAK,sBAAuB,MAAO,KAAM,EAC3C,CAAE,IAAK,aAAc,MAAO,OAAQ,EACpC,CAAE,IAAK,eAAgB,MAAO,MAAO,CAAA,EAGjCC,EAAiB,CACrB,CAAE,IAAK,oBAAqB,MAAO,MAAO,EAC1C,CAAE,IAAK,gBAAiB,MAAO,MAAO,EACtC,CAAE,IAAK,gBAAiB,MAAO,KAAM,EACrC,CAAE,IAAK,0BAA2B,MAAO,OAAQ,EACjD,CAAE,IAAK,gBAAiB,MAAO,IAAK,EACpC,CAAE,IAAK,2BAA4B,MAAO,MAAO,EACjD,CAAE,IAAK,aAAc,MAAO,OAAQ,EACpC,CAAE,IAAK,SAAU,MAAO,IAAK,CAAA,EAGzBC,EAAsB,SAAY,CACtC,MAAMC,EAAM,MAAMC,EAAM,IAAI,cAAc,EAC1CV,EAAkB,MAAQS,EAAI,IAAA,EAG1BE,EAAa,SAAY,CAC7B,MAAMF,EAAM,MAAMC,EAAM,IAAI,aAAa,EACzCR,EAAe,MAAQO,EAAI,IAAA,EAGvBG,EAAkB,MAAOC,GAA0B,CAEvD,MAAMC,EAAU,CACd,WAFanB,EAAkBkB,EAAK,aAAa,EAGjD,cAAeA,EAAK,cACpB,YAAapB,EAAWoB,EAAK,wBAAwB,EACrD,SAAUA,EAAK,wBACf,kBAAmBA,EAAK,iBAAA,EAGpBJ,EAAM,MAAMC,EAAM,KAAK,eAAgBI,CAAO,EAC9CC,EAAO,MAAML,EAAM,IAAI,gBAAgBI,EAAQ,iBAAiB,EAAE,EACpEL,EAAI,KAAK,aAAeM,EAAK,KAAK,WACpC,MAAM,YAAY,EAClB,MAAMP,EAAoB,GAE1B,MAAM,OAAO,CACf,EAGIQ,EAAgB,SAAY,CACrB,UAAAH,KAAQR,EAAa,MAAO,CACrC,MAAMY,EAAKJ,EAAK,kBACVK,EAAW,OAAOL,EAAK,aAAe,CAAC,EAMzC,GAAA,EAJS,MAAMH,EAAM,IAAI,eAAeO,CAAE,GAAI,CAChD,YAAaC,CAAA,CACd,GAES,KAAK,UAAW,CAClB,MAAA,IAAID,CAAE,iBAAiB,EAC7B,QACF,CAGM,MAAAE,GADO,MAAMT,EAAM,IAAI,eAAeO,CAAE,EAAE,GAC7B,KAAK,CAAC,EAKrB,GAJI,QAAA,IAAIE,EAAM,iBAAiB,EAC3B,QAAA,IAAIA,EAAM,uBAAuB,EACjC,QAAA,IAAI,GAAGF,CAAE,EAAE,EAEfE,EAAM,oBAAsBA,EAAM,wBAAyB,CACvD,MAAAtB,MAAU,KACVC,EAAW,GAAGD,EAAI,YAAA,CAAa,GAAG,OACtCA,EAAI,WAAa,CACjB,EAAA,SAAS,EAAG,GAAG,CAAC,GAAG,OAAOA,EAAI,QAAA,CAAS,EAAE,SAAS,EAAG,GAAG,CAAC,GACrDE,EAAS,KAAK,MAAM,IAAM,KAAK,OAAA,EAAW,GAAG,EAC7CqB,EAAkB,OAAOtB,CAAQ,IAAIC,CAAM,GAEjD,MAAMW,EAAM,IAAI,eAAeO,CAAE,EAAE,EAC7B,MAAAP,EAAM,KAAK,eAAgB,CAC/B,kBAAmBU,EACnB,kBAAmBH,EACnB,cAAeE,EAAM,aAAA,CACtB,EAEK,MAAA,IAAIF,CAAE,oBAAoB,CAAA,MAE1B,MAAA,IAAIA,CAAE,oBAAoB,CAEpC,CAEAZ,EAAa,MAAQ,GACrB,MAAMM,EAAW,CAAA,EAGnB,OAAAU,EAAU,IAAM,CACMb,IACTG,GAAA,CACZ,yFA9OC,OAAAW,EAAA,EAAAC,EAmFM,MAnFNC,EAmFM,CAlFJC,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAC,EAAiC,KAA7B,CAAA,MAAM,cAAa,QAAK,EAAA,GAG5BA,EAoDM,MApDNC,EAoDM,CAnDJF,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAC,EAAmC,KAA/B,CAAA,MAAM,eAAc,SAAM,EAAA,GAC9BE,EA0CgBC,EAAA,CAzCN,eAAc1B,EAAS,4CAATA,EAAS,MAAA2B,GAC9B,MAAO5B,EAAc,MACrB,QAASI,EACT,WAAU,EACX,WAAS,mBAAA,GAEE,4BAAyByB,EAClC,CAAiD,CADX,IAAAC,KAAG,CACtCC,EAAAC,EAAA7C,EAAY2C,EAAI,OAAO,mBAAmB,CAAA,EAAA,CAAA,CAAA,GAGpC,oBAAiBD,EAC1B,CAKE,CAN4B,IAAAC,KAAG,CACjCJ,EAKEO,EAAA,YAJSH,EAAI,OAAO,qCAAXA,EAAI,OAAO,YAAWF,EAC/B,KAAK,SACL,IAAI,IACJ,YAAY,uDAIL,eAAYC,EACrB,CAmBE,CApBuB,IAAAC,KAAG,CAC5BJ,EAmBEQ,EAAA,CAlBC,cAA4B/B,EAAA,MAAa,KAAuBgC,GAAMA,EAAE,oBAAsBL,EAAI,OAAO,mBAKzG,SAAW,CAAAA,EAAI,OAAO,YACtB,sBAAoCM,GAAO,IAA2BA,EAA6BjC,EAAA,MAAa,KAAK2B,EAAI,MAAM,OAAoD,MAAAO,EAAQlC,EAAY,MAAC,UAAgCgC,GAAMA,EAAE,oBAAsBL,EAAI,OAAO,iBAAA,EAA8DO,IAAc,IAAAlC,EAAA,MAAa,OAAOkC,EAAK,CAAA,iGAe7XX,EAMYY,EAAA,CALV,MAAM,OACL,SAAUnC,EAAY,MAAC,SAAM,EAC7B,QAAOW,CAAA,aACT,IAEDS,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAA,GAFC,YAED,CAAA,kCAIFC,EAuBM,MAvBNe,EAuBM,CAtBJhB,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAAC,EAAkC,KAA9B,CAAA,MAAM,eAAc,QAAK,EAAA,GAC7BE,EAoBgBC,EAAA,CAnBN,eAAczB,EAAW,4CAAXA,EAAW,MAAA0B,GAChC,MAAO9B,EAAiB,MACxB,QAASO,EACT,WAAU,EACX,WAAS,eAAA,GAEE,iCAA8BwB,EACvC,CAAsD,CADX,IAAAC,KAAG,CAC3CC,EAAAC,EAAA7C,EAAY2C,EAAI,OAAO,wBAAwB,CAAA,EAAA,CAAA,CAAA,GAGzC,mBAAgBD,EACzB,CAAiD,CADpB,IAAAC,KAAG,CAC7BC,EAAAC,EAAAvC,EAAkBqC,EAAI,OAAO,aAAa,CAAA,EAAA,CAAA,CAAA,GAGpC,eAAYD,EACrB,CAEY,CAHa,IAAAC,KAAG,CAC5BJ,EAEYY,EAAA,CAFD,KAAK,QAAS,QAAOV,GAAAlB,EAAgBoB,EAAI,MAAM,CAAA,aAAG,IAE7DP,EAAA,CAAA,IAAAA,EAAA,CAAA,EAAA,GAF6D,MAE7D,CAAA"}