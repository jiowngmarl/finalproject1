{"version":3,"file":"EquipmentManagement-DPlt1yHs.js","sources":["../../../client/src/pages/equipment/EquipmentManagement.vue"],"sourcesContent":["<template>\r\n  <div class=\"equipment-management-page\">\r\n    <h1 class=\"va-h3 mb-6\">ÏÑ§ÎπÑ Í¥ÄÎ¶¨</h1>\r\n\r\n    <!-- Í≤ÄÏÉâ -->\r\n    <VaCard class=\"mb-6\">\r\n      <VaCardContent>\r\n        <h2 class=\"va-h5 mb-4\">Í≤ÄÏÉâ Ï°∞Í±¥</h2>\r\n        <div class=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4\">\r\n          <VaInput\r\n            v-model=\"searchParams.equipmentCode\"\r\n            label=\"ÏÑ§ÎπÑÎ≤àÌò∏\"\r\n            placeholder=\"ÏÑ§ÎπÑÎ≤àÌò∏ ÏûÖÎ†•\"\r\n            clearable\r\n          />\r\n          <VaInput\r\n            v-model=\"searchParams.equipmentName\"\r\n            label=\"ÏÑ§ÎπÑÎ™Ö\"\r\n            placeholder=\"ÏÑ§ÎπÑÎ™Ö ÏûÖÎ†•\"\r\n            clearable\r\n          />\r\n          <VaSelect\r\n            v-model=\"searchParams.category\"\r\n            label=\"ÏÑ§ÎπÑÎ∂ÑÎ•ò\"\r\n            :options=\"categoryOptions\"\r\n            text-by=\"label\"\r\n            value-by=\"value\"\r\n            clearable\r\n            placeholder=\"Ï†ÑÏ≤¥\"\r\n          />\r\n          <VaSelect\r\n            v-model=\"searchParams.status\"\r\n            label=\"ÏÑ§ÎπÑÏÉÅÌÉú\"\r\n            :options=\"statusOptions\"\r\n            text-by=\"label\"\r\n            value-by=\"value\"\r\n            clearable\r\n            placeholder=\"Ï†ÑÏ≤¥\"\r\n          />\r\n        </div>\r\n        <div class=\"flex justify-end gap-2 mt-4\">\r\n          <VaButton color=\"secondary\" @click=\"resetSearch\">Ï¥àÍ∏∞Ìôî</VaButton>\r\n        </div>\r\n      </VaCardContent>\r\n    </VaCard>\r\n\r\n    <!-- Î™©Î°ù -->\r\n    <VaCard>\r\n      <VaCardContent>\r\n        <div class=\"flex justify-between items-center mb-4\">\r\n          <h2 class=\"va-h5\">ÏÑ§ÎπÑ Î™©Î°ù (Ï¥ù {{ filteredEquipments.length }}Í∞ú)</h2>\r\n          <div class=\"flex gap-2\">\r\n            <VaButton color=\"warning\" @click=\"handleEdit\">ÏàòÏ†ï</VaButton>\r\n            <VaButton color=\"danger\" @click=\"handleDelete\">ÏÇ≠Ï†ú</VaButton>\r\n          </div>\r\n        </div>\r\n\r\n        <VaDataTable\r\n          v-model=\"selectedRows\"\r\n          :items=\"filteredEquipments\"\r\n          :columns=\"columns\"\r\n          item-key=\"eq_id\"\r\n          selectable\r\n          select-mode=\"multiple\"\r\n          sticky-header\r\n          hoverable\r\n        >\r\n          <template #cell(eq_group_name)=\"{ rowData }\">\r\n            <VaChip :color=\"getCategoryColor(rowData.eq_group_code)\" size=\"small\" flat>\r\n              {{ rowData.eq_group_name || rowData.eq_group_code }}\r\n            </VaChip>\r\n          </template>\r\n          <template #cell(location)=\"{ rowData }\">\r\n            <span class=\"text-sm\">{{ getLocationText(rowData) }}</span>\r\n          </template>\r\n          <template #cell(eq_run_name)=\"{ rowData }\">\r\n            <VaChip :color=\"getStatusColor(rowData.eq_run_code)\" size=\"small\" flat>\r\n              {{ rowData.eq_run_name || rowData.eq_run_code }}\r\n            </VaChip>\r\n          </template>\r\n        </VaDataTable>\r\n      </VaCardContent>\r\n    </VaCard>\r\n  </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { ref, computed, onMounted } from 'vue'\r\nimport { useRouter } from 'vue-router'\r\nimport axios from 'axios'\r\nimport { useAuthStore } from '@/stores/authStore'\r\n\r\nconst authStore = useAuthStore()\r\n\r\nconsole.log('‚úÖ auth_type Í∞íÏùÄ:', authStore.user?.auth_type)\r\n\r\ninterface Equipment {\r\n  eq_id: string\r\n  eq_name: string\r\n  eq_group_code: string\r\n  eq_group_name?: string\r\n  eq_run_code: string\r\n  eq_run_name?: string\r\n  factory_name?: string\r\n  floor_name?: string\r\n  room_name?: string\r\n}\r\n\r\ninterface CodeOption {\r\n  label: string\r\n  value: string\r\n}\r\n\r\nconst router = useRouter()\r\nconst equipments = ref<Equipment[]>([])\r\nconst selectedRows = ref<Equipment[]>([])\r\n\r\nconst searchParams = ref({\r\n  equipmentCode: '',\r\n  equipmentName: '',\r\n  category: '',\r\n  status: ''\r\n})\r\n\r\nconst categoryOptions = ref<CodeOption[]>([])\r\nconst statusOptions = ref<CodeOption[]>([])\r\n\r\nconst columns = [\r\n  { key: 'eq_id', label: 'ÏÑ§ÎπÑ Î≤àÌò∏', sortable: true },\r\n  { key: 'eq_name', label: 'ÏÑ§ÎπÑÎ™Ö', sortable: true },\r\n  { key: 'eq_group_name', label: 'Î∂ÑÎ•ò', sortable: true },\r\n  { key: 'location', label: 'ÏúÑÏπò', sortable: true },\r\n  { key: 'eq_run_name', label: 'ÏÑ§ÎπÑÏÉÅÌÉú', sortable: true }\r\n]\r\n\r\nconst filteredEquipments = computed(() =>\r\n  equipments.value.filter(eq => {\r\n    const matchCode = !searchParams.value.equipmentCode || eq.eq_id.toLowerCase().includes(searchParams.value.equipmentCode.toLowerCase())\r\n    const matchName = !searchParams.value.equipmentName || eq.eq_name.toLowerCase().includes(searchParams.value.equipmentName.toLowerCase())\r\n    const matchCategory = !searchParams.value.category || eq.eq_group_code === searchParams.value.category\r\n    const matchStatus = !searchParams.value.status || eq.eq_run_code === searchParams.value.status\r\n    return matchCode && matchName && matchCategory && matchStatus\r\n  })\r\n)\r\n\r\nconst resetSearch = async () => {\r\n  searchParams.value = {\r\n    equipmentCode: '',\r\n    equipmentName: '',\r\n    category: '',\r\n    status: ''\r\n  }\r\n  selectedRows.value = []\r\n  await loadEquipments()\r\n}\r\n\r\n// ÏÑ§ÎπÑ Í¥ÄÎ¶¨ ÌéòÏù¥ÏßÄÏùò handleEdit Ìï®Ïàò\r\nconst handleEdit = async () => {\r\n    if (authStore.user?.department_code !== '04') {\r\n    alert('ÏÑ§ÎπÑÌåÄÎßå ÏàòÏ†ïÌï† Ïàò ÏûàÏäµÎãàÎã§.')\r\n    return\r\n  }\r\n\r\n  if (selectedRows.value.length !== 1) {\r\n    alert('ÏàòÏ†ïÌï† ÏÑ§ÎπÑ 1Í∞úÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.')\r\n    return\r\n  }\r\n\r\n  const id = selectedRows.value[0].eq_id\r\n  console.log('üîó ÏàòÏ†ï Î≤ÑÌäº ÌÅ¥Î¶≠. Ïù¥ÎèôÌï† ID:', id) // Ïù¥ Î°úÍ∑∏ Ï∂îÍ∞Ä\r\n  \r\n  router.push({\r\n    path: '/faq/equipment-register',\r\n    query: {\r\n      mode: 'edit',\r\n      eq_id: id  // Ïù¥ Í∞íÏù¥ Ï†úÎåÄÎ°ú ÏÑ§Ï†ïÎêòÎäîÏßÄ ÌôïÏù∏\r\n    }\r\n  })\r\n}\r\n\r\nconst handleDelete = async () => {\r\n   if (authStore.user?.department_code !== '04') {\r\n    alert('ÏÑ§ÎπÑÌåÄÎßå ÏÇ≠Ï†úÌï† Ïàò ÏûàÏäµÎãàÎã§.')\r\n    return\r\n  }\r\n\r\n  if (selectedRows.value.length === 0) {\r\n    alert('ÏÇ≠Ï†úÌï† ÏÑ§ÎπÑÎ•º ÏÑ†ÌÉùÌï¥Ï£ºÏÑ∏Ïöî.')\r\n    return\r\n  }\r\n  const confirmed = confirm(`${selectedRows.value.length}Í∞ú ÏÑ§ÎπÑÎ•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?`)\r\n  if (!confirmed) return\r\n\r\n  const ids = selectedRows.value.map(eq => eq.eq_id)\r\n  try {\r\n    await axios.post('/equipments/delete', { eq_ids: ids })\r\n    alert('ÏÇ≠Ï†úÎêòÏóàÏäµÎãàÎã§.')\r\n    await loadEquipments()\r\n    selectedRows.value = []\r\n  } catch (err) {\r\n    console.error(err)\r\n    alert('ÏÇ≠Ï†ú Ïã§Ìå®')\r\n  }\r\n}\r\n\r\nconst loadCommonCodes = async () => {\r\n  const res = await axios.get('/common-codes?groups=0E,0S')\r\n  categoryOptions.value = res.data['0E'] || []\r\n  statusOptions.value = res.data['0S'] || []\r\n}\r\n\r\nconst loadEquipments = async () => {\r\n  const res = await axios.get('/equipments')\r\n  if (res.data.isSuccessed) {\r\n    equipments.value = res.data.data.map((eq: any) => ({\r\n      ...eq,\r\n      eq_id: eq.eq_id?.toString()\r\n    }))\r\n  }\r\n}\r\n\r\nconst getCategoryColor = (code: string) => ({ e1: 'primary', e2: 'success', e3: 'warning' }[code] || 'secondary')\r\nconst getStatusColor = (code: string) => ({ s1: 'success', s2: 'info', s3: 'danger' }[code] || 'secondary')\r\nconst getLocationText = (eq: Equipment) => [eq.factory_name, eq.floor_name, eq.room_name].filter(Boolean).join(' > ') || '-'\r\n\r\nonMounted(() => {\r\n  loadEquipments()\r\n  loadCommonCodes()\r\n})\r\n</script>\r\n\r\n<style scoped>\r\n.equipment-management-page {\r\n  padding: 1.5rem;\r\n}\r\n</style>"],"names":["authStore","useAuthStore","_a","router","useRouter","equipments","ref","selectedRows","searchParams","categoryOptions","statusOptions","columns","filteredEquipments","computed","eq","matchCode","matchName","matchCategory","matchStatus","resetSearch","loadEquipments","handleEdit","id","handleDelete","ids","axios","err","loadCommonCodes","res","getCategoryColor","code","getStatusColor","getLocationText","onMounted","_openBlock","_createElementBlock","_hoisted_1","_cache","_createElementVNode","_createVNode","_component_VaCard","_component_VaCardContent","_hoisted_2","_component_VaInput","$event","_component_VaSelect","_hoisted_3","_component_VaButton","_hoisted_4","_hoisted_5","_hoisted_6","_component_VaDataTable","_withCtx","rowData","_component_VaChip","_createTextVNode","_toDisplayString","_hoisted_7"],"mappings":"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"}