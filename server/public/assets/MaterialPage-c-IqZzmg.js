import{d as $,n as s,c as P,o as R,p as k,i as n,j as r,g as V,w as c,q as j,v as g,h as C,m as y,_ as q}from"./index-1iuYf_qr.js";const A={class:"material-page"},E={class:"material-container"},L={class:"material-grid"},S={class:"material-table"},z={class:"material-filters"},G={class:"material-form"},H={class:"form-header"},J={key:0,class:"image-preview"},K=["src"],O={class:"form-buttons"},Q=$({__name:"MaterialPage",setup(W){const b=s([]),_=async()=>{try{const l=await g.get("/material");b.value=l.data}catch(l){console.log("❌ 자재 목록 조회 실패:",l)}},U=[{key:"select",label:"선택"},{key:"material_code",label:"자재코드"},{key:"material_name",label:"자재명"},{key:"material_cls",label:"분류"},{key:"material_unit",label:"단위"},{key:"material_stand",label:"규격"}],i=s({material_code:"",material_name:"",material_cls:""}),w=s(1),x=P(()=>b.value.filter(l=>(!i.value.material_code||l.material_code.includes(i.value.material_code))&&(!i.value.material_name||l.material_name.includes(i.value.material_name))&&(!i.value.material_cls||l.material_cls.includes(i.value.material_cls)))),a=s({material_code:"",material_name:"",material_pay:"",material_cls:"",material_stand:"",material_unit:"",material_safty:"",material_img:""}),v=s(null),m=s(null);function d(){a.value={material_code:"",material_name:"",material_pay:"",material_cls:"",material_stand:"",material_unit:"",material_safty:"",material_img:""},v.value=null,m.value=null}async function M(){if(!a.value.material_code||!a.value.material_name){alert("필수값 누락");return}const l=new FormData;for(const e in a.value)l.append(e,a.value[e]);m.value&&l.append("image",m.value);try{(await g.post("/material",l,{headers:{"Content-Type":"multipart/form-data"}})).data.isSuccessed==!0?(alert("등록완료!"),await _(),d()):alert("등록 실패!")}catch(e){console.log("오류 발생:",e),alert("서버 오류!")}}async function D(){const l=a.value.material_code.trim();if(!l){alert("자재코드가 없습니다. 수정할 수 없습니다.");return}const e=new FormData;for(const o in a.value)e.append(o,a.value[o]);m.value&&e.append("image",m.value);try{(await g.put(`/material/${l}`,e,{headers:{"Content-Type":"multipart/form-data"}})).data.isUpdated==!0?(alert("수정 완료!"),await _(),d()):alert("수정 실패!")}catch(o){console.error("❌ 수정 중 오류 발생:",o),alert("서버 오류!")}}async function F(){const l=a.value.material_code.trim();if(!l){alert("자재코드가 없습니다. 삭제할 수 없습니다.");return}if(confirm(`정말로 ${l} 자재을 삭제하시겠습니까?`))try{(await g.delete(`/material/${l}`)).data?(alert("삭제 완료!"),await _(),d()):alert("삭제 실패! (해당 자재이 존재하지 않거나 이미 삭제됨)")}catch(e){console.error("❌ 삭제 중 오류 발생:",e),alert("서버 오류!")}}const u=s(null);function N(l,e){l?(u.value=e.material_code,a.value={...e}):u.value===e.material_code&&(u.value=null,d())}function T(l){var p;const e=(p=l.target.files)==null?void 0:p[0];if(!e)return;m.value=e,a.value.material_img=e.name;const o=new FileReader;o.onload=()=>{v.value=o.result},o.readAsDataURL(e)}return R(()=>{_()}),(l,e)=>{const o=V("va-input"),p=V("va-checkbox"),B=V("va-data-table"),f=V("va-button");return C(),k("div",A,[n("div",E,[e[15]||(e[15]=n("h2",{class:"material-title"},"자재 관리",-1)),n("div",L,[n("div",S,[n("div",z,[r(o,{modelValue:i.value.material_code,"onUpdate:modelValue":e[0]||(e[0]=t=>i.value.material_code=t),label:"자재코드",class:"filter-input"},null,8,["modelValue"]),r(o,{modelValue:i.value.material_name,"onUpdate:modelValue":e[1]||(e[1]=t=>i.value.material_name=t),label:"자재명",class:"filter-input"},null,8,["modelValue"]),r(o,{modelValue:i.value.material_cls,"onUpdate:modelValue":e[2]||(e[2]=t=>i.value.material_cls=t),label:"분류",class:"filter-spec-input"},null,8,["modelValue"])]),r(B,{items:x.value,columns:U,"per-page":10,"current-page":w.value,"track-by":"material_code"},{"cell(select)":c(({row:t})=>[r(p,{"model-value":u.value===t.source.material_code,"onUpdate:modelValue":I=>N(I,t.source),disabled:u.value!==null&&u.value!==t.source.material_code},null,8,["model-value","onUpdate:modelValue","disabled"])]),_:1},8,["items","current-page"])]),n("div",G,[n("div",H,[e[10]||(e[10]=n("h3",{class:"form-title"},"자재 등록",-1)),n("input",{type:"file",accept:"image/*",onChange:T},null,32)]),v.value?(C(),k("div",J,[n("img",{src:v.value,alt:"첨부 이미지 미리보기"},null,8,K)])):j("",!0),r(o,{modelValue:a.value.material_code,"onUpdate:modelValue":e[3]||(e[3]=t=>a.value.material_code=t),label:"자재코드"},null,8,["modelValue"]),r(o,{modelValue:a.value.material_name,"onUpdate:modelValue":e[4]||(e[4]=t=>a.value.material_name=t),label:"자재명"},null,8,["modelValue"]),r(o,{modelValue:a.value.material_pay,"onUpdate:modelValue":e[5]||(e[5]=t=>a.value.material_pay=t),label:"단가"},null,8,["modelValue"]),r(o,{modelValue:a.value.material_cls,"onUpdate:modelValue":e[6]||(e[6]=t=>a.value.material_cls=t),label:"분류"},null,8,["modelValue"]),r(o,{modelValue:a.value.material_stand,"onUpdate:modelValue":e[7]||(e[7]=t=>a.value.material_stand=t),label:"규격"},null,8,["modelValue"]),r(o,{modelValue:a.value.material_unit,"onUpdate:modelValue":e[8]||(e[8]=t=>a.value.material_unit=t),label:"단위"},null,8,["modelValue"]),r(o,{modelValue:a.value.material_safty,"onUpdate:modelValue":e[9]||(e[9]=t=>a.value.material_safty=t),label:"안전재고"},null,8,["modelValue"]),n("div",O,[r(f,{onClick:M,color:"primary"},{default:c(()=>e[11]||(e[11]=[y("등록")])),_:1,__:[11]}),r(f,{onClick:d,color:"secondary"},{default:c(()=>e[12]||(e[12]=[y("초기화")])),_:1,__:[12]}),r(f,{onClick:D,color:"warning"},{default:c(()=>e[13]||(e[13]=[y("수정")])),_:1,__:[13]}),r(f,{onClick:F,color:"danger"},{default:c(()=>e[14]||(e[14]=[y("삭제")])),_:1,__:[14]})])])])])])}}}),Y=q(Q,[["__scopeId","data-v-00272612"]]);export{Y as default};
//# sourceMappingURL=MaterialPage-c-IqZzmg.js.map
